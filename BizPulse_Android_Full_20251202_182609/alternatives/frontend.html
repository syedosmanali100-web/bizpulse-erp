<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Billing Software - Frontend</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header { text-align: center; color: #1976d2; }
        .tabs { display: flex; gap: 10px; margin: 20px 0; }
        .tab { padding: 10px 20px; background: #1976d2; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .tab.active { background: #0d47a1; }
        .content { display: none; }
        .content.active { display: block; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f5f5f5; }
        .btn { padding: 8px 16px; background: #1976d2; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #0d47a1; }
        .form-group { margin: 10px 0; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .status { padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        .status.success { background: #e8f5e8; color: #2e7d32; }
        .status.warning { background: #fff3e0; color: #f57c00; }
        .status.error { background: #ffebee; color: #d32f2f; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card header">
            <h1>üè™ Billing Software</h1>
            <p>Complete solution for Retail Stores & Hotels</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('products')">üì¶ Products</button>
            <button class="tab" onclick="showTab('customers')">üë• Customers</button>
            <button class="tab" onclick="showTab('billing')">üí≥ Billing</button>
            <button class="tab" onclick="showTab('hotel')">üè® Hotel</button>
            <button class="tab" onclick="showTab('reports')">üìä Reports</button>
        </div>

        <!-- Products Tab -->
        <div id="products" class="content active">
            <div class="card">
                <h2>Product Management</h2>
                <button class="btn" onclick="loadProducts()">üîÑ Refresh Products</button>
                <button class="btn" onclick="showAddProduct()">‚ûï Add Product</button>
                
                <div id="addProductForm" style="display: none; margin: 20px 0; padding: 20px; background: #f9f9f9; border-radius: 4px;">
                    <h3>Add New Product</h3>
                    <div class="grid">
                        <div class="form-group">
                            <label>Product Code:</label>
                            <input type="text" id="productCode" placeholder="e.g., 001">
                        </div>
                        <div class="form-group">
                            <label>Product Name:</label>
                            <input type="text" id="productName" placeholder="e.g., Rice 1kg">
                        </div>
                        <div class="form-group">
                            <label>Category:</label>
                            <input type="text" id="productCategory" placeholder="e.g., Grains">
                        </div>
                        <div class="form-group">
                            <label>Price (‚Çπ):</label>
                            <input type="number" id="productPrice" placeholder="80">
                        </div>
                        <div class="form-group">
                            <label>Cost (‚Çπ):</label>
                            <input type="number" id="productCost" placeholder="70">
                        </div>
                        <div class="form-group">
                            <label>Stock:</label>
                            <input type="number" id="productStock" placeholder="50">
                        </div>
                    </div>
                    <button class="btn" onclick="addProduct()">üíæ Save Product</button>
                    <button class="btn" onclick="hideAddProduct()" style="background: #666;">‚ùå Cancel</button>
                </div>
                
                <div id="productsTable"></div>
            </div>
        </div>

        <!-- Customers Tab -->
        <div id="customers" class="content">
            <div class="card">
                <h2>Customer Management</h2>
                <button class="btn" onclick="loadCustomers()">üîÑ Refresh Customers</button>
                <button class="btn" onclick="showAddCustomer()">‚ûï Add Customer</button>
                
                <div id="addCustomerForm" style="display: none; margin: 20px 0; padding: 20px; background: #f9f9f9; border-radius: 4px;">
                    <h3>Add New Customer</h3>
                    <div class="grid">
                        <div class="form-group">
                            <label>Customer Name:</label>
                            <input type="text" id="customerName" placeholder="John Doe">
                        </div>
                        <div class="form-group">
                            <label>Phone:</label>
                            <input type="text" id="customerPhone" placeholder="9876543210">
                        </div>
                        <div class="form-group">
                            <label>Email:</label>
                            <input type="email" id="customerEmail" placeholder="john@example.com">
                        </div>
                        <div class="form-group">
                            <label>Credit Limit (‚Çπ):</label>
                            <input type="number" id="customerCredit" placeholder="5000">
                        </div>
                    </div>
                    <button class="btn" onclick="addCustomer()">üíæ Save Customer</button>
                    <button class="btn" onclick="hideAddCustomer()" style="background: #666;">‚ùå Cancel</button>
                </div>
                
                <div id="customersTable"></div>
            </div>
        </div>

        <!-- Billing Tab -->
        <div id="billing" class="content">
            <div class="card">
                <h2>Quick Billing</h2>
                <div class="grid">
                    <div>
                        <h3>Add Items</h3>
                        <div class="form-group">
                            <label>Product:</label>
                            <select id="billProduct">
                                <option value="">Select Product</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Quantity:</label>
                            <input type="number" id="billQuantity" value="1" min="1">
                        </div>
                        <button class="btn" onclick="addToBill()">‚ûï Add to Bill</button>
                    </div>
                    <div>
                        <h3>Bill Summary</h3>
                        <div id="billSummary">
                            <p>Subtotal: ‚Çπ<span id="subtotal">0</span></p>
                            <p>Tax (18%): ‚Çπ<span id="tax">0</span></p>
                            <p><strong>Total: ‚Çπ<span id="total">0</span></strong></p>
                        </div>
                        <button class="btn" onclick="processBill()" style="background: #4caf50;">üí≥ Process Payment</button>
                    </div>
                </div>
                <div id="billItems"></div>
            </div>
        </div>

        <!-- Hotel Tab -->
        <div id="hotel" class="content">
            <div class="card">
                <h2>Hotel Management</h2>
                <button class="btn" onclick="loadHotelGuests()">üîÑ Refresh Guests</button>
                <button class="btn" onclick="loadHotelServices()">üõéÔ∏è View Services</button>
                <div id="hotelData"></div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="content">
            <div class="card">
                <h2>Sales Reports</h2>
                <button class="btn" onclick="loadSalesReport()">üìä Generate Report</button>
                <div id="reportsData"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        let currentBill = [];

        // Tab Management
        function showTab(tabName) {
            document.querySelectorAll('.content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Load data when tab is opened
            if (tabName === 'products') loadProducts();
            if (tabName === 'customers') loadCustomers();
            if (tabName === 'billing') loadProductsForBilling();
        }

        // Products Functions
        async function loadProducts() {
            try {
                const response = await fetch(`${API_BASE}/products`);
                const products = await response.json();
                
                let html = '<table><tr><th>Code</th><th>Name</th><th>Category</th><th>Price</th><th>Stock</th><th>Status</th></tr>';
                products.forEach(product => {
                    const status = product.stock <= product.min_stock ? 'warning' : 'success';
                    const statusText = product.stock <= product.min_stock ? 'Low Stock' : 'In Stock';
                    html += `<tr>
                        <td>${product.code}</td>
                        <td>${product.name}</td>
                        <td>${product.category}</td>
                        <td>‚Çπ${product.price}</td>
                        <td>${product.stock}</td>
                        <td><span class="status ${status}">${statusText}</span></td>
                    </tr>`;
                });
                html += '</table>';
                
                document.getElementById('productsTable').innerHTML = html;
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('productsTable').innerHTML = '<p style="color: red;">Error loading products. Make sure the server is running!</p>';
            }
        }

        function showAddProduct() {
            document.getElementById('addProductForm').style.display = 'block';
        }

        function hideAddProduct() {
            document.getElementById('addProductForm').style.display = 'none';
        }

        async function addProduct() {
            const productData = {
                code: document.getElementById('productCode').value,
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                price: parseFloat(document.getElementById('productPrice').value),
                cost: parseFloat(document.getElementById('productCost').value),
                stock: parseInt(document.getElementById('productStock').value),
                min_stock: 5,
                unit: 'piece',
                business_type: 'kirana'
            };

            try {
                const response = await fetch(`${API_BASE}/products`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(productData)
                });
                
                if (response.ok) {
                    alert('Product added successfully!');
                    hideAddProduct();
                    loadProducts();
                    // Clear form
                    document.getElementById('productCode').value = '';
                    document.getElementById('productName').value = '';
                    document.getElementById('productCategory').value = '';
                    document.getElementById('productPrice').value = '';
                    document.getElementById('productCost').value = '';
                    document.getElementById('productStock').value = '';
                } else {
                    alert('Error adding product!');
                }
            } catch (error) {
                console.error('Error adding product:', error);
                alert('Error adding product!');
            }
        }

        // Customers Functions
        async function loadCustomers() {
            try {
                const response = await fetch(`${API_BASE}/customers`);
                const customers = await response.json();
                
                let html = '<table><tr><th>Name</th><th>Phone</th><th>Email</th><th>Credit Limit</th><th>Balance</th></tr>';
                customers.forEach(customer => {
                    html += `<tr>
                        <td>${customer.name}</td>
                        <td>${customer.phone || '-'}</td>
                        <td>${customer.email || '-'}</td>
                        <td>‚Çπ${customer.credit_limit}</td>
                        <td>‚Çπ${customer.current_balance}</td>
                    </tr>`;
                });
                html += '</table>';
                
                document.getElementById('customersTable').innerHTML = html;
            } catch (error) {
                console.error('Error loading customers:', error);
                document.getElementById('customersTable').innerHTML = '<p style="color: red;">Error loading customers!</p>';
            }
        }

        function showAddCustomer() {
            document.getElementById('addCustomerForm').style.display = 'block';
        }

        function hideAddCustomer() {
            document.getElementById('addCustomerForm').style.display = 'none';
        }

        async function addCustomer() {
            const customerData = {
                name: document.getElementById('customerName').value,
                phone: document.getElementById('customerPhone').value,
                email: document.getElementById('customerEmail').value,
                credit_limit: parseFloat(document.getElementById('customerCredit').value) || 1000
            };

            try {
                const response = await fetch(`${API_BASE}/customers`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(customerData)
                });
                
                if (response.ok) {
                    alert('Customer added successfully!');
                    hideAddCustomer();
                    loadCustomers();
                    // Clear form
                    document.getElementById('customerName').value = '';
                    document.getElementById('customerPhone').value = '';
                    document.getElementById('customerEmail').value = '';
                    document.getElementById('customerCredit').value = '';
                } else {
                    alert('Error adding customer!');
                }
            } catch (error) {
                console.error('Error adding customer:', error);
                alert('Error adding customer!');
            }
        }

        // Billing Functions
        async function loadProductsForBilling() {
            try {
                const response = await fetch(`${API_BASE}/products`);
                const products = await response.json();
                
                const select = document.getElementById('billProduct');
                select.innerHTML = '<option value="">Select Product</option>';
                
                products.forEach(product => {
                    select.innerHTML += `<option value="${product.id}" data-price="${product.price}" data-name="${product.name}">
                        ${product.name} - ‚Çπ${product.price}
                    </option>`;
                });
            } catch (error) {
                console.error('Error loading products for billing:', error);
            }
        }

        function addToBill() {
            const select = document.getElementById('billProduct');
            const quantity = parseInt(document.getElementById('billQuantity').value);
            
            if (!select.value || quantity <= 0) {
                alert('Please select a product and enter valid quantity!');
                return;
            }
            
            const option = select.options[select.selectedIndex];
            const price = parseFloat(option.dataset.price);
            const name = option.dataset.name;
            
            const item = {
                product_id: select.value,
                product_name: name,
                quantity: quantity,
                unit_price: price,
                total_price: price * quantity
            };
            
            currentBill.push(item);
            updateBillDisplay();
            
            // Reset form
            select.value = '';
            document.getElementById('billQuantity').value = '1';
        }

        function updateBillDisplay() {
            let html = '<h3>Bill Items</h3><table><tr><th>Item</th><th>Qty</th><th>Price</th><th>Total</th></tr>';
            let subtotal = 0;
            
            currentBill.forEach((item, index) => {
                subtotal += item.total_price;
                html += `<tr>
                    <td>${item.product_name}</td>
                    <td>${item.quantity}</td>
                    <td>‚Çπ${item.unit_price}</td>
                    <td>‚Çπ${item.total_price}</td>
                </tr>`;
            });
            
            html += '</table>';
            document.getElementById('billItems').innerHTML = html;
            
            const tax = subtotal * 0.18;
            const total = subtotal + tax;
            
            document.getElementById('subtotal').textContent = subtotal.toFixed(2);
            document.getElementById('tax').textContent = tax.toFixed(2);
            document.getElementById('total').textContent = total.toFixed(2);
        }

        async function processBill() {
            if (currentBill.length === 0) {
                alert('Please add items to the bill!');
                return;
            }
            
            const subtotal = currentBill.reduce((sum, item) => sum + item.total_price, 0);
            const tax = subtotal * 0.18;
            const total = subtotal + tax;
            
            const billData = {
                business_type: 'retail',
                items: currentBill,
                subtotal: subtotal,
                tax_amount: tax,
                total_amount: total,
                payment: {
                    method: 'cash',
                    amount: total
                }
            };
            
            try {
                const response = await fetch(`${API_BASE}/bills`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(billData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    alert(`Bill created successfully! Bill Number: ${result.bill_number}`);
                    
                    // Reset bill
                    currentBill = [];
                    updateBillDisplay();
                } else {
                    alert('Error creating bill!');
                }
            } catch (error) {
                console.error('Error creating bill:', error);
                alert('Error creating bill!');
            }
        }

        // Hotel Functions
        async function loadHotelGuests() {
            try {
                const response = await fetch(`${API_BASE}/hotel/guests`);
                const guests = await response.json();
                
                let html = '<h3>Hotel Guests</h3><table><tr><th>Name</th><th>Phone</th><th>Room</th><th>Status</th><th>Check-in</th></tr>';
                guests.forEach(guest => {
                    html += `<tr>
                        <td>${guest.name}</td>
                        <td>${guest.phone || '-'}</td>
                        <td>${guest.room_number || '-'}</td>
                        <td><span class="status ${guest.status === 'checked-in' ? 'success' : 'warning'}">${guest.status}</span></td>
                        <td>${guest.check_in_date || '-'}</td>
                    </tr>`;
                });
                html += '</table>';
                
                document.getElementById('hotelData').innerHTML = html;
            } catch (error) {
                console.error('Error loading hotel guests:', error);
                document.getElementById('hotelData').innerHTML = '<p style="color: red;">Error loading hotel data!</p>';
            }
        }

        async function loadHotelServices() {
            try {
                const response = await fetch(`${API_BASE}/hotel/services`);
                const services = await response.json();
                
                let html = '<h3>Hotel Services</h3><table><tr><th>Service</th><th>Category</th><th>Rate</th><th>Description</th></tr>';
                services.forEach(service => {
                    html += `<tr>
                        <td>${service.name}</td>
                        <td>${service.category}</td>
                        <td>‚Çπ${service.rate}</td>
                        <td>${service.description || '-'}</td>
                    </tr>`;
                });
                html += '</table>';
                
                document.getElementById('hotelData').innerHTML = html;
            } catch (error) {
                console.error('Error loading hotel services:', error);
            }
        }

        // Reports Functions
        async function loadSalesReport() {
            try {
                const response = await fetch(`${API_BASE}/reports/sales`);
                const report = await response.json();
                
                let html = '<h3>Sales Summary</h3>';
                html += `<div class="grid">
                    <div class="card">
                        <h4>Total Sales</h4>
                        <p style="font-size: 24px; color: #1976d2;">‚Çπ${report.total_sales.total || 0}</p>
                        <p>Transactions: ${report.total_sales.count || 0}</p>
                    </div>
                    <div class="card">
                        <h4>Top Products</h4>`;
                
                if (report.top_products && report.top_products.length > 0) {
                    html += '<table><tr><th>Product</th><th>Sales</th><th>Quantity</th></tr>';
                    report.top_products.forEach(product => {
                        html += `<tr>
                            <td>${product.product_name}</td>
                            <td>‚Çπ${product.sales}</td>
                            <td>${product.quantity}</td>
                        </tr>`;
                    });
                    html += '</table>';
                } else {
                    html += '<p>No sales data available</p>';
                }
                
                html += '</div></div>';
                
                document.getElementById('reportsData').innerHTML = html;
            } catch (error) {
                console.error('Error loading sales report:', error);
                document.getElementById('reportsData').innerHTML = '<p style="color: red;">Error loading reports!</p>';
            }
        }

        // Load initial data
        window.onload = function() {
            loadProducts();
        };
    </script>
</body>
</html>