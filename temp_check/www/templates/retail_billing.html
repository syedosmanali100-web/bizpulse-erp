<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Billing Management - Retail Store</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #F7E8EC 0%, #E8D5DA 50%, #D4C2C8 100%);
            overflow-x: hidden;
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: linear-gradient(135deg, #732C3F 0%, #8B4A5C 50%, #A66B7A 100%);
            color: white;
            z-index: 1000;
            transition: transform 0.3s ease;
            box-shadow: 4px 0 15px rgba(115, 44, 63, 0.3);
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 40px;
            height: 40px;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #F7E8EC;
        }
        
        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 20px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: block;
            text-align: center;
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Main Content */
        .main-content {
            margin-left: 260px;
            padding: 30px;
            min-height: 100vh;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
        }
        
        /* Quick Billing Section */
        .quick-billing-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Customer and Payment Section */
        .customer-payment-section {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin: 25px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }
        
        .customer-selection,
        .payment-selection {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .customer-selection label,
        .payment-selection label {
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
        }
        
        .customer-dropdown,
        .payment-dropdown {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            transition: border-color 0.3s ease;
        }
        
        .customer-dropdown:focus,
        .payment-dropdown:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .customer-info {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .info-label {
            font-weight: 600;
            color: #666;
            font-size: 0.9rem;
        }
        
        .info-value {
            font-weight: 600;
            color: #333;
        }
        
        .billing-controls {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 25px;
        }
        
        .product-search-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .search-container {
            display: flex;
            gap: 10px;
        }
        
        .product-search-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .product-search-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .search-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .product-dropdown-container {
            display: flex;
            gap: 10px;
        }
        
        .product-dropdown {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
        }
        
        .add-product-btn {
            background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .quantity-price-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .input-group label {
            font-weight: 600;
            color: #333;
        }
        
        .quantity-input,
        .price-input,
        .total-input {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .total-input {
            background: #f8f9fa;
            font-weight: 600;
            color: #4caf50;
        }
        
        .selected-items-section {
            margin-top: 30px;
        }
        
        .subsection-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }
        
        .bill-table-container {
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .bill-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .bill-table th,
        .bill-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .bill-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }
        
        .bill-table tr:hover {
            background: #f8f9fa;
        }
        
        .remove-item-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .bill-summary {
            background: #f8f9fa;
            padding: 20px;
            border-top: 2px solid #e0e0e0;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .total-row {
            font-size: 1.2rem;
            font-weight: 700;
            color: #333;
            border-top: 1px solid #ddd;
            padding-top: 10px;
            margin-top: 10px;
        }
        
        .bill-actions {
            display: flex;
            gap: 15px;
            padding: 20px;
            background: #fff;
            justify-content: flex-end;
        }
        
        .clear-bill-btn,
        .generate-bill-btn,
        .print-bill-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .clear-bill-btn {
            background: #f44336;
            color: white;
        }
        
        .generate-bill-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .print-bill-btn {
            background: #4caf50;
            color: white;
        }
        
        .clear-bill-btn:hover,
        .generate-bill-btn:hover,
        .print-bill-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-to-dashboard:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .nav-btn:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
            box-shadow: 0 4px 12px rgba(25, 118, 210, 0.4);
        }

        .section {
            display: none;
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .section.active {
            display: block;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            font-weight: 600;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .form-group input, .form-group select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 8px rgba(102, 126, 234, 0.3);
        }

        .btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
            box-shadow: 0 2px 8px rgba(25, 118, 210, 0.3);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #1565c0 0%, #0d47a1 100%);
            box-shadow: 0 4px 12px rgba(25, 118, 210, 0.4);
        }

        .btn-danger {
            background: #f44336;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .bill-items {
            margin: 20px 0;
        }

        .item-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr auto;
            gap: 10px;
            align-items: center;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .item-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            border-radius: 8px;
        }

        .bill-summary {
            background: linear-gradient(135deg, #f8f9ff 0%, #e8eeff 100%);
            padding: 25px;
            border-radius: 12px;
            margin-top: 20px;
            border: 2px solid #e3e8ff;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .summary-row.total {
            font-weight: bold;
            font-size: 18px;
            border-top: 3px solid #667eea;
            padding-top: 10px;
            color: #333;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .table tr:hover {
            background: #f5f5f5;
        }

        .search-box {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 16px;
        }

        .invoice {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }

        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 20px;
        }

        .company-info h1 {
            color: #667eea;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .invoice-details {
            text-align: right;
        }

        .customer-info {
            margin-bottom: 30px;
        }

        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        .invoice-table th, .invoice-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }

        .invoice-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .invoice-footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #666;
        }

        .print-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        @media print {
            .print-btn, .nav-buttons, .header {
                display: none;
            }
            
            .invoice {
                box-shadow: none;
                margin: 0;
                padding: 20px;
            }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 900px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">üßæ</div>
            <div class="sidebar-title">Billing Management</div>
        </div>
        
        <a href="/retail/dashboard" class="back-btn">‚Üê Back to Dashboard</a>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Billing Management</h1>
        </div>
        
        <!-- Quick Billing Section -->
        <div class="quick-billing-section">
            <h2 class="section-title">üõí Create New Bill</h2>
            
            <!-- Customer and Payment Selection -->
            <div class="customer-payment-section">
                <div class="customer-selection">
                    <label for="customerSelect">üë§ Select Customer:</label>
                    <select id="customerSelect" class="customer-dropdown" onchange="selectCustomer()">
                        <option value="walk-in">Walk-in Customer</option>
                        <option value="cust-1" data-phone="+91 9876543210" data-credit="5000">Rajesh Kumar - +91 9876543210</option>
                        <option value="cust-2" data-phone="+91 9876543211" data-credit="3000">Priya Sharma - +91 9876543211</option>
                        <option value="cust-3" data-phone="+91 9876543212" data-credit="2000">Amit Singh - +91 9876543212</option>
                        <option value="cust-4" data-phone="+91 9876543213" data-credit="4000">Sunita Devi - +91 9876543213</option>
                        <option value="cust-5" data-phone="+91 9876543214" data-credit="6000">Vikram Patel - +91 9876543214</option>
                        <option value="new-customer">‚ûï Add New Customer</option>
                    </select>
                </div>
                
                <div class="payment-selection">
                    <label for="paymentMethod">üí≥ Payment Method:</label>
                    <select id="paymentMethod" class="payment-dropdown" onchange="selectPaymentMethod()">
                        <option value="cash">üíµ Cash</option>
                        <option value="card">üí≥ Card (Debit/Credit)</option>
                        <option value="upi">üì± UPI Payment</option>
                        <option value="credit">üè™ Store Credit</option>
                        <option value="mixed">üîÑ Mixed Payment</option>
                    </select>
                </div>
                
                <div class="customer-info" id="customerInfo" style="display: none;">
                    <div class="info-item">
                        <span class="info-label">Phone:</span>
                        <span class="info-value" id="customerPhone">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Credit Limit:</span>
                        <span class="info-value" id="customerCredit">-</span>
                    </div>
                </div>
            </div>
            
            <!-- Product Search and Selection -->
            <div class="billing-controls">
                <div class="product-search-section">
                    <div class="search-container">
                        <input type="text" id="productSearch" placeholder="Search products by name or code..." class="product-search-input">
                        <button class="search-btn" onclick="searchProducts()">üîç</button>
                    </div>
                    
                    <div class="product-dropdown-container">
                        <select id="productDropdown" class="product-dropdown" onchange="selectProduct()">
                            <option value="">Select Product from List</option>
                            <option value="prod-1" data-price="80" data-stock="100">Rice (1kg) - ‚Çπ80 - Stock: 100</option>
                            <option value="prod-2" data-price="45" data-stock="50">Wheat Flour (1kg) - ‚Çπ45 - Stock: 50</option>
                            <option value="prod-3" data-price="55" data-stock="30">Sugar (1kg) - ‚Çπ55 - Stock: 30</option>
                            <option value="prod-4" data-price="120" data-stock="25">Tea Powder (250g) - ‚Çπ120 - Stock: 25</option>
                            <option value="prod-5" data-price="150" data-stock="20">Cooking Oil (1L) - ‚Çπ150 - Stock: 20</option>
                            <option value="prod-6" data-price="60" data-stock="15">Milk (1L) - ‚Çπ60 - Stock: 15</option>
                            <option value="prod-7" data-price="25" data-stock="40">Bread - ‚Çπ25 - Stock: 40</option>
                            <option value="prod-8" data-price="84" data-stock="30">Eggs (12 pcs) - ‚Çπ84 - Stock: 30</option>
                            <option value="prod-9" data-price="35" data-stock="50">Onions (1kg) - ‚Çπ35 - Stock: 50</option>
                            <option value="prod-10" data-price="25" data-stock="60">Potatoes (1kg) - ‚Çπ25 - Stock: 60</option>
                        </select>
                        <button class="add-product-btn" onclick="addSelectedProduct()">‚ûï Add to Bill</button>
                    </div>
                </div>
                
                <div class="quantity-price-section">
                    <div class="input-group">
                        <label for="productQuantity">Quantity:</label>
                        <input type="number" id="productQuantity" value="1" min="1" class="quantity-input">
                    </div>
                    <div class="input-group">
                        <label for="productPrice">Price:</label>
                        <input type="number" id="productPrice" step="0.01" class="price-input" readonly>
                    </div>
                    <div class="input-group">
                        <label for="totalAmount">Total:</label>
                        <input type="text" id="totalAmount" class="total-input" readonly>
                    </div>
                </div>
            </div>
            
            <!-- Selected Items Table -->
            <div class="selected-items-section">
                <h3 class="subsection-title">üìã Selected Items for Bill</h3>
                <div class="bill-table-container">
                    <table class="bill-table" id="billTable">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Total</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="billTableBody">
                            <!-- Selected items will be added here -->
                        </tbody>
                    </table>
                    
                    <div class="bill-summary">
                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <span id="billSubtotal">‚Çπ0.00</span>
                        </div>
                        <div class="summary-row">
                            <span>Tax (18%):</span>
                            <span id="billTax">‚Çπ0.00</span>
                        </div>
                        <div class="summary-row total-row">
                            <span>Total Amount:</span>
                            <span id="billTotal">‚Çπ0.00</span>
                        </div>
                    </div>
                    
                    <div class="bill-actions">
                        <button class="clear-bill-btn" onclick="clearBill()">üóëÔ∏è Clear Bill</button>
                        <button class="generate-bill-btn" onclick="generateBill()">üßæ Generate Bill</button>
                        <button class="print-bill-btn" onclick="printBill()">üñ®Ô∏è Print Bill</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="nav-buttons">
            <button class="nav-btn active" onclick="showSection('create-bill')">Create New Bill</button>
            <button class="nav-btn" onclick="showSection('view-bills')">View All Bills</button>
            <button class="nav-btn" onclick="showSection('quick-sale')">Quick Sale</button>
            <button class="nav-btn" onclick="showSection('reports')">Sales Reports</button>
            <button class="nav-btn" onclick="loadCustomers()">Manage Customers</button>
            <button class="nav-btn" onclick="loadProducts()">Manage Products</button>
        </div>

        <!-- Create Bill Section -->
        <div id="create-bill" class="section active">
            <h2>Create New Bill</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>Customer</label>
                    <select id="customer-select">
                        <option value="">Walk-in Customer</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Payment Method</label>
                    <select id="payment-method">
                        <option value="cash">Cash</option>
                        <option value="card">Card</option>
                        <option value="upi">UPI</option>
                        <option value="credit">Credit</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label>Search Products</label>
                <input type="text" id="product-search" placeholder="Search products by name or code..." onkeyup="searchProducts()">
            </div>

            <div id="product-results"></div>

            <div class="bill-items">
                <div class="item-row item-header">
                    <div>Product</div>
                    <div>Price</div>
                    <div>Quantity</div>
                    <div>Tax</div>
                    <div>Total</div>
                    <div>Action</div>
                </div>
                <div id="bill-items-list"></div>
            </div>

            <div class="bill-summary">
                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span id="subtotal">‚Çπ0.00</span>
                </div>
                <div class="summary-row">
                    <span>Tax (18%):</span>
                    <span id="tax-amount">‚Çπ0.00</span>
                </div>
                <div class="summary-row">
                    <span>Discount:</span>
                    <input type="number" id="discount" placeholder="0" onchange="calculateTotal()" style="width: 100px; text-align: right;">
                </div>
                <div class="summary-row total">
                    <span>Total Amount:</span>
                    <span id="total-amount">‚Çπ0.00</span>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <button class="btn" onclick="createBill()">Generate Bill</button>
                <button class="btn btn-secondary" onclick="clearBill()">Clear All</button>
            </div>
        </div>

        <!-- View Bills Section -->
        <div id="view-bills" class="section">
            <h2>All Bills</h2>
            
            <input type="text" class="search-box" id="bill-search" placeholder="Search bills by number, customer name..." onkeyup="filterBills()">
            
            <table class="table" id="bills-table">
                <thead>
                    <tr>
                        <th>Bill Number</th>
                        <th>Date</th>
                        <th>Customer</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="bills-tbody">
                </tbody>
            </table>
        </div>

        <!-- Quick Sale Section -->
        <div id="quick-sale" class="section">
            <h2>Quick Sale</h2>
            <p>For fast transactions without detailed billing</p>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>Amount</label>
                    <input type="number" id="quick-amount" placeholder="Enter amount">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <input type="text" id="quick-description" placeholder="Item description">
                </div>
                <div class="form-group">
                    <label>Payment Method</label>
                    <select id="quick-payment">
                        <option value="cash">Cash</option>
                        <option value="card">Card</option>
                        <option value="upi">UPI</option>
                    </select>
                </div>
            </div>
            
            <button class="btn" onclick="processQuickSale()">Process Quick Sale</button>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="section">
            <h2>Sales Reports</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>From Date</label>
                    <input type="date" id="report-from">
                </div>
                <div class="form-group">
                    <label>To Date</label>
                    <input type="date" id="report-to">
                </div>
                <div class="form-group">
                    <label>Report Type</label>
                    <select id="report-type">
                        <option value="daily">Daily Sales</option>
                        <option value="products">Product Sales</option>
                        <option value="customers">Customer Sales</option>
                    </select>
                </div>
            </div>
            
            <button class="btn" onclick="generateReport()">Generate Report</button>
            <button class="btn btn-secondary" onclick="exportReport()">Export to CSV</button>
            
            <div id="report-results"></div>
        </div>
    </div>

    <!-- Invoice Modal -->
    <div id="invoice-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeInvoice()">&times;</span>
            <button class="btn print-btn" onclick="printInvoice()">Print Invoice</button>
            <div id="invoice-content"></div>
        </div>
    </div>

    <script>
        let billItems = [];
        let products = [];
        let customers = [];
        let bills = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadProducts();
            loadCustomers();
            loadBills();
            setDefaultDates();
        });

        function setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('report-from').value = today;
            document.getElementById('report-to').value = today;
        }

        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }

        async function loadProducts() {
            try {
                const response = await fetch('/api/products');
                products = await response.json();
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        async function loadCustomers() {
            try {
                const response = await fetch('/api/customers');
                customers = await response.json();
                
                const customerSelect = document.getElementById('customer-select');
                customerSelect.innerHTML = '<option value="">Walk-in Customer</option>';
                
                customers.forEach(customer => {
                    const option = document.createElement('option');
                    option.value = customer.id;
                    option.textContent = `${customer.name} - ${customer.phone || 'No phone'}`;
                    customerSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading customers:', error);
            }
        }

        async function loadBills() {
            try {
                const response = await fetch('/api/bills');
                bills = await response.json();
                displayBills(bills);
            } catch (error) {
                console.error('Error loading bills:', error);
            }
        }

        function displayBills(billsToShow) {
            const tbody = document.getElementById('bills-tbody');
            tbody.innerHTML = '';
            
            billsToShow.forEach(bill => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${bill.bill_number}</td>
                    <td>${new Date(bill.created_at).toLocaleDateString()}</td>
                    <td>${bill.customer_name || 'Walk-in'}</td>
                    <td>‚Çπ${bill.total_amount.toFixed(2)}</td>
                    <td><span class="status-badge status-${bill.status}">${bill.status}</span></td>
                    <td>
                        <button class="btn btn-secondary" onclick="viewInvoice('${bill.id}')">View Invoice</button>
                        <button class="btn" onclick="printBill('${bill.id}')">Print</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function searchProducts() {
            const query = document.getElementById('product-search').value.toLowerCase();
            if (query.length < 2) {
                document.getElementById('product-results').innerHTML = '';
                return;
            }
            
            const filteredProducts = products.filter(product => 
                product.name.toLowerCase().includes(query) || 
                product.code.toLowerCase().includes(query)
            );
            
            const resultsDiv = document.getElementById('product-results');
            resultsDiv.innerHTML = '';
            
            filteredProducts.slice(0, 5).forEach(product => {
                const productDiv = document.createElement('div');
                productDiv.className = 'item-row';
                productDiv.style.cursor = 'pointer';
                productDiv.innerHTML = `
                    <div>${product.name} (${product.code})</div>
                    <div>‚Çπ${product.price}</div>
                    <div>Stock: ${product.stock}</div>
                    <div></div>
                    <div></div>
                    <div><button class="btn" onclick="addToBill('${product.id}')">Add</button></div>
                `;
                resultsDiv.appendChild(productDiv);
            });
        }

        function addToBill(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            // Check if product already in bill
            const existingItem = billItems.find(item => item.product_id === productId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                billItems.push({
                    product_id: productId,
                    product_name: product.name,
                    unit_price: product.price,
                    quantity: 1,
                    tax_rate: 18
                });
            }
            
            updateBillDisplay();
            document.getElementById('product-search').value = '';
            document.getElementById('product-results').innerHTML = '';
        }

        function updateBillDisplay() {
            const itemsList = document.getElementById('bill-items-list');
            itemsList.innerHTML = '';
            
            billItems.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item-row';
                
                const itemTotal = item.quantity * item.unit_price;
                const taxAmount = (itemTotal * item.tax_rate) / 100;
                const totalWithTax = itemTotal + taxAmount;
                
                itemDiv.innerHTML = `
                    <div>${item.product_name}</div>
                    <div>‚Çπ${item.unit_price.toFixed(2)}</div>
                    <div>
                        <input type="number" value="${item.quantity}" min="1" 
                               onchange="updateQuantity(${index}, this.value)" 
                               style="width: 60px;">
                    </div>
                    <div>‚Çπ${taxAmount.toFixed(2)}</div>
                    <div>‚Çπ${totalWithTax.toFixed(2)}</div>
                    <div>
                        <button class="btn btn-danger" onclick="removeFromBill(${index})">Remove</button>
                    </div>
                `;
                itemsList.appendChild(itemDiv);
            });
            
            calculateTotal();
        }

        function updateQuantity(index, quantity) {
            billItems[index].quantity = parseInt(quantity) || 1;
            updateBillDisplay();
        }

        function removeFromBill(index) {
            billItems.splice(index, 1);
            updateBillDisplay();
        }

        function calculateTotal() {
            let subtotal = 0;
            let totalTax = 0;
            
            billItems.forEach(item => {
                const itemTotal = item.quantity * item.unit_price;
                subtotal += itemTotal;
                totalTax += (itemTotal * item.tax_rate) / 100;
            });
            
            const discount = parseFloat(document.getElementById('discount').value) || 0;
            const finalTotal = subtotal + totalTax - discount;
            
            document.getElementById('subtotal').textContent = `‚Çπ${subtotal.toFixed(2)}`;
            document.getElementById('tax-amount').textContent = `‚Çπ${totalTax.toFixed(2)}`;
            document.getElementById('total-amount').textContent = `‚Çπ${finalTotal.toFixed(2)}`;
        }

        async function createBill() {
            if (billItems.length === 0) {
                alert('Please add items to the bill');
                return;
            }
            
            const customerId = document.getElementById('customer-select').value;
            const paymentMethod = document.getElementById('payment-method').value;
            const discount = parseFloat(document.getElementById('discount').value) || 0;
            
            let subtotal = 0;
            let totalTax = 0;
            
            const processedItems = billItems.map(item => {
                const itemTotal = item.quantity * item.unit_price;
                const taxAmount = (itemTotal * item.tax_rate) / 100;
                subtotal += itemTotal;
                totalTax += taxAmount;
                
                return {
                    product_id: item.product_id,
                    product_name: item.product_name,
                    quantity: item.quantity,
                    unit_price: item.unit_price,
                    total_price: itemTotal + taxAmount
                };
            });
            
            const billData = {
                customer_id: customerId || null,
                business_type: 'retail',
                items: processedItems,
                subtotal: subtotal,
                tax_amount: totalTax,
                discount_amount: discount,
                total_amount: subtotal + totalTax - discount,
                payment: {
                    method: paymentMethod,
                    amount: subtotal + totalTax - discount
                }
            };
            
            try {
                const response = await fetch('/api/bills', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(billData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showAlert('Bill created successfully! Bill Number: ' + result.bill_number, 'success');
                    clearBill();
                    loadBills();
                    
                    // Show invoice
                    setTimeout(() => {
                        viewInvoice(result.bill_id);
                    }, 1000);
                } else {
                    showAlert('Error creating bill: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('Error creating bill: ' + error.message, 'error');
            }
        }

        function clearBill() {
            billItems = [];
            document.getElementById('customer-select').value = '';
            document.getElementById('payment-method').value = 'cash';
            document.getElementById('discount').value = '';
            document.getElementById('product-search').value = '';
            document.getElementById('product-results').innerHTML = '';
            updateBillDisplay();
        }

        async function viewInvoice(billId) {
            try {
                // Find bill in our loaded bills
                const bill = bills.find(b => b.id === billId);
                if (!bill) {
                    alert('Bill not found');
                    return;
                }
                
                // Get bill items (you might need to create an API endpoint for this)
                const response = await fetch(`/api/bills/${billId}/items`);
                let billItems = [];
                if (response.ok) {
                    billItems = await response.json();
                }
                
                generateInvoiceHTML(bill, billItems);
                document.getElementById('invoice-modal').style.display = 'block';
            } catch (error) {
                console.error('Error viewing invoice:', error);
                alert('Error loading invoice');
            }
        }

        function generateInvoiceHTML(bill, items) {
            const customer = customers.find(c => c.id === bill.customer_id);
            const invoiceDate = new Date(bill.created_at).toLocaleDateString();
            
            const invoiceHTML = `
                <div class="invoice">
                    <div class="invoice-header">
                        <div class="company-info">
                            <h1>Retail Store</h1>
                            <p>123 Main Street, City</p>
                            <p>Phone: +91 9876543210</p>
                            <p>GST: 29ABCDE1234F1Z5</p>
                        </div>
                        <div class="invoice-details">
                            <h2>INVOICE</h2>
                            <p><strong>Bill No:</strong> ${bill.bill_number}</p>
                            <p><strong>Date:</strong> ${invoiceDate}</p>
                        </div>
                    </div>
                    
                    <div class="customer-info">
                        <h3>Bill To:</h3>
                        <p><strong>${customer ? customer.name : 'Walk-in Customer'}</strong></p>
                        ${customer ? `
                            <p>${customer.phone || ''}</p>
                            <p>${customer.email || ''}</p>
                            <p>${customer.address || ''}</p>
                        ` : ''}
                    </div>
                    
                    <table class="invoice-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Qty</th>
                                <th>Rate</th>
                                <th>Tax</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${items.map(item => `
                                <tr>
                                    <td>${item.product_name}</td>
                                    <td>${item.quantity}</td>
                                    <td>‚Çπ${item.unit_price.toFixed(2)}</td>
                                    <td>${item.tax_rate}%</td>
                                    <td>‚Çπ${item.total_price.toFixed(2)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div class="bill-summary">
                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <span>‚Çπ${bill.subtotal.toFixed(2)}</span>
                        </div>
                        <div class="summary-row">
                            <span>Tax:</span>
                            <span>‚Çπ${bill.tax_amount.toFixed(2)}</span>
                        </div>
                        ${bill.discount_amount > 0 ? `
                            <div class="summary-row">
                                <span>Discount:</span>
                                <span>-‚Çπ${bill.discount_amount.toFixed(2)}</span>
                            </div>
                        ` : ''}
                        <div class="summary-row total">
                            <span>Total Amount:</span>
                            <span>‚Çπ${bill.total_amount.toFixed(2)}</span>
                        </div>
                    </div>
                    
                    <div class="invoice-footer">
                        <p>Thank you for your business!</p>
                        <p>This is a computer generated invoice.</p>
                    </div>
                </div>
            `;
            
            document.getElementById('invoice-content').innerHTML = invoiceHTML;
        }

        function closeInvoice() {
            document.getElementById('invoice-modal').style.display = 'none';
        }

        function printInvoice() {
            window.print();
        }

        function printBill(billId) {
            viewInvoice(billId);
            setTimeout(() => {
                window.print();
            }, 500);
        }

        function filterBills() {
            const query = document.getElementById('bill-search').value.toLowerCase();
            const filteredBills = bills.filter(bill => 
                bill.bill_number.toLowerCase().includes(query) ||
                (bill.customer_name && bill.customer_name.toLowerCase().includes(query))
            );
            displayBills(filteredBills);
        }

        async function processQuickSale() {
            const amount = parseFloat(document.getElementById('quick-amount').value);
            const description = document.getElementById('quick-description').value;
            const paymentMethod = document.getElementById('quick-payment').value;
            
            if (!amount || !description) {
                alert('Please fill all fields');
                return;
            }
            
            const billData = {
                business_type: 'retail',
                items: [{
                    product_id: 'quick-sale',
                    product_name: description,
                    quantity: 1,
                    unit_price: amount,
                    total_price: amount
                }],
                subtotal: amount,
                tax_amount: 0,
                total_amount: amount,
                payment: {
                    method: paymentMethod,
                    amount: amount
                }
            };
            
            try {
                const response = await fetch('/api/bills', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(billData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showAlert('Quick sale processed! Bill Number: ' + result.bill_number, 'success');
                    document.getElementById('quick-amount').value = '';
                    document.getElementById('quick-description').value = '';
                    loadBills();
                } else {
                    showAlert('Error processing sale: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('Error processing sale: ' + error.message, 'error');
            }
        }

        async function generateReport() {
            const fromDate = document.getElementById('report-from').value;
            const toDate = document.getElementById('report-to').value;
            const reportType = document.getElementById('report-type').value;
            
            try {
                const response = await fetch(`/api/reports/sales?start_date=${fromDate}&end_date=${toDate}`);
                const reportData = await response.json();
                
                displayReport(reportData, reportType);
            } catch (error) {
                console.error('Error generating report:', error);
                showAlert('Error generating report', 'error');
            }
        }

        function displayReport(data, type) {
            const resultsDiv = document.getElementById('report-results');
            
            let html = '<h3>Sales Report</h3>';
            html += `<p><strong>Total Sales:</strong> ‚Çπ${data.total_sales.total.toFixed(2)} (${data.total_sales.count} transactions)</p>`;
            
            if (type === 'daily') {
                html += '<h4>Daily Breakdown:</h4>';
                html += '<table class="table"><thead><tr><th>Date</th><th>Sales</th><th>Transactions</th></tr></thead><tbody>';
                data.daily_sales.forEach(day => {
                    html += `<tr><td>${day.date}</td><td>‚Çπ${day.sales.toFixed(2)}</td><td>${day.transactions}</td></tr>`;
                });
                html += '</tbody></table>';
            } else if (type === 'products') {
                html += '<h4>Top Products:</h4>';
                html += '<table class="table"><thead><tr><th>Product</th><th>Quantity Sold</th><th>Revenue</th></tr></thead><tbody>';
                data.top_products.forEach(product => {
                    html += `<tr><td>${product.product_name}</td><td>${product.quantity}</td><td>‚Çπ${product.sales.toFixed(2)}</td></tr>`;
                });
                html += '</tbody></table>';
            }
            
            resultsDiv.innerHTML = html;
        }

        function exportReport() {
            // Simple CSV export functionality
            const fromDate = document.getElementById('report-from').value;
            const toDate = document.getElementById('report-to').value;
            
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Bill Number,Date,Customer,Amount,Status\n";
            
            bills.forEach(bill => {
                const billDate = new Date(bill.created_at).toLocaleDateString();
                if (billDate >= fromDate && billDate <= toDate) {
                    csvContent += `${bill.bill_number},${billDate},${bill.customer_name || 'Walk-in'},${bill.total_amount},${bill.status}\n`;
                }
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `sales_report_${fromDate}_to_${toDate}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            document.querySelector('.container').insertBefore(alertDiv, document.querySelector('.nav-buttons'));
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('invoice-modal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>    
<script>
        // Quick Billing Functionality
        let billItems = [];
        let billCounter = 1;
        
        // Product search functionality
        function searchProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const dropdown = document.getElementById('productDropdown');
            const options = dropdown.options;
            
            // Filter dropdown options based on search
            for (let i = 1; i < options.length; i++) {
                const optionText = options[i].text.toLowerCase();
                if (optionText.includes(searchTerm)) {
                    options[i].style.display = 'block';
                } else {
                    options[i].style.display = 'none';
                }
            }
            
            // Auto-select first matching option
            for (let i = 1; i < options.length; i++) {
                if (options[i].style.display !== 'none') {
                    dropdown.selectedIndex = i;
                    selectProduct();
                    break;
                }
            }
        }
        
        // Handle product selection from dropdown
        function selectProduct() {
            const dropdown = document.getElementById('productDropdown');
            const selectedOption = dropdown.options[dropdown.selectedIndex];
            
            if (selectedOption.value) {
                const price = parseFloat(selectedOption.getAttribute('data-price'));
                const stock = parseInt(selectedOption.getAttribute('data-stock'));
                
                document.getElementById('productPrice').value = price;
                updateTotalAmount();
                
                // Update quantity max based on stock
                const quantityInput = document.getElementById('productQuantity');
                quantityInput.max = stock;
                
                if (parseInt(quantityInput.value) > stock) {
                    quantityInput.value = stock;
                    updateTotalAmount();
                }
            } else {
                document.getElementById('productPrice').value = '';
                document.getElementById('totalAmount').value = '';
            }
        }
        
        // Update total amount when quantity changes
        document.getElementById('productQuantity').addEventListener('input', updateTotalAmount);
        
        function updateTotalAmount() {
            const quantity = parseInt(document.getElementById('productQuantity').value) || 0;
            const price = parseFloat(document.getElementById('productPrice').value) || 0;
            const total = quantity * price;
            
            document.getElementById('totalAmount').value = total > 0 ? `‚Çπ${total.toFixed(2)}` : '';
        }
        
        // Add selected product to bill
        function addSelectedProduct() {
            const dropdown = document.getElementById('productDropdown');
            const selectedOption = dropdown.options[dropdown.selectedIndex];
            
            if (!selectedOption.value) {
                alert('Please select a product first!');
                return;
            }
            
            const quantity = parseInt(document.getElementById('productQuantity').value);
            const price = parseFloat(document.getElementById('productPrice').value);
            const stock = parseInt(selectedOption.getAttribute('data-stock'));
            
            if (quantity <= 0) {
                alert('Please enter a valid quantity!');
                return;
            }
            
            if (quantity > stock) {
                alert(`Only ${stock} items available in stock!`);
                return;
            }
            
            const productName = selectedOption.text.split(' - ')[0]; // Extract product name
            const total = quantity * price;
            
            // Check if product already exists in bill
            const existingItemIndex = billItems.findIndex(item => item.productId === selectedOption.value);
            
            if (existingItemIndex !== -1) {
                // Update existing item
                billItems[existingItemIndex].quantity += quantity;
                billItems[existingItemIndex].total = billItems[existingItemIndex].quantity * price;
            } else {
                // Add new item
                billItems.push({
                    productId: selectedOption.value,
                    productName: productName,
                    price: price,
                    quantity: quantity,
                    total: total
                });
            }
            
            updateBillTable();
            clearProductSelection();
        }
        
        // Clear product selection form
        function clearProductSelection() {
            document.getElementById('productDropdown').selectedIndex = 0;
            document.getElementById('productQuantity').value = 1;
            document.getElementById('productPrice').value = '';
            document.getElementById('totalAmount').value = '';
            document.getElementById('productSearch').value = '';
        }
        
        // Update bill table display
        function updateBillTable() {
            const tbody = document.getElementById('billTableBody');
            tbody.innerHTML = '';
            
            let subtotal = 0;
            
            billItems.forEach((item, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${item.productName}</td>
                    <td>‚Çπ${item.price.toFixed(2)}</td>
                    <td>${item.quantity}</td>
                    <td>‚Çπ${item.total.toFixed(2)}</td>
                    <td>
                        <button class="remove-item-btn" onclick="removeItem(${index})">
                            üóëÔ∏è Remove
                        </button>
                    </td>
                `;
                
                subtotal += item.total;
            });
            
            // Update bill summary
            const tax = subtotal * 0.18; // 18% GST
            const total = subtotal + tax;
            
            document.getElementById('billSubtotal').textContent = `‚Çπ${subtotal.toFixed(2)}`;
            document.getElementById('billTax').textContent = `‚Çπ${tax.toFixed(2)}`;
            document.getElementById('billTotal').textContent = `‚Çπ${total.toFixed(2)}`;
        }
        
        // Remove item from bill
        function removeItem(index) {
            billItems.splice(index, 1);
            updateBillTable();
        }
        
        // Clear entire bill
        function clearBill() {
            if (billItems.length === 0) {
                alert('Bill is already empty!');
                return;
            }
            
            if (confirm('Are you sure you want to clear the entire bill?')) {
                billItems = [];
                updateBillTable();
                clearProductSelection();
            }
        }
        
        // Generate bill
        function generateBill() {
            if (billItems.length === 0) {
                alert('Please add some items to the bill first!');
                return;
            }
            
            const subtotal = billItems.reduce((sum, item) => sum + item.total, 0);
            const tax = subtotal * 0.18;
            const total = subtotal + tax;
            
            // Get customer and payment info
            const customerSelect = document.getElementById('customerSelect');
            const paymentMethod = document.getElementById('paymentMethod');
            const customerName = customerSelect.options[customerSelect.selectedIndex].text.split(' - ')[0];
            const paymentType = paymentMethod.options[paymentMethod.selectedIndex].text;
            
            const billData = {
                billNumber: `BILL-${new Date().toISOString().slice(0, 10).replace(/-/g, '')}-${String(billCounter).padStart(3, '0')}`,
                date: new Date().toLocaleString(),
                customer: customerName,
                paymentMethod: paymentType,
                items: billItems,
                subtotal: subtotal,
                tax: tax,
                total: total
            };
            
            console.log('Generated Bill:', billData);
            
            // Here you would typically send the bill data to your backend
            alert(`Bill Generated Successfully!\n\nBill Number: ${billData.billNumber}\nCustomer: ${customerName}\nPayment: ${paymentType}\nTotal Amount: ‚Çπ${total.toFixed(2)}\n\nBill data logged to console.`);
            
            billCounter++;
            
            // Optionally clear the bill after generation
            if (confirm('Bill generated! Do you want to clear the current bill?')) {
                clearBill();
            }
        }
        
        // Print bill
        function printBill() {
            if (billItems.length === 0) {
                alert('Please add some items to the bill first!');
                return;
            }
            
            const subtotal = billItems.reduce((sum, item) => sum + item.total, 0);
            const tax = subtotal * 0.18;
            const total = subtotal + tax;
            
            // Get customer and payment info
            const customerSelect = document.getElementById('customerSelect');
            const paymentMethod = document.getElementById('paymentMethod');
            const customerName = customerSelect.options[customerSelect.selectedIndex].text.split(' - ')[0];
            const paymentType = paymentMethod.options[paymentMethod.selectedIndex].text;
            
            // Create print content
            let printContent = `
                <div style="font-family: Arial, sans-serif; max-width: 400px; margin: 0 auto;">
                    <h2 style="text-align: center; margin-bottom: 20px;">üè™ Retail Store</h2>
                    <p style="text-align: center; margin-bottom: 20px;">Bill #BILL-${new Date().toISOString().slice(0, 10).replace(/-/g, '')}-${String(billCounter).padStart(3, '0')}</p>
                    <p style="text-align: center; margin-bottom: 10px;">Date: ${new Date().toLocaleString()}</p>
                    <p style="text-align: center; margin-bottom: 10px;">Customer: ${customerName}</p>
                    <p style="text-align: center; margin-bottom: 20px;">Payment: ${paymentType}</p>
                    <hr>
                    <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                        <thead>
                            <tr style="border-bottom: 1px solid #ddd;">
                                <th style="text-align: left; padding: 8px;">Item</th>
                                <th style="text-align: right; padding: 8px;">Qty</th>
                                <th style="text-align: right; padding: 8px;">Price</th>
                                <th style="text-align: right; padding: 8px;">Total</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            billItems.forEach(item => {
                printContent += `
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 8px;">${item.productName}</td>
                        <td style="text-align: right; padding: 8px;">${item.quantity}</td>
                        <td style="text-align: right; padding: 8px;">‚Çπ${item.price.toFixed(2)}</td>
                        <td style="text-align: right; padding: 8px;">‚Çπ${item.total.toFixed(2)}</td>
                    </tr>
                `;
            });
            
            printContent += `
                        </tbody>
                    </table>
                    <hr>
                    <div style="margin: 20px 0;">
                        <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                            <span>Subtotal:</span>
                            <span>‚Çπ${subtotal.toFixed(2)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                            <span>Tax (18%):</span>
                            <span>‚Çπ${tax.toFixed(2)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin: 10px 0; font-weight: bold; font-size: 1.2em; border-top: 1px solid #ddd; padding-top: 10px;">
                            <span>Total:</span>
                            <span>‚Çπ${total.toFixed(2)}</span>
                        </div>
                    </div>
                    <p style="text-align: center; margin-top: 30px; font-size: 0.9em;">Thank you for shopping with us!</p>
                </div>
            `;
            
            // Open print window
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Print Bill</title>
                    </head>
                    <body>
                        ${printContent}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        // Customer selection functionality
        function selectCustomer() {
            const customerSelect = document.getElementById('customerSelect');
            const selectedOption = customerSelect.options[customerSelect.selectedIndex];
            const customerInfo = document.getElementById('customerInfo');
            
            if (selectedOption.value === 'walk-in') {
                customerInfo.style.display = 'none';
            } else if (selectedOption.value === 'new-customer') {
                // Handle new customer addition
                const customerName = prompt('Enter customer name:');
                const customerPhone = prompt('Enter customer phone number:');
                const creditLimit = prompt('Enter credit limit (optional):') || '0';
                
                if (customerName && customerPhone) {
                    // Add new customer to dropdown
                    const newOption = document.createElement('option');
                    newOption.value = `cust-new-${Date.now()}`;
                    newOption.setAttribute('data-phone', customerPhone);
                    newOption.setAttribute('data-credit', creditLimit);
                    newOption.text = `${customerName} - ${customerPhone}`;
                    
                    // Insert before "Add New Customer" option
                    customerSelect.insertBefore(newOption, customerSelect.lastElementChild);
                    customerSelect.selectedIndex = customerSelect.options.length - 2;
                    
                    // Show customer info
                    document.getElementById('customerPhone').textContent = customerPhone;
                    document.getElementById('customerCredit').textContent = `‚Çπ${creditLimit}`;
                    customerInfo.style.display = 'flex';
                    
                    alert('New customer added successfully!');
                } else {
                    customerSelect.selectedIndex = 0; // Reset to walk-in
                }
            } else {
                // Show existing customer info
                const phone = selectedOption.getAttribute('data-phone');
                const credit = selectedOption.getAttribute('data-credit');
                
                document.getElementById('customerPhone').textContent = phone;
                document.getElementById('customerCredit').textContent = `‚Çπ${credit}`;
                customerInfo.style.display = 'flex';
            }
        }
        
        // Payment method selection functionality
        function selectPaymentMethod() {
            const paymentMethod = document.getElementById('paymentMethod');
            const selectedMethod = paymentMethod.value;
            
            // Handle different payment methods
            switch(selectedMethod) {
                case 'cash':
                    console.log('Cash payment selected');
                    break;
                case 'card':
                    console.log('Card payment selected');
                    break;
                case 'upi':
                    console.log('UPI payment selected');
                    break;
                case 'credit':
                    console.log('Store credit payment selected');
                    // Check if customer has sufficient credit
                    const customerSelect = document.getElementById('customerSelect');
                    const selectedCustomer = customerSelect.options[customerSelect.selectedIndex];
                    
                    if (selectedCustomer.value === 'walk-in') {
                        alert('Store credit not available for walk-in customers. Please select a registered customer.');
                        paymentMethod.selectedIndex = 0; // Reset to cash
                    }
                    break;
                case 'mixed':
                    console.log('Mixed payment selected');
                    break;
            }
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Billing Management System Loaded');
        });
    </script>
</body>
</html>