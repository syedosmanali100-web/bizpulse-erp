<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BizPulse Mobile ERP</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #F7E8EC 0%, #E8D5DA 100%);
            min-height: 100vh;
            padding-bottom: 80px;
        }
        
        /* Top Header */
        .top-header {
            background: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
        }
        
        .menu-btn {
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            background: #732C3F;
            color: white;
            border-radius: 8px;
            border: none;
            transition: all 0.2s;
        }
        
        .menu-btn:active {
            transform: scale(0.95);
        }
        
        .logo {
            font-size: 20px;
            font-weight: bold;
            color: #732C3F;
        }
        
        .profile-btn {
            width: 40px;
            height: 40px;
            background: #732C3F;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        
        .profile-btn:active {
            transform: scale(0.95);
        }
        
        /* Side Menu */
        .side-menu {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100vh;
            background: #732C3F;
            transition: left 0.3s ease;
            z-index: 200;
            overflow-y: auto;
            color: white;
        }
        
        .side-menu.open {
            left: 0;
        }
        
        .menu-header {
            padding: 30px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        
        .menu-header h3 {
            margin-bottom: 5px;
            font-size: 22px;
        }
        
        .menu-header p {
            opacity: 0.8;
            font-size: 14px;
        }
        
        .menu-section {
            padding: 10px 0;
        }
        
        .menu-section-title {
            padding: 10px 20px;
            font-size: 12px;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .menu-item {
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s;
        }
        
        .menu-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .menu-item:active {
            background: rgba(255,255,255,0.2);
        }
        
        .menu-item-icon {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }
        
        .logout-item {
            background: rgba(255,255,255,0.1);
            margin: 10px 15px;
            border-radius: 8px;
        }
        
        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 150;
        }
        
        .overlay.show {
            display: block;
        }
        
        /* Main Content */
        .main-content {
            padding: 80px 20px 20px 20px;
        }
        
        /* Welcome Card */
        .welcome-card {
            background: linear-gradient(135deg, #732C3F 0%, #8B4A5C 100%);
            color: white;
            padding: 25px 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(115, 44, 63, 0.3);
        }
        
        .welcome-card h2 {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .welcome-card p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: white;
            padding: 20px 15px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            text-align: center;
            transition: transform 0.2s;
            cursor: pointer;
        }
        
        .stat-card:active {
            transform: scale(0.98);
        }
        
        .stat-icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #732C3F;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }
        
        .stat-change {
            font-size: 11px;
            color: #4CAF50;
            margin-top: 5px;
        }
        
        /* Section Title */
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #732C3F;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .action-btn {
            background: white;
            padding: 20px 10px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            transition: all 0.2s;
            border: none;
            text-decoration: none;
            color: inherit;
        }
        
        .action-btn:active {
            transform: scale(0.95);
        }
        
        .action-icon {
            font-size: 28px;
            margin-bottom: 8px;
            display: block;
        }
        
        .action-label {
            font-size: 12px;
            color: #732C3F;
            font-weight: 600;
        }
        
        /* Module Container */
        .module-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            display: none;
        }
        
        .module-container.active {
            display: block;
        }
        
        .module-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #F7E8EC;
        }
        
        .module-title {
            font-size: 20px;
            font-weight: bold;
            color: #732C3F;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .back-btn {
            background: #666;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .back-btn:active {
            transform: scale(0.95);
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 10px 5px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.3s;
            flex: 1;
            max-width: 80px;
        }
        
        .nav-item.active {
            background: #F7E8EC;
            color: #732C3F;
        }
        
        .nav-item:active {
            transform: scale(0.95);
        }
        
        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }
        
        .nav-label {
            font-size: 10px;
            font-weight: 500;
        }
        
        /* Special Billing Button */
        .nav-item.billing-btn {
            background: linear-gradient(135deg, #732C3F 0%, #8B3A47 100%);
            color: white;
            padding: 12px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(114, 47, 55, 0.3);
            flex: 1.2;
            max-width: 95px;
        }
        
        .nav-item.billing-btn .nav-icon {
            font-size: 24px;
        }
        
        .nav-item.billing-btn .nav-label {
            color: white;
            font-weight: 700;
        }
        
        /* Loading State */
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #732C3F;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Error Message */
        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
        }
        
        /* Success Message */
        .success-message {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
        }
        
        /* Mobile Billing Styles */
        .billing-interface {
            padding: 0;
        }
        
        .billing-section {
            margin-bottom: 20px;
        }
        
        .billing-section h3 {
            font-size: 16px;
            font-weight: 600;
            color: #732C3F;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .customer-selector {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .customer-selector select {
            flex: 1;
        }
        
        .add-customer-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .product-search {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .product-search input {
            flex: 1;
        }
        
        .barcode-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            width: 48px;
            height: 48px;
        }
        
        .product-suggestions {
            margin-top: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 200px;
            overflow-y: auto;
        }
        
        .product-suggestion {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }
        
        .product-suggestion:hover {
            background: #F7E8EC;
        }
        
        .product-suggestion:last-child {
            border-bottom: none;
        }
        
        .suggestion-info {
            flex: 1;
        }
        
        .suggestion-name {
            font-weight: 600;
            color: #732C3F;
            margin-bottom: 4px;
        }
        
        .suggestion-details {
            font-size: 12px;
            color: #666;
        }
        
        .suggestion-price {
            font-weight: bold;
            color: #4CAF50;
            font-size: 16px;
        }
        
        .bill-items {
            background: white;
            border-radius: 12px;
            padding: 15px;
            min-height: 120px;
        }
        
        .empty-bill {
            text-align: center;
            padding: 30px 20px;
            color: #666;
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 10px;
            opacity: 0.5;
        }
        
        .bill-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .bill-item:last-child {
            border-bottom: none;
        }
        
        .item-info {
            flex: 1;
            min-width: 0;
        }
        
        .item-name {
            font-weight: 600;
            color: #732C3F;
            margin-bottom: 4px;
            font-size: 14px;
        }
        
        .item-price {
            font-size: 12px;
            color: #666;
        }
        
        .item-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #F7E8EC;
            border-radius: 8px;
            padding: 4px;
        }
        
        .qty-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: #732C3F;
            color: white;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .qty-display {
            min-width: 30px;
            text-align: center;
            font-weight: 600;
            color: #732C3F;
        }
        
        .item-total {
            font-weight: bold;
            color: #4CAF50;
            font-size: 16px;
            min-width: 70px;
            text-align: right;
        }
        
        .remove-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: #f44336;
            color: white;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .bill-summary {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #732C3F;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            font-size: 16px;
        }
        
        .summary-row.total {
            border-top: 2px solid #E8D5DA;
            margin-top: 10px;
            padding-top: 15px;
            font-size: 20px;
            font-weight: bold;
            color: #732C3F;
        }
        
        .payment-methods {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .payment-btn {
            flex: 1;
            padding: 12px 8px;
            border: 2px solid #E8D5DA;
            background: white;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        
        .payment-btn.active {
            background: #732C3F;
            color: white;
            border-color: #732C3F;
        }
        
        .billing-actions {
            display: flex;
            gap: 12px;
        }
        
        .action-btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .action-btn.secondary {
            background: #f5f5f5;
            color: #666;
        }
        
        .action-btn.primary {
            background: linear-gradient(135deg, #732C3F 0%, #8B4A5C 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(115, 44, 63, 0.3);
        }
        
        .action-btn:active {
            transform: scale(0.98);
        }
        
        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 2px solid #E8D5DA;
        }
        
        .modal-header h3 {
            font-size: 20px;
            font-weight: bold;
            color: #732C3F;
            margin: 0;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            color: #666;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 18px;
        }
        
        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #732C3F;
            margin-bottom: 8px;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #E8D5DA;
            border-radius: 10px;
            font-size: 14px;
            background: white;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #732C3F;
        }
        
        .btn-primary {
            width: 100%;
            background: linear-gradient(135deg, #732C3F 0%, #8B4A5C 100%);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-primary:active {
            transform: scale(0.98);
        }
        
        /* Responsive */
        @media (max-width: 480px) {
            .stats-grid {
                gap: 10px;
            }
            
            .quick-actions {
                gap: 8px;
            }
            
            .action-btn {
                padding: 15px 8px;
            }
            
            .action-icon {
                font-size: 24px;
            }
            
            .billing-actions {
                flex-direction: column;
            }
            
            .payment-methods {
                flex-direction: column;
            }
            
            .item-controls {
                flex-direction: column;
                gap: 4px;
            }
        }
    </style>
</head>
<body>
    <!-- Top Header -->
    <div class="top-header">
        <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
        <div class="logo">BizPulse Mobile</div>
        <button class="profile-btn" onclick="showProfile()">üë§</button>
    </div>
    
    <!-- Side Menu -->
    <div class="side-menu" id="sideMenu">
        <div class="menu-header">
            <h3>BizPulse Mobile</h3>
            <p id="userEmail">Loading...</p>
        </div>
        
        <!-- Core Modules -->
        <div class="menu-section">
            <div class="menu-section-title">Core</div>
            <div class="menu-item" onclick="showModule('dashboard')">
                <span class="menu-item-icon">üè†</span>
                <span>Dashboard</span>
            </div>
            <div class="menu-item" onclick="showModule('billing')">
                <span class="menu-item-icon">üßæ</span>
                <span>Billing</span>
            </div>
            <div class="menu-item" onclick="showModule('sales')">
                <span class="menu-item-icon">üí∞</span>
                <span>Sales</span>
            </div>
            <div class="menu-item" onclick="showModule('invoices')">
                <span class="menu-item-icon">üìÑ</span>
                <span>Invoices</span>
            </div>
        </div>
        
        <!-- Inventory Modules -->
        <div class="menu-section">
            <div class="menu-section-title">Inventory</div>
            <div class="menu-item" onclick="showModule('products')">
                <span class="menu-item-icon">üì¶</span>
                <span>Products</span>
            </div>
            <div class="menu-item" onclick="showModule('inventory')">
                <span class="menu-item-icon">üìä</span>
                <span>Inventory</span>
            </div>
            <div class="menu-item" onclick="showModule('barcode')">
                <span class="menu-item-icon">üì∑</span>
                <span>Barcode Scanner</span>
            </div>
        </div>
        
        <!-- Customer Modules -->
        <div class="menu-section">
            <div class="menu-section-title">Customer</div>
            <div class="menu-item" onclick="showModule('customers')">
                <span class="menu-item-icon">üë•</span>
                <span>Customers</span>
            </div>
        </div>
        
        <!-- Analytics -->
        <div class="menu-section">
            <div class="menu-section-title">Analytics</div>
            <div class="menu-item" onclick="showModule('earnings')">
                <span class="menu-item-icon">üíé</span>
                <span>Earnings & Profit</span>
            </div>
            <div class="menu-item" onclick="showModule('reports')">
                <span class="menu-item-icon">üìà</span>
                <span>Reports</span>
            </div>
        </div>
        
        <!-- Advanced Modules -->
        <div class="menu-section">
            <div class="menu-section-title">Advanced</div>
            <div class="menu-item" onclick="showModule('client-management')">
                <span class="menu-item-icon">üè¢</span>
                <span>Client Management</span>
            </div>
            <div class="menu-item" onclick="showModule('user-management')">
                <span class="menu-item-icon">üë•</span>
                <span>User Management</span>
            </div>
            <div class="menu-item" onclick="showModule('staff-management')">
                <span class="menu-item-icon">üë®‚Äçüíº</span>
                <span>Staff Management</span>
            </div>
            <div class="menu-item" onclick="showModule('whatsapp-reports')">
                <span class="menu-item-icon">üì±</span>
                <span>WhatsApp Reports</span>
            </div>
        </div>
        
        <!-- System -->
        <div class="menu-section">
            <div class="menu-section-title">System</div>
            <div class="menu-item" onclick="showModule('settings')">
                <span class="menu-item-icon">‚öôÔ∏è</span>
                <span>Settings</span>
            </div>
            <div class="menu-item logout-item" onclick="logout()">
                <span class="menu-item-icon">üö™</span>
                <span>Logout</span>
            </div>
        </div>
    </div>
    
    <!-- Overlay -->
    <div class="overlay" id="overlay" onclick="closeMenu()"></div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard Module -->
        <div class="module-container active" id="dashboardModule">
            <!-- Welcome Card -->
            <div class="welcome-card">
                <h2>Welcome Back! üëã</h2>
                <p>Here's your business overview for today</p>
            </div>
            
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card" onclick="showModule('sales')">
                    <span class="stat-icon">üí∞</span>
                    <div class="stat-value" id="totalSales">‚Çπ0</div>
                    <div class="stat-label">Today's Sales</div>
                    <div class="stat-change">+12% from yesterday</div>
                </div>
                
                <div class="stat-card" onclick="showModule('billing')">
                    <span class="stat-icon">üßæ</span>
                    <div class="stat-value" id="totalBills">0</div>
                    <div class="stat-label">Bills Created</div>
                    <div class="stat-change">+5 new today</div>
                </div>
                
                <div class="stat-card" onclick="showModule('products')">
                    <span class="stat-icon">üì¶</span>
                    <div class="stat-value" id="totalProducts">0</div>
                    <div class="stat-label">Products</div>
                    <div class="stat-change">2 low stock</div>
                </div>
                
                <div class="stat-card" onclick="showModule('customers')">
                    <span class="stat-icon">üë•</span>
                    <div class="stat-value" id="totalCustomers">0</div>
                    <div class="stat-label">Customers</div>
                    <div class="stat-change">3 new this week</div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <h3 class="section-title">‚ö° Quick Actions</h3>
            <div class="quick-actions">
                <button class="action-btn" onclick="showModule('billing')">
                    <span class="action-icon">üßæ</span>
                    <div class="action-label">New Bill</div>
                </button>
                
                <button class="action-btn" onclick="showModule('products')">
                    <span class="action-icon">üì¶</span>
                    <div class="action-label">Products</div>
                </button>
                
                <button class="action-btn" onclick="showModule('customers')">
                    <span class="action-icon">üë•</span>
                    <div class="action-label">Customers</div>
                </button>
                
                <button class="action-btn" onclick="showModule('sales')">
                    <span class="action-icon">üí∞</span>
                    <div class="action-label">Sales</div>
                </button>
                
                <button class="action-btn" onclick="showModule('inventory')">
                    <span class="action-icon">üìä</span>
                    <div class="action-label">Inventory</div>
                </button>
                
                <button class="action-btn" onclick="showModule('barcode')">
                    <span class="action-icon">üì∑</span>
                    <div class="action-label">Scan Code</div>
                </button>
            </div>
        </div>
        
        <!-- Products Module -->
        <div class="module-container" id="productsModule">
            <div class="module-header">
                <div class="module-title">üì¶ Products</div>
                <button class="back-btn" onclick="showModule('dashboard')">‚Üê Back</button>
            </div>
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading products...</p>
            </div>
        </div>
        
        <!-- Billing Module -->
        <div class="module-container" id="billingModule">
            <div class="module-header">
                <div class="module-title">üßæ Billing</div>
                <button class="back-btn" onclick="showModule('dashboard')">‚Üê Back</button>
            </div>
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading billing...</p>
            </div>
        </div>
        
        <!-- Customers Module -->
        <div class="module-container" id="customersModule">
            <div class="module-header">
                <div class="module-title">üë• Customers</div>
                <button class="back-btn" onclick="showModule('dashboard')">‚Üê Back</button>
            </div>
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading customers...</p>
            </div>
        </div>
        
        <!-- Sales Module -->
        <div class="module-container" id="salesModule">
            <div class="module-header">
                <div class="module-title">üí∞ Sales</div>
                <button class="back-btn" onclick="showModule('dashboard')">‚Üê Back</button>
            </div>
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading sales...</p>
            </div>
        </div>
        
        <!-- Invoices Module -->
        <div class="module-container" id="invoicesModule">
            <div class="module-header">
                <div class="module-title">üìÑ Invoices</div>
                <button class="back-btn" onclick="showModule('dashboard')">‚Üê Back</button>
            </div>
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading invoices...</p>
            </div>
        </div>
        
        <!-- Inventory Module -->
        <div class="module-container" id="inventoryModule">
            <div class="module-header">
                <div class="module-title">üìä Inventory</div>
                <button class="back-btn" onclick="showModule('dashboard')">‚Üê Back</button>
            </div>
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading inventory...</p>
            </div>
        </div>
        
        <!-- Barcode Scanner Module -->
        <div class="module-container" id="barcodeModule">
            <div class="module-header">
                <div class="module-title">üì∑ Barcode Scanner</div>
                <button class="back-btn" onclick="showModule('dashboard')">‚Üê Back</button>
            </div>
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Initializing camera...</p>
            </div>
        </div>
        
        <!-- Earnings Module -->
        <div class="module-container" id="earningsModule">
            <div class="module-header">
                <div class="module-title">üíé Earnings & Profit</div>
                <button class="back-btn" onclick="showModule('dashboard')">‚Üê Back</button>
            </div>
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading earnings...</p>
            </div>
        </div>
        
        <!-- Reports Module -->
        <div class="module-container" id="reportsModule">
            <div class="module-header">
                <div class="module-title">üìà Reports</div>
                <button class="back-btn" onclick="showModule('dashboard')">‚Üê Back</button>
            </div>
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading reports...</p>
            </div>
        </div>
        
        <!-- Settings Module -->
        <div class="module-container" id="settingsModule">
            <div class="module-header">
                <div class="module-title">‚öôÔ∏è Settings</div>
                <button class="back-btn" onclick="showModule('dashboard')">‚Üê Back</button>
            </div>
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading settings...</p>
            </div>
        </div>
        
        <!-- Advanced Modules -->
        <div class="module-container" id="clientManagementModule">
            <div class="module-header">
                <div class="module-title">üè¢ Client Management</div>
                <button class="back-btn" onclick="showModule('dashboard')">‚Üê Back</button>
            </div>
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading client management...</p>
            </div>
        </div>
        
        <div class="module-container" id="userManagementModule">
            <div class="module-header">
                <div class="module-title">üë• User Management</div>
                <button class="back-btn" onclick="showModule('dashboard')">‚Üê Back</button>
            </div>
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading user management...</p>
            </div>
        </div>
        
        <div class="module-container" id="staffManagementModule">
            <div class="module-header">
                <div class="module-title">üë®‚Äçüíº Staff Management</div>
                <button class="back-btn" onclick="showModule('dashboard')">‚Üê Back</button>
            </div>
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading staff management...</p>
            </div>
        </div>
        
        <div class="module-container" id="whatsappReportsModule">
            <div class="module-header">
                <div class="module-title">üì± WhatsApp Reports</div>
                <button class="back-btn" onclick="showModule('dashboard')">‚Üê Back</button>
            </div>
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading WhatsApp reports...</p>
            </div>
        </div>
    </div>
    
    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="showModule('dashboard')">
            <span class="nav-icon">üè†</span>
            <span class="nav-label">Home</span>
        </div>
        
        <div class="nav-item" onclick="showModule('products')">
            <span class="nav-icon">üì¶</span>
            <span class="nav-label">Products</span>
        </div>
        
        <div class="nav-item billing-btn" onclick="showModule('billing')">
            <span class="nav-icon">üßæ</span>
            <span class="nav-label">BILLING</span>
        </div>
        
        <div class="nav-item" onclick="showModule('sales')">
            <span class="nav-icon">üí∞</span>
            <span class="nav-label">Sales</span>
        </div>
        
        <div class="nav-item" onclick="showModule('earnings')">
            <span class="nav-icon">üíé</span>
            <span class="nav-label">Earnings</span>
        </div>
    </div>
    
    <script>
        // API Base URL
        const API_BASE_URL = window.location.origin;
        
        // Current module tracking
        let currentModule = 'dashboard';
        
        // Helper function for API calls
        async function apiCall(endpoint, options = {}) {
            try {
                const url = `${API_BASE_URL}${endpoint}`;
                options.credentials = options.credentials || 'same-origin';
                const response = await fetch(url, options);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }
        
        // Initialize Dashboard
        async function initializeDashboard() {
            console.log('üöÄ Initializing Mobile ERP Dashboard...');
            
            try {
                // Load user info
                const userInfo = await apiCall('/api/auth/user-info');
                document.getElementById('userEmail').textContent = userInfo.user_name || 'User';
                
                // Load dashboard data
                await loadDashboardData();
                
                console.log('‚úÖ Dashboard initialized successfully');
            } catch (error) {
                console.error('‚ùå Dashboard initialization failed:', error);
                showError('Failed to initialize dashboard. Please refresh the page.');
            }
        }
        
        // Load Dashboard Data
        async function loadDashboardData() {
            try {
                // Use mobile dashboard API if available, otherwise use individual APIs
                let dashboardData;
                try {
                    dashboardData = await apiCall('/api/mobile/dashboard');
                } catch (error) {
                    // Fallback to individual API calls
                    const [products, customers, sales] = await Promise.all([
                        apiCall('/api/products'),
                        apiCall('/api/customers'),
                        apiCall('/api/sales/summary')
                    ]);
                    
                    dashboardData = {
                        products_count: products.length,
                        customers_count: customers.length,
                        today_sales: {
                            total: sales.today?.total || 0,
                            count: sales.today?.count || 0
                        }
                    };
                }
                
                // Update stats
                document.getElementById('totalProducts').textContent = dashboardData.products_count || 0;
                document.getElementById('totalCustomers').textContent = dashboardData.customers_count || 0;
                document.getElementById('totalSales').textContent = '‚Çπ' + (dashboardData.today_sales?.total || 0).toFixed(0);
                document.getElementById('totalBills').textContent = dashboardData.today_sales?.count || 0;
                
            } catch (error) {
                console.error('‚ùå Failed to load dashboard data:', error);
                showError('Failed to load dashboard data');
            }
        }
        
        // Show Module
        function showModule(module) {
            console.log('üì± Switching to module:', module);
            
            // Hide all modules
            const allModules = document.querySelectorAll('.module-container');
            allModules.forEach(mod => {
                mod.classList.remove('active');
            });
            
            // Update bottom navigation
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected module
            const moduleElement = document.getElementById(module + 'Module');
            if (moduleElement) {
                moduleElement.classList.add('active');
                currentModule = module;
                
                // Load module data
                loadModuleData(module);
            }
            
            // Update active nav item
            const activeNavItem = document.querySelector(`[onclick="showModule('${module}')"]`);
            if (activeNavItem && activeNavItem.classList.contains('nav-item')) {
                activeNavItem.classList.add('active');
            }
            
            // Close menu
            closeMenu();
        }
        
        // Load Module Data
        async function loadModuleData(module) {
            const moduleElement = document.getElementById(module + 'Module');
            if (!moduleElement) return;
            
            // Show loading state
            const loadingElement = moduleElement.querySelector('.loading');
            if (loadingElement) {
                loadingElement.style.display = 'block';
            }
            
            try {
                switch (module) {
                    case 'dashboard':
                        await loadDashboardData();
                        break;
                    case 'products':
                        await loadProductsModule();
                        break;
                    case 'billing':
                        await loadBillingModule();
                        break;
                    case 'customers':
                        await loadCustomersModule();
                        break;
                    case 'sales':
                        await loadSalesModule();
                        break;
                    case 'invoices':
                        await loadInvoicesModule();
                        break;
                    case 'inventory':
                        await loadInventoryModule();
                        break;
                    case 'barcode':
                        await loadBarcodeModule();
                        break;
                    case 'earnings':
                        await loadEarningsModule();
                        break;
                    case 'reports':
                        await loadReportsModule();
                        break;
                    case 'settings':
                        await loadSettingsModule();
                        break;
                    default:
                        // Advanced modules - show coming soon
                        showComingSoon(module);
                        break;
                }
            } catch (error) {
                console.error(`‚ùå Failed to load ${module} module:`, error);
                showModuleError(module, error.message);
            }
        }
        
        // Load individual modules (placeholder functions)
        async function loadProductsModule() {
            console.log('üì¶ Loading Products Module...');
            
            try {
                const products = await apiCall('/api/products');
                
                const productsModule = document.getElementById('productsModule');
                productsModule.innerHTML = `
                    <div class="module-header">
                        <div class="module-title">üì¶ Products (${products.length})</div>
                        <button class="back-btn" onclick="showModule('dashboard')">‚Üê Back</button>
                    </div>
                    
                    <!-- Add Product Button -->
                    <div style="padding: 15px; background: white; margin-bottom: 15px; border-radius: 12px;">
                        <button onclick="showAddProductModal()" style="width: 100%; background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); color: white; border: none; padding: 14px; border-radius: 10px; font-size: 16px; font-weight: 600;">
                            ‚ûï Add New Product
                        </button>
                    </div>
                    
                    <!-- Search Products -->
                    <div style="padding: 15px; background: white; margin-bottom: 15px; border-radius: 12px;">
                        <input type="text" id="productSearchInput" placeholder="Search products..." style="width: 100%; padding: 12px; border: 2px solid #E8D5DA; border-radius: 8px; font-size: 14px;" onkeyup="filterProducts()">
                    </div>
                    
                    <!-- Products List -->
                    <div id="productsList">
                        ${products.map(product => `
                            <div class="product-card" data-name="${product.name.toLowerCase()}" data-code="${product.code.toLowerCase()}">
                                <div class="product-icon">üì¶</div>
                                <div class="product-info">
                                    <div class="product-name">${product.name}</div>
                                    <div class="product-details">Code: ${product.code} | Category: ${product.category || 'General'}</div>
                                    <div class="product-stock ${product.stock > product.min_stock ? 'stock-good' : product.stock > 0 ? 'stock-low' : 'stock-out'}">
                                        Stock: ${product.stock} ${product.unit || 'pcs'}
                                    </div>
                                </div>
                                <div class="product-price">
                                    <div class="price-value">‚Çπ${product.price}</div>
                                    <div class="product-actions">
                                        <button class="action-btn btn-edit" onclick="editProduct('${product.id}')">‚úèÔ∏è</button>
                                        <button class="action-btn btn-delete" onclick="deleteProduct('${product.id}')">üóëÔ∏è</button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <!-- Add Product Modal -->
                    <div id="addProductModal" class="modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3>Add New Product</h3>
                                <button class="modal-close" onclick="closeAddProductModal()">√ó</button>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                    <label>Product Name *</label>
                                    <input type="text" id="newProductName" class="form-input" placeholder="Enter product name">
                                </div>
                                <div class="form-group">
                                    <label>Product Code</label>
                                    <input type="text" id="newProductCode" class="form-input" placeholder="Enter product code">
                                </div>
                                <div class="form-group">
                                    <label>Category</label>
                                    <input type="text" id="newProductCategory" class="form-input" placeholder="Enter category">
                                </div>
                                <div class="form-group">
                                    <label>Price *</label>
                                    <input type="number" id="newProductPrice" class="form-input" placeholder="Enter price" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label>Cost Price</label>
                                    <input type="number" id="newProductCost" class="form-input" placeholder="Enter cost price" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label>Stock Quantity</label>
                                    <input type="number" id="newProductStock" class="form-input" placeholder="Enter stock quantity">
                                </div>
                                <div class="form-group">
                                    <label>Unit</label>
                                    <select id="newProductUnit" class="form-select">
                                        <option value="piece">Piece</option>
                                        <option value="kg">Kilogram</option>
                                        <option value="liter">Liter</option>
                                        <option value="meter">Meter</option>
                                        <option value="box">Box</option>
                                    </select>
                                </div>
                                <button class="btn-primary" onclick="addNewProduct()">Add Product</button>
                            </div>
                        </div>
                    </div>
                `;
                
                console.log('‚úÖ Products module loaded successfully');
            } catch (error) {
                console.error('‚ùå Failed to load products:', error);
                showModuleError('products', error.message);
            }
        }
        
        async function loadBillingModule() {
            console.log('üßæ Loading Mobile Billing Module...');
            
            const billingModule = document.getElementById('billingModule');
            billingModule.innerHTML = `
                <div class="module-header">
                    <div class="module-title">üßæ Mobile Billing</div>
                    <button class="back-btn" onclick="showModule('dashboard')">‚Üê Back</button>
                </div>
                
                <!-- Billing Interface -->
                <div class="billing-interface">
                    <!-- Customer Selection -->
                    <div class="billing-section">
                        <h3 class="section-title">üë§ Customer</h3>
                        <div class="customer-selector">
                            <select id="customerSelect" class="form-select">
                                <option value="">Select Customer</option>
                            </select>
                            <button class="add-customer-btn" onclick="showAddCustomerModal()">+ Add</button>
                        </div>
                    </div>
                    
                    <!-- Product Search & Add -->
                    <div class="billing-section">
                        <h3 class="section-title">üì¶ Add Products</h3>
                        <div class="product-search">
                            <input type="text" id="productSearch" placeholder="Search products..." class="form-input">
                            <button class="barcode-btn" onclick="openBarcodeScanner()">üì∑</button>
                        </div>
                        <div id="productSuggestions" class="product-suggestions"></div>
                    </div>
                    
                    <!-- Bill Items -->
                    <div class="billing-section">
                        <h3 class="section-title">üßæ Bill Items</h3>
                        <div id="billItems" class="bill-items">
                            <div class="empty-bill">
                                <div class="empty-icon">üõí</div>
                                <p>No items added yet</p>
                                <small>Search and add products above</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bill Summary -->
                    <div class="billing-section">
                        <div class="bill-summary">
                            <div class="summary-row">
                                <span>Subtotal:</span>
                                <span id="subtotal">‚Çπ0.00</span>
                            </div>
                            <div class="summary-row">
                                <span>Tax (10%):</span>
                                <span id="taxAmount">‚Çπ0.00</span>
                            </div>
                            <div class="summary-row total">
                                <span>Total:</span>
                                <span id="totalAmount">‚Çπ0.00</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Payment & Actions -->
                    <div class="billing-section">
                        <div class="payment-methods">
                            <button class="payment-btn active" data-method="cash">üíµ Cash</button>
                            <button class="payment-btn" data-method="card">üí≥ Card</button>
                            <button class="payment-btn" data-method="upi">üì± UPI</button>
                        </div>
                        
                        <div class="billing-actions">
                            <button class="action-btn secondary" onclick="clearBill()">üóëÔ∏è Clear</button>
                            <button class="action-btn primary" onclick="processBill()">üí∞ Process Bill</button>
                        </div>
                    </div>
                </div>
                
                <!-- Add Customer Modal -->
                <div id="addCustomerModal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Add New Customer</h3>
                            <button class="modal-close" onclick="closeAddCustomerModal()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>Customer Name *</label>
                                <input type="text" id="newCustomerName" class="form-input" placeholder="Enter customer name">
                            </div>
                            <div class="form-group">
                                <label>Phone Number</label>
                                <input type="tel" id="newCustomerPhone" class="form-input" placeholder="Enter phone number">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="newCustomerEmail" class="form-input" placeholder="Enter email">
                            </div>
                            <button class="btn-primary" onclick="addNewCustomer()">Add Customer</button>
                        </div>
                    </div>
                </div>
            `;
            
            // Initialize billing data
            await initializeBilling();
        }
        
        // Billing Variables
        let billItems = [];
        let selectedCustomer = null;
        let selectedPaymentMethod = 'cash';
        
        // Initialize Billing
        async function initializeBilling() {
            try {
                // Load customers
                await loadCustomersForBilling();
                
                // Load products for search
                await loadProductsForBilling();
                
                // Setup event listeners
                setupBillingEventListeners();
                
                console.log('‚úÖ Billing module initialized');
            } catch (error) {
                console.error('‚ùå Billing initialization failed:', error);
                showError('Failed to initialize billing module');
            }
        }
        
        // Load Customers for Billing
        async function loadCustomersForBilling() {
            try {
                const customers = await apiCall('/api/customers');
                const customerSelect = document.getElementById('customerSelect');
                
                customerSelect.innerHTML = '<option value="">Select Customer</option>';
                customers.forEach(customer => {
                    const option = document.createElement('option');
                    option.value = customer.id;
                    option.textContent = `${customer.name} - ${customer.phone || 'No phone'}`;
                    customerSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Failed to load customers:', error);
            }
        }
        
        // Load Products for Billing
        async function loadProductsForBilling() {
            try {
                const products = await apiCall('/api/products');
                window.billingProducts = products;
            } catch (error) {
                console.error('Failed to load products:', error);
            }
        }
        
        // Setup Event Listeners
        function setupBillingEventListeners() {
            // Product search
            const productSearch = document.getElementById('productSearch');
            productSearch.addEventListener('input', handleProductSearch);
            
            // Customer selection
            const customerSelect = document.getElementById('customerSelect');
            customerSelect.addEventListener('change', handleCustomerSelection);
            
            // Payment method selection
            document.querySelectorAll('.payment-btn').forEach(btn => {
                btn.addEventListener('click', handlePaymentMethodSelection);
            });
        }
        
        // Handle Product Search
        function handleProductSearch(event) {
            const query = event.target.value.toLowerCase();
            const suggestions = document.getElementById('productSuggestions');
            
            if (query.length < 2) {
                suggestions.innerHTML = '';
                return;
            }
            
            const filteredProducts = window.billingProducts.filter(product => 
                product.name.toLowerCase().includes(query) || 
                product.code.toLowerCase().includes(query)
            );
            
            suggestions.innerHTML = filteredProducts.slice(0, 5).map(product => `
                <div class="product-suggestion" onclick="addProductToBill('${product.id}')">
                    <div class="suggestion-info">
                        <div class="suggestion-name">${product.name}</div>
                        <div class="suggestion-details">Code: ${product.code} | Stock: ${product.stock}</div>
                    </div>
                    <div class="suggestion-price">‚Çπ${product.price}</div>
                </div>
            `).join('');
        }
        
        // Add Product to Bill
        function addProductToBill(productId) {
            const product = window.billingProducts.find(p => p.id === productId);
            if (!product) return;
            
            // Check if product already in bill
            const existingItem = billItems.find(item => item.productId === productId);
            if (existingItem) {
                existingItem.quantity += 1;
                existingItem.total = existingItem.quantity * existingItem.price;
            } else {
                billItems.push({
                    productId: product.id,
                    name: product.name,
                    price: product.price,
                    quantity: 1,
                    total: product.price
                });
            }
            
            updateBillDisplay();
            document.getElementById('productSearch').value = '';
            document.getElementById('productSuggestions').innerHTML = '';
        }
        
        // Update Bill Display
        function updateBillDisplay() {
            const billItemsContainer = document.getElementById('billItems');
            
            if (billItems.length === 0) {
                billItemsContainer.innerHTML = `
                    <div class="empty-bill">
                        <div class="empty-icon">üõí</div>
                        <p>No items added yet</p>
                        <small>Search and add products above</small>
                    </div>
                `;
                updateBillSummary();
                return;
            }
            
            billItemsContainer.innerHTML = billItems.map((item, index) => `
                <div class="bill-item">
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        <div class="item-price">‚Çπ${item.price} each</div>
                    </div>
                    <div class="item-controls">
                        <button class="qty-btn" onclick="updateQuantity(${index}, -1)">-</button>
                        <span class="qty-display">${item.quantity}</span>
                        <button class="qty-btn" onclick="updateQuantity(${index}, 1)">+</button>
                    </div>
                    <div class="item-total">‚Çπ${item.total.toFixed(2)}</div>
                    <button class="remove-btn" onclick="removeItem(${index})">√ó</button>
                </div>
            `).join('');
            
            updateBillSummary();
        }
        
        // Update Quantity
        function updateQuantity(index, change) {
            billItems[index].quantity += change;
            if (billItems[index].quantity <= 0) {
                billItems.splice(index, 1);
            } else {
                billItems[index].total = billItems[index].quantity * billItems[index].price;
            }
            updateBillDisplay();
        }
        
        // Remove Item
        function removeItem(index) {
            billItems.splice(index, 1);
            updateBillDisplay();
        }
        
        // Update Bill Summary
        function updateBillSummary() {
            const subtotal = billItems.reduce((sum, item) => sum + item.total, 0);
            const taxAmount = subtotal * 0.10; // 10% GST on subtotal
            const total = subtotal + taxAmount; // Total = Subtotal + GST
            
            document.getElementById('subtotal').textContent = `‚Çπ${subtotal.toFixed(2)}`;
            document.getElementById('taxAmount').textContent = `‚Çπ${taxAmount.toFixed(2)}`;
            document.getElementById('totalAmount').textContent = `‚Çπ${total.toFixed(2)}`;
        }
        
        // Handle Customer Selection
        function handleCustomerSelection(event) {
            selectedCustomer = event.target.value;
        }
        
        // Handle Payment Method Selection
        function handlePaymentMethodSelection(event) {
            document.querySelectorAll('.payment-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            selectedPaymentMethod = event.target.dataset.method;
        }
        
        // Clear Bill
        function clearBill() {
            if (confirm('Are you sure you want to clear the bill?')) {
                billItems = [];
                selectedCustomer = null;
                document.getElementById('customerSelect').value = '';
                updateBillDisplay();
            }
        }
        
        // Process Bill
        async function processBill() {
            if (billItems.length === 0) {
                showError('Please add items to the bill');
                return;
            }
            
            try {
                const subtotal = billItems.reduce((sum, item) => sum + item.total, 0);
                const taxAmount = subtotal * 0.10; // 10% GST on subtotal
                const total = subtotal + taxAmount; // Total = Subtotal + GST
                
                const billData = {
                    customer_id: selectedCustomer,
                    business_type: 'retail',
                    subtotal: subtotal,
                    tax_amount: taxAmount,
                    total_amount: total,
                    payment_method: selectedPaymentMethod,
                    items: billItems.map(item => ({
                        product_id: item.productId,
                        product_name: item.name,
                        quantity: item.quantity,
                        unit_price: item.price,
                        total_price: item.total
                    }))
                };
                
                const response = await apiCall('/api/bills', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(billData)
                });
                
                showSuccess(`Bill created successfully! Bill #${response.bill_number}`);
                
                // Clear bill after success
                billItems = [];
                selectedCustomer = null;
                document.getElementById('customerSelect').value = '';
                updateBillDisplay();
                
                // Refresh dashboard data
                loadDashboardData();
                
            } catch (error) {
                console.error('Failed to process bill:', error);
                showError('Failed to process bill. Please try again.');
            }
        }
        
        // Show Add Customer Modal
        function showAddCustomerModal() {
            document.getElementById('addCustomerModal').classList.add('show');
        }
        
        // Close Add Customer Modal
        function closeAddCustomerModal() {
            document.getElementById('addCustomerModal').classList.remove('show');
            document.getElementById('newCustomerName').value = '';
            document.getElementById('newCustomerPhone').value = '';
            document.getElementById('newCustomerEmail').value = '';
        }
        
        // Add New Customer
        async function addNewCustomer() {
            const name = document.getElementById('newCustomerName').value.trim();
            const phone = document.getElementById('newCustomerPhone').value.trim();
            const email = document.getElementById('newCustomerEmail').value.trim();
            
            if (!name) {
                showError('Customer name is required');
                return;
            }
            
            try {
                const customerData = { name, phone, email };
                const response = await apiCall('/api/customers', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(customerData)
                });
                
                showSuccess('Customer added successfully!');
                closeAddCustomerModal();
                await loadCustomersForBilling();
                
                // Select the new customer
                document.getElementById('customerSelect').value = response.id;
                selectedCustomer = response.id;
                
            } catch (error) {
                console.error('Failed to add customer:', error);
                showError('Failed to add customer. Please try again.');
            }
        }
        
        // Open Barcode Scanner
        function openBarcodeScanner() {
            showError('Barcode scanner will be available in the next update!');
        }
        }
        
        async function loadCustomersModule() {
            console.log('üë• Loading Customers Module...');
            
            try {
                const customers = await apiCall('/api/customers');
                
                const customersModule = document.getElementById('customersModule');
                customersModule.innerHTML = `
                    <div class="module-header">
                        <div class="module-title">üë• Customers (${customers.length})</div>
                        <button class="back-btn" onclick="showModule('dashboard')">‚Üê Back</button>
                    </div>
                    
                    <!-- Add Customer Button -->
                    <div style="padding: 15px; background: white; margin-bottom: 15px; border-radius: 12px;">
                        <button onclick="showAddCustomerModal()" style="width: 100%; background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); color: white; border: none; padding: 14px; border-radius: 10px; font-size: 16px; font-weight: 600;">
                            ‚ûï Add New Customer
                        </button>
                    </div>
                    
                    <!-- Search Customers -->
                    <div style="padding: 15px; background: white; margin-bottom: 15px; border-radius: 12px;">
                        <input type="text" id="customerSearchInput" placeholder="Search customers..." style="width: 100%; padding: 12px; border: 2px solid #E8D5DA; border-radius: 8px; font-size: 14px;" onkeyup="filterCustomers()">
                    </div>
                    
                    <!-- Customers List -->
                    <div id="customersList">
                        ${customers.map(customer => `
                            <div class="customer-card" data-name="${customer.name.toLowerCase()}" data-phone="${customer.phone || ''}">
                                <div class="customer-avatar">${customer.name.charAt(0).toUpperCase()}</div>
                                <div class="customer-info">
                                    <div class="customer-name">${customer.name}</div>
                                    <div class="customer-details">
                                        <div class="customer-phone">üìû ${customer.phone || 'No phone'}</div>
                                        <div class="customer-type-badge type-regular">Regular</div>
                                    </div>
                                </div>
                                <div class="customer-stats">
                                    <div class="customer-balance">‚Çπ${customer.current_balance || 0}</div>
                                    <div class="customer-purchases">${customer.total_purchases || 0} purchases</div>
                                    <div class="customer-actions">
                                        <button class="action-btn btn-edit" onclick="editCustomer('${customer.id}')">‚úèÔ∏è</button>
                                        <button class="action-btn btn-delete" onclick="deleteCustomer('${customer.id}')">üóëÔ∏è</button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <!-- Add Customer Modal -->
                    <div id="addCustomerModal" class="modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3>Add New Customer</h3>
                                <button class="modal-close" onclick="closeAddCustomerModal()">√ó</button>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                    <label>Customer Name *</label>
                                    <input type="text" id="newCustomerName" class="form-input" placeholder="Enter customer name">
                                </div>
                                <div class="form-group">
                                    <label>Phone Number</label>
                                    <input type="tel" id="newCustomerPhone" class="form-input" placeholder="Enter phone number">
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" id="newCustomerEmail" class="form-input" placeholder="Enter email">
                                </div>
                                <div class="form-group">
                                    <label>Address</label>
                                    <textarea id="newCustomerAddress" class="form-input" placeholder="Enter address" rows="3"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Credit Limit</label>
                                    <input type="number" id="newCustomerCredit" class="form-input" placeholder="Enter credit limit" step="0.01">
                                </div>
                                <button class="btn-primary" onclick="addNewCustomer()">Add Customer</button>
                            </div>
                        </div>
                    </div>
                `;
                
                console.log('‚úÖ Customers module loaded successfully');
            } catch (error) {
                console.error('‚ùå Failed to load customers:', error);
                showModuleError('customers', error.message);
            }
        }
        
        async function loadSalesModule() {
            console.log('üí∞ Loading Sales Module...');
            
            try {
                const sales = await apiCall('/api/sales');
                const salesSummary = await apiCall('/api/sales/summary');
                
                const salesModule = document.getElementById('salesModule');
                salesModule.innerHTML = `
                    <div class="module-header">
                        <div class="module-title">üí∞ Sales (${sales.length})</div>
                        <button class="back-btn" onclick="showModule('dashboard')">‚Üê Back</button>
                    </div>
                    
                    <!-- Sales Summary Cards -->
                    <div class="stats-grid" style="margin-bottom: 20px;">
                        <div class="stat-card">
                            <span class="stat-icon">üí∞</span>
                            <div class="stat-value">‚Çπ${salesSummary.today?.total || 0}</div>
                            <div class="stat-label">Today's Sales</div>
                        </div>
                        <div class="stat-card">
                            <span class="stat-icon">üìä</span>
                            <div class="stat-value">${salesSummary.today?.count || 0}</div>
                            <div class="stat-label">Total Bills</div>
                        </div>
                        <div class="stat-card">
                            <span class="stat-icon">üìà</span>
                            <div class="stat-value">‚Çπ${salesSummary.week?.total || 0}</div>
                            <div class="stat-label">This Week</div>
                        </div>
                        <div class="stat-card">
                            <span class="stat-icon">üìÖ</span>
                            <div class="stat-value">‚Çπ${salesSummary.month?.total || 0}</div>
                            <div class="stat-label">This Month</div>
                        </div>
                    </div>
                    
                    <!-- Date Filter -->
                    <div style="padding: 15px; background: white; margin-bottom: 15px; border-radius: 12px;">
                        <div style="display: flex; gap: 8px; overflow-x: auto;">
                            <button class="filter-tab active" onclick="filterSalesByDate('today')">Today</button>
                            <button class="filter-tab" onclick="filterSalesByDate('week')">This Week</button>
                            <button class="filter-tab" onclick="filterSalesByDate('month')">This Month</button>
                            <button class="filter-tab" onclick="filterSalesByDate('all')">All Time</button>
                        </div>
                    </div>
                    
                    <!-- Sales List -->
                    <div id="salesList">
                        ${sales.slice(0, 20).map(sale => `
                            <div class="sale-card">
                                <div class="sale-header">
                                    <div class="sale-bill-info">
                                        <div class="sale-bill-number">üßæ ${sale.bill_number || 'N/A'}</div>
                                        <div class="sale-customer">üë§ ${sale.customer_name || 'Walk-in Customer'}</div>
                                    </div>
                                    <div class="sale-amount">
                                        <div class="sale-total">‚Çπ${(sale.total_amount || 0).toFixed(0)}</div>
                                        <div class="sale-time">${new Date(sale.created_at).toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' })}</div>
                                    </div>
                                </div>
                                <div class="sale-details">
                                    <div class="sale-detail-item">
                                        üìÖ ${new Date(sale.created_at).toLocaleDateString('en-IN')}
                                    </div>
                                    <div class="sale-detail-item">
                                        <span class="sale-payment-badge payment-${(sale.payment_method || 'cash').toLowerCase()}">${(sale.payment_method || 'Cash').toUpperCase()}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                console.log('‚úÖ Sales module loaded successfully');
            } catch (error) {
                console.error('‚ùå Failed to load sales:', error);
                showModuleError('sales', error.message);
            }
        }
        
        async function loadInvoicesModule() {
            setTimeout(() => {
                const moduleElement = document.getElementById('invoicesModule');
                const loadingElement = moduleElement.querySelector('.loading');
                loadingElement.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">üìÑ</div>
                        <h3>Invoices Module</h3>
                        <p>Invoice management coming soon!</p>
                        <button onclick="alert('üöß Invoices module under development!')" style="background: #732C3F; color: white; border: none; padding: 12px 24px; border-radius: 8px; margin-top: 15px; cursor: pointer;">
                            üöß Coming Soon
                        </button>
                    </div>
                `;
            }, 500);
        }
        
        async function loadInventoryModule() {
            setTimeout(() => {
                const moduleElement = document.getElementById('inventoryModule');
                const loadingElement = moduleElement.querySelector('.loading');
                loadingElement.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">üìä</div>
                        <h3>Inventory Module</h3>
                        <p>Stock management coming soon!</p>
                        <button onclick="alert('üöß Inventory module under development!')" style="background: #732C3F; color: white; border: none; padding: 12px 24px; border-radius: 8px; margin-top: 15px; cursor: pointer;">
                            üöß Coming Soon
                        </button>
                    </div>
                `;
            }, 500);
        }
        
        async function loadBarcodeModule() {
            setTimeout(() => {
                const moduleElement = document.getElementById('barcodeModule');
                const loadingElement = moduleElement.querySelector('.loading');
                loadingElement.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">üì∑</div>
                        <h3>Barcode Scanner</h3>
                        <p>Camera integration coming soon!</p>
                        <button onclick="alert('üöß Barcode scanner under development!')" style="background: #732C3F; color: white; border: none; padding: 12px 24px; border-radius: 8px; margin-top: 15px; cursor: pointer;">
                            üöß Coming Soon
                        </button>
                    </div>
                `;
            }, 500);
        }
        
        async function loadEarningsModule() {
            setTimeout(() => {
                const moduleElement = document.getElementById('earningsModule');
                const loadingElement = moduleElement.querySelector('.loading');
                loadingElement.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">üíé</div>
                        <h3>Earnings & Profit</h3>
                        <p>Profit analytics coming soon!</p>
                        <button onclick="alert('üöß Earnings module under development!')" style="background: #732C3F; color: white; border: none; padding: 12px 24px; border-radius: 8px; margin-top: 15px; cursor: pointer;">
                            üöß Coming Soon
                        </button>
                    </div>
                `;
            }, 500);
        }
        
        async function loadReportsModule() {
            setTimeout(() => {
                const moduleElement = document.getElementById('reportsModule');
                const loadingElement = moduleElement.querySelector('.loading');
                loadingElement.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">üìà</div>
                        <h3>Reports Module</h3>
                        <p>Business reports coming soon!</p>
                        <button onclick="alert('üöß Reports module under development!')" style="background: #732C3F; color: white; border: none; padding: 12px 24px; border-radius: 8px; margin-top: 15px; cursor: pointer;">
                            üöß Coming Soon
                        </button>
                    </div>
                `;
            }, 500);
        }
        
        async function loadSettingsModule() {
            setTimeout(() => {
                const moduleElement = document.getElementById('settingsModule');
                const loadingElement = moduleElement.querySelector('.loading');
                loadingElement.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">‚öôÔ∏è</div>
                        <h3>Settings Module</h3>
                        <p>App settings coming soon!</p>
                        <button onclick="alert('üöß Settings module under development!')" style="background: #732C3F; color: white; border: none; padding: 12px 24px; border-radius: 8px; margin-top: 15px; cursor: pointer;">
                            üöß Coming Soon
                        </button>
                    </div>
                `;
            }, 500);
        }
        
        // Show Coming Soon for advanced modules
        function showComingSoon(module) {
            const moduleElement = document.getElementById(module + 'Module');
            if (!moduleElement) return;
            
            const loadingElement = moduleElement.querySelector('.loading');
            const moduleNames = {
                'client-management': { icon: 'üè¢', name: 'Client Management' },
                'user-management': { icon: 'üë•', name: 'User Management' },
                'staff-management': { icon: 'üë®‚Äçüíº', name: 'Staff Management' },
                'whatsapp-reports': { icon: 'üì±', name: 'WhatsApp Reports' }
            };
            
            const moduleInfo = moduleNames[module] || { icon: 'üöß', name: 'Advanced Module' };
            
            loadingElement.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div style="font-size: 48px; margin-bottom: 15px;">${moduleInfo.icon}</div>
                    <h3>${moduleInfo.name}</h3>
                    <p>Advanced feature coming soon!</p>
                    <button onclick="alert('üöß ${moduleInfo.name} under development!')" style="background: #732C3F; color: white; border: none; padding: 12px 24px; border-radius: 8px; margin-top: 15px; cursor: pointer;">
                        üöß Coming Soon
                    </button>
                </div>
            `;
        }
        
        // Menu Functions
        function toggleMenu() {
            const menu = document.getElementById('sideMenu');
            const overlay = document.getElementById('overlay');
            
            menu.classList.toggle('open');
            overlay.classList.toggle('show');
        }
        
        function closeMenu() {
            document.getElementById('sideMenu').classList.remove('open');
            document.getElementById('overlay').classList.remove('show');
        }
        
        // Profile Function
        function showProfile() {
            alert('üë§ Profile module coming soon!');
        }
        
        // Logout Function
        async function logout() {
            if (confirm('Are you sure you want to logout?')) {
                try {
                    await apiCall('/api/auth/logout', { method: 'POST' });
                    localStorage.clear();
                    window.location.href = '/login';
                } catch (error) {
                    console.error('Logout error:', error);
                    window.location.href = '/login';
                }
            }
        }
        
        // Error Display Functions
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            document.querySelector('.main-content').insertBefore(errorDiv, document.querySelector('.main-content').firstChild);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }
        
        function showModuleError(module, message) {
            const moduleElement = document.getElementById(module + 'Module');
            if (!moduleElement) return;
            
            const loadingElement = moduleElement.querySelector('.loading');
            loadingElement.innerHTML = `
                <div class="error-message">
                    <h4>‚ùå Error Loading ${module.charAt(0).toUpperCase() + module.slice(1)}</h4>
                    <p>${message}</p>
                    <button onclick="loadModuleData('${module}')" style="background: #732C3F; color: white; border: none; padding: 8px 16px; border-radius: 5px; margin-top: 10px; cursor: pointer;">
                        üîÑ Retry
                    </button>
                </div>
            `;
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ BizPulse Mobile ERP Starting...');
            initializeDashboard();
        });
    </script>
</body>
</html>
        
        // ========== HELPER FUNCTIONS FOR ALL MODULES ==========
        
        // Product Management Functions
        function showAddProductModal() {
            document.getElementById('addProductModal').classList.add('show');
        }
        
        function closeAddProductModal() {
            document.getElementById('addProductModal').classList.remove('show');
            // Clear form
            document.getElementById('newProductName').value = '';
            document.getElementById('newProductCode').value = '';
            document.getElementById('newProductCategory').value = '';
            document.getElementById('newProductPrice').value = '';
            document.getElementById('newProductCost').value = '';
            document.getElementById('newProductStock').value = '';
        }
        
        async function addNewProduct() {
            const name = document.getElementById('newProductName').value.trim();
            const code = document.getElementById('newProductCode').value.trim();
            const category = document.getElementById('newProductCategory').value.trim();
            const price = parseFloat(document.getElementById('newProductPrice').value);
            const cost = parseFloat(document.getElementById('newProductCost').value) || 0;
            const stock = parseInt(document.getElementById('newProductStock').value) || 0;
            const unit = document.getElementById('newProductUnit').value;
            
            if (!name || !price) {
                showError('Product name and price are required');
                return;
            }
            
            try {
                const productData = {
                    name, code, category, price, cost, stock, unit,
                    business_type: 'retail'
                };
                
                await apiCall('/api/products', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(productData)
                });
                
                showSuccess('Product added successfully!');
                closeAddProductModal();
                await loadProductsModule(); // Reload products
                
            } catch (error) {
                console.error('Failed to add product:', error);
                showError('Failed to add product. Please try again.');
            }
        }
        
        function filterProducts() {
            const query = document.getElementById('productSearchInput').value.toLowerCase();
            const products = document.querySelectorAll('.product-card');
            
            products.forEach(product => {
                const name = product.dataset.name;
                const code = product.dataset.code;
                
                if (name.includes(query) || code.includes(query)) {
                    product.style.display = 'flex';
                } else {
                    product.style.display = 'none';
                }
            });
        }
        
        async function editProduct(productId) {
            showError('Edit product feature coming soon!');
        }
        
        async function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                try {
                    await apiCall(`/api/products/${productId}`, { method: 'DELETE' });
                    showSuccess('Product deleted successfully!');
                    await loadProductsModule(); // Reload products
                } catch (error) {
                    console.error('Failed to delete product:', error);
                    showError('Failed to delete product. Please try again.');
                }
            }
        }
        
        // Customer Management Functions
        function filterCustomers() {
            const query = document.getElementById('customerSearchInput').value.toLowerCase();
            const customers = document.querySelectorAll('.customer-card');
            
            customers.forEach(customer => {
                const name = customer.dataset.name;
                const phone = customer.dataset.phone;
                
                if (name.includes(query) || phone.includes(query)) {
                    customer.style.display = 'flex';
                } else {
                    customer.style.display = 'none';
                }
            });
        }
        
        async function editCustomer(customerId) {
            showError('Edit customer feature coming soon!');
        }
        
        async function deleteCustomer(customerId) {
            if (confirm('Are you sure you want to delete this customer?')) {
                try {
                    await apiCall(`/api/customers/${customerId}`, { method: 'DELETE' });
                    showSuccess('Customer deleted successfully!');
                    await loadCustomersModule(); // Reload customers
                } catch (error) {
                    console.error('Failed to delete customer:', error);
                    showError('Failed to delete customer. Please try again.');
                }
            }
        }
        
        // Sales Functions
        function filterSalesByDate(period) {
            // Update active tab
            document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // This would filter sales by date in a real implementation
            showSuccess(`Showing ${period} sales`);
        }
        
        // Remaining Module Loaders
        async function loadInvoicesModule() {
            console.log('üìÑ Loading Invoices Module...');
            showComingSoon('invoices');
        }
        
        async function loadInventoryModule() {
            console.log('üìä Loading Inventory Module...');
            showComingSoon('inventory');
        }
        
        async function loadBarcodeModule() {
            console.log('üì∑ Loading Barcode Module...');
            showComingSoon('barcode');
        }
        
        async function loadEarningsModule() {
            console.log('üíé Loading Earnings Module...');
            showComingSoon('earnings');
        }
        
        async function loadReportsModule() {
            console.log('üìà Loading Reports Module...');
            showComingSoon('reports');
        }
        
        async function loadSettingsModule() {
            console.log('‚öôÔ∏è Loading Settings Module...');
            showComingSoon('settings');
        }
        
        async function loadClientManagementModule() {
            console.log('üè¢ Loading Client Management Module...');
            showComingSoon('client-management');
        }
        
        async function loadUserManagementModule() {
            console.log('üë• Loading User Management Module...');
            showComingSoon('user-management');
        }
        
        async function loadStaffManagementModule() {
            console.log('üë®‚Äçüíº Loading Staff Management Module...');
            showComingSoon('staff-management');
        }
        
        async function loadWhatsAppReportsModule() {
            console.log('üì± Loading WhatsApp Reports Module...');
            showComingSoon('whatsapp-reports');
        }
        
        // Show Coming Soon for modules
        function showComingSoon(moduleName) {
            const moduleElement = document.getElementById(moduleName + 'Module');
            if (moduleElement) {
                const loadingElement = moduleElement.querySelector('.loading');
                if (loadingElement) {
                    loadingElement.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <div style="font-size: 48px; margin-bottom: 15px;">üöß</div>
                            <h3>${moduleName.charAt(0).toUpperCase() + moduleName.slice(1)} Module</h3>
                            <p>This module is under development!</p>
                            <button onclick="showModule('dashboard')" style="background: #732C3F; color: white; border: none; padding: 12px 24px; border-radius: 8px; margin-top: 15px; cursor: pointer;">
                                ‚Üê Back to Dashboard
                            </button>
                        </div>
                    `;
                }
            }
        }
        
        // Show Module Error
        function showModuleError(moduleName, errorMessage) {
            const moduleElement = document.getElementById(moduleName + 'Module');
            if (moduleElement) {
                const loadingElement = moduleElement.querySelector('.loading');
                if (loadingElement) {
                    loadingElement.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <div style="font-size: 48px; margin-bottom: 15px; color: #f44336;">‚ùå</div>
                            <h3>Error Loading ${moduleName.charAt(0).toUpperCase() + moduleName.slice(1)}</h3>
                            <p style="color: #666; margin-bottom: 20px;">${errorMessage}</p>
                            <button onclick="showModule('${moduleName}')" style="background: #732C3F; color: white; border: none; padding: 12px 24px; border-radius: 8px; margin: 5px; cursor: pointer;">
                                üîÑ Retry
                            </button>
                            <button onclick="showModule('dashboard')" style="background: #666; color: white; border: none; padding: 12px 24px; border-radius: 8px; margin: 5px; cursor: pointer;">
                                ‚Üê Back to Dashboard
                            </button>
                        </div>
                    `;
                }
            }
        }