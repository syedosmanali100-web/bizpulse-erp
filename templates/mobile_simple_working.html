<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BizPulse Mobile</title>
    
    <!-- Barcode Scanner Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #F7E8EC 0%, #E8D5DA 100%);
            min-height: 100vh;
        }
        
        /* Top Bar */
        .top-bar {
            background: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
        }
        
        .menu-btn {
            font-size: 24px;
            cursor: pointer;
            padding: 5px 10px;
            background: #732C3F;
            color: white;
            border-radius: 5px;
        }
        
        .title { color: #732C3F; font-weight: bold; }
        
        /* Side Menu */
        .side-menu {
            position: fixed;
            top: 0;
            left: -280px;
            width: 280px;
            height: 100vh;
            background: #732C3F;
            transition: left 0.3s;
            z-index: 200;
            overflow-y: auto;
            color: white;
        }
        
        .side-menu.open { left: 0; }
        
        .menu-header {
            padding: 30px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        
        .menu-item {
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .menu-item:hover { background: rgba(255,255,255,0.1); }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 150;
        }
        
        .overlay.show { display: block; }
        
        /* Content */
        .content {
            padding: 70px 15px 15px 15px;
        }
        
        .card {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .card h2 { 
            color: #732C3F; 
            margin-bottom: 20px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .welcome-card {
            background: linear-gradient(135deg, #732C3F 0%, #8B4A5C 100%);
            color: white;
            padding: 25px 20px;
        }
        
        .welcome-card h2 {
            color: white;
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .welcome-card p {
            color: rgba(255,255,255,0.9);
            font-size: 14px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 0;
        }
        
        .stat-box {
            background: white;
            padding: 18px 15px;
            border-radius: 12px;
            border-left: 4px solid #732C3F;
            box-shadow: 0 2px 10px rgba(0,0,0,0.06);
            transition: transform 0.2s;
        }
        
        .stat-box:active {
            transform: scale(0.98);
        }
        
        .stat-box.sales { border-left-color: #4CAF50; }
        .stat-box.products { border-left-color: #2196F3; }
        .stat-box.customers { border-left-color: #FF9800; }
        .stat-box.bills { border-left-color: #9C27B0; }
        
        .stat-icon {
            font-size: 28px;
            margin-bottom: 8px;
            display: block;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #732C3F;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }
        
        .stat-change {
            font-size: 11px;
            color: #4CAF50;
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 3px;
        }
        
        .stat-change.down {
            color: #f44336;
        }
        
        .module-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 0;
        }
        
        .module-box {
            background: white;
            padding: 18px 12px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.06);
            transition: all 0.2s;
        }
        
        .module-box:active { 
            transform: scale(0.95);
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
        }
        
        .module-icon { 
            font-size: 36px; 
            margin-bottom: 8px;
            display: block;
        }
        
        .module-name { 
            color: #732C3F; 
            font-weight: 600;
            font-size: 13px;
        }
        
        .recent-activity {
            margin-top: 0;
        }
        
        .activity-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #F7E8EC;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .activity-details {
            flex: 1;
        }
        
        .activity-title {
            font-size: 14px;
            font-weight: 600;
            color: #732C3F;
            margin-bottom: 2px;
        }
        
        .activity-time {
            font-size: 12px;
            color: #666;
        }
        
        .list-item {
            padding: 12px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }
        
        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal.show { display: flex; }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 20px;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #E8D5DA;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: bold;
            color: #732C3F;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            color: #666;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
        }
        
        .form-group {
            margin-bottom: 18px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #732C3F;
            margin-bottom: 8px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #E8D5DA;
            border-radius: 10px;
            font-size: 14px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #732C3F;
        }
        
        .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #E8D5DA;
            border-radius: 10px;
            font-size: 14px;
            background: white;
        }
        
        .btn-primary {
            width: 100%;
            background: linear-gradient(135deg, #732C3F 0%, #8B4A5C 100%);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-primary:active {
            transform: scale(0.98);
        }
        
        /* Barcode Scanner Styles */
        .barcode-section {
            margin-bottom: 20px;
        }
        
        .btn-barcode {
            width: 100%;
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }
        
        .btn-barcode:active {
            transform: scale(0.98);
        }
        
        .divider-text {
            text-align: center;
            margin: 20px 0;
            position: relative;
            color: #666;
            font-size: 14px;
        }
        
        .divider-text::before,
        .divider-text::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 40%;
            height: 1px;
            background: #E8D5DA;
        }
        
        .divider-text::before { left: 0; }
        .divider-text::after { right: 0; }
        
        .camera-container {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .camera-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .btn-camera {
            flex: 1;
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-camera.secondary {
            background: #f44336;
        }
        
        .btn-upload {
            display: inline-block;
            background: #FF9800;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* Products Module Styles */
        .product-card {
            background: #F7E8EC;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .product-icon {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .product-info {
            flex: 1;
        }
        
        .product-name {
            font-size: 16px;
            font-weight: 600;
            color: #732C3F;
            margin-bottom: 4px;
        }
        
        .product-details {
            font-size: 12px;
            color: #666;
            margin-bottom: 6px;
        }
        
        .product-stock {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .stock-good {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .stock-low {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .stock-out {
            background: #ffebee;
            color: #c62828;
        }
        
        .product-price {
            text-align: right;
        }
        
        .price-value {
            font-size: 20px;
            font-weight: bold;
            color: #732C3F;
            margin-bottom: 4px;
        }
        
        .product-actions {
            display: flex;
            gap: 6px;
        }
        
        .action-btn {
            padding: 4px 10px;
            border: none;
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .btn-edit {
            background: #2196F3;
            color: white;
        }
        
        .btn-delete {
            background: #f44336;
            color: white;
        }
        
        .filter-tab {
            padding: 8px 16px;
            border: 2px solid #E8D5DA;
            background: white;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }
        
        .filter-tab.active {
            background: #732C3F;
            color: white;
            border-color: #732C3F;
        }
        
        /* Customer Card Styles */
        .customer-card {
            background: #F7E8EC;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            gap: 15px;
            align-items: center;
            transition: transform 0.2s;
        }
        
        .customer-card:active {
            transform: scale(0.98);
        }
        
        .customer-avatar {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, #732C3F 0%, #8B4A5C 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .customer-info {
            flex: 1;
            min-width: 0;
        }
        
        .customer-name {
            font-size: 16px;
            font-weight: 600;
            color: #732C3F;
            margin-bottom: 4px;
        }
        
        .customer-details {
            font-size: 12px;
            color: #666;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .customer-phone {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .customer-type-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .type-regular {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .type-vip {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .type-wholesale {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .customer-stats {
            text-align: right;
        }
        
        .customer-balance {
            font-size: 18px;
            font-weight: bold;
            color: #732C3F;
            margin-bottom: 4px;
        }
        
        .customer-purchases {
            font-size: 11px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .customer-actions {
            display: flex;
            gap: 6px;
            justify-content: flex-end;
        }
        
        /* Sales Card Styles */
        .sale-card {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 4px solid #732C3F;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s;
        }
        
        .sale-card:active {
            transform: scale(0.98);
        }
        
        .sale-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .sale-bill-info {
            flex: 1;
        }
        
        .sale-bill-number {
            font-size: 16px;
            font-weight: 600;
            color: #732C3F;
            margin-bottom: 4px;
        }
        
        .sale-customer {
            font-size: 13px;
            color: #666;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .sale-amount {
            text-align: right;
        }
        
        .sale-total {
            font-size: 20px;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 4px;
        }
        
        .sale-time {
            font-size: 11px;
            color: #999;
        }
        
        .sale-details {
            display: flex;
            gap: 15px;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0;
            font-size: 12px;
        }
        
        .sale-detail-item {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #666;
        }
        
        .sale-payment-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .payment-cash {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .payment-card {
            background: #e3f2fd;
            color: #1565c0;
        }
        
        .payment-upi {
            background: #f3e5f5;
            color: #6a1b9a;
        }
        
        .sale-products {
            margin-top: 10px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 8px;
            font-size: 12px;
        }
        
        .sale-product-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            color: #666;
        }
        
        /* Earnings/Profit Styles */
        .product-profit-card {
            padding: 12px;
            background: #f9f9f9;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #4CAF50;
        }
        
        .product-profit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .product-profit-name {
            font-size: 14px;
            font-weight: 600;
            color: #732C3F;
        }
        
        .product-profit-amount {
            font-size: 16px;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .product-profit-details {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            font-size: 11px;
            color: #666;
        }
        
        .product-profit-detail {
            text-align: center;
            padding: 6px;
            background: white;
            border-radius: 6px;
        }
        
        .product-profit-detail-label {
            display: block;
            margin-bottom: 3px;
            opacity: 0.8;
        }
        
        .product-profit-detail-value {
            display: block;
            font-weight: 600;
            color: #732C3F;
        }
        
        .profit-margin-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .margin-high {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .margin-medium {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .margin-low {
            background: #ffebee;
            color: #c62828;
        }
        
        /* Loading Screen with Rainbow Gradient */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, 
                #667eea 0%, 
                #764ba2 10%, 
                #f093fb 20%, 
                #4facfe 30%, 
                #00f2fe 40%, 
                #43e97b 50%, 
                #fa709a 60%, 
                #fee140 70%,
                #667eea 80%,
                #764ba2 90%,
                #f093fb 100%
            );
            background-size: 400% 400%;
            animation: rainbowShift 8s ease infinite;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        @keyframes rainbowShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Heartbeat Pulse Line Loader */
        .pulse-loader {
            width: 250px;
            height: 100px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .heartbeat-svg {
            width: 100%;
            height: 100%;
        }
        
        .heartbeat-path {
            stroke: white;
            stroke-width: 3;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
            filter: drop-shadow(0 0 8px rgba(255,255,255,0.8));
            animation: drawHeartbeat 3s ease-in-out infinite;
        }
        
        @keyframes drawHeartbeat {
            0% {
                stroke-dasharray: 0 1000;
                stroke-dashoffset: 0;
            }
            50% {
                stroke-dasharray: 1000 0;
                stroke-dashoffset: 0;
            }
            100% {
                stroke-dasharray: 1000 0;
                stroke-dashoffset: -1000;
            }
        }
        
        .loading-brand {
            font-size: 36px;
            font-weight: bold;
            color: white;
            margin-bottom: 40px;
            text-shadow: 0 2px 15px rgba(0,0,0,0.3);
            letter-spacing: 2px;
        }
        
        .loading-text {
            color: white;
            margin-top: 20px;
            font-size: 16px;
            font-weight: 500;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        
        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #732C3F 0%, #8B4A5C 100%);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .login-screen.show { display: flex; }
        .login-screen.hidden { display: none; }
        
        .login-card {
            background: white;
            padding: 30px 25px;
            border-radius: 20px;
            width: 90%;
            max-width: 350px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .login-logo h1 {
            color: #732C3F;
            font-size: 32px;
            margin-bottom: 5px;
        }
        
        .login-logo p {
            color: #666;
            font-size: 14px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            color: #732C3F;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #E8D5DA;
            border-radius: 10px;
            font-size: 16px;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #732C3F;
        }
        
        .login-btn {
            width: 100%;
            background: linear-gradient(135deg, #732C3F 0%, #8B4A5C 100%);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 12px;
        }
        
        .login-btn:active {
            transform: scale(0.98);
        }
        
        .login-divider {
            text-align: center;
            margin: 20px 0;
            position: relative;
            color: #999;
            font-size: 14px;
        }
        
        .login-divider::before,
        .login-divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 42%;
            height: 1px;
            background: #ddd;
        }
        
        .logout-item {
            background: rgba(255,255,255,0.1);
            margin: 10px 15px;
            border-radius: 8px;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 8px 10px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
            gap: 5px;
        }
        
        .bottom-nav::-webkit-scrollbar {
            display: none;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            padding: 5px 8px;
            border-radius: 8px;
            transition: all 0.3s;
            flex: 1;
            max-width: 80px;
        }
        
        .nav-item:active {
            transform: scale(0.95);
            background: #F7E8EC;
        }
        
        .nav-icon {
            font-size: 22px;
            margin-bottom: 2px;
        }
        
        .nav-label {
            font-size: 10px;
            color: #732C3F;
            font-weight: 500;
            white-space: nowrap;
        }
        
        /* Special Billing Button - Bigger & Centered */
        .nav-item.billing-btn {
            background: linear-gradient(135deg, #732C3F 0%, #8B3A47 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(114, 47, 55, 0.3);
            flex: 1.2;
            max-width: 95px;
        }
        
        .nav-item.billing-btn .nav-icon {
            font-size: 28px;
            margin-bottom: 3px;
        }
        
        .nav-item.billing-btn .nav-label {
            color: white;
            font-size: 11px;
            font-weight: 700;
        }
        
        .nav-item.billing-btn:active {
            transform: scale(0.95);
            background: linear-gradient(135deg, #8B3A47 0%, #732C3F 100%);
        }
        
        /* Billing Product Boxes - Desktop Style */
        .bill-product-box {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .bill-product-box:hover {
            border-color: #732C3F;
            box-shadow: 0 4px 12px rgba(115, 44, 63, 0.2);
            transform: translateY(-2px);
        }
        
        .bill-product-box:active {
            transform: scale(0.95);
        }
        
        .bill-product-name {
            font-size: 11px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
            line-height: 1.2;
            height: 28px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .bill-product-price {
            font-size: 14px;
            font-weight: 700;
            color: #732C3F;
            margin-bottom: 4px;
        }
        
        .bill-product-stock {
            font-size: 10px;
            color: #666;
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 10px;
        }
        
        .bill-product-box.out-of-stock {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .bill-product-box.out-of-stock:hover {
            border-color: #e0e0e0;
            box-shadow: none;
            transform: none;
        }
        
        /* Bill Items List */
        .bill-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            background: white;
        }
        
        .bill-item:last-child {
            border-bottom: none;
        }
        
        .bill-item-info {
            flex: 1;
        }
        
        .bill-item-name {
            font-weight: 600;
            color: #333;
            font-size: 14px;
            margin-bottom: 2px;
        }
        
        .bill-item-details {
            font-size: 12px;
            color: #666;
        }
        
        .bill-item-total {
            font-weight: 700;
            color: #732C3F;
            font-size: 16px;
            margin-right: 10px;
        }
        
        .bill-item-remove {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 8px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
        }
        
        /* Add padding to content for bottom nav */
        .content {
            padding: 70px 15px 80px 15px;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-brand">BizPulse</div>
        <div class="pulse-loader">
            <svg class="heartbeat-svg" viewBox="0 0 250 100" xmlns="http://www.w3.org/2000/svg">
                <path class="heartbeat-path" d="M 0,50 L 40,50 L 50,20 L 60,80 L 70,50 L 90,50 L 100,30 L 110,70 L 120,50 L 140,50 L 150,10 L 160,90 L 170,50 L 190,50 L 200,40 L 210,60 L 220,50 L 250,50"/>
            </svg>
        </div>
        <div class="loading-text">Loading...</div>
    </div>
    
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <div class="login-logo">
                <h1>üè¢ BizPulse</h1>
                <p>Mobile ERP System</p>
            </div>
            
            <!-- Credential Login Form -->
            <form onsubmit="handleLogin(event)" id="credentialLoginForm">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" value="bizpulse.erp@gmail.com" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" value="demo123" required>
                </div>
                <button type="submit" class="login-btn">üîê Login</button>
            </form>
            

        </div>
    </div>
    
    <!-- Top Bar -->
    <div class="top-bar" id="topBar" style="display: none;">
        <div class="menu-btn" onclick="toggleMenu()">‚ò∞</div>
        <div class="title">BizPulse</div>
        <div>üë§</div>
    </div>
    
    <!-- Overlay -->
    <div class="overlay" id="overlay" onclick="closeMenu()"></div>
    
    <!-- Side Menu -->
    <div class="side-menu" id="sideMenu">
        <div class="menu-header">
            <h2>BizPulse ERP</h2>
            <p id="userEmail">admin@demo.com</p>
        </div>
        <div id="menuItems">Loading...</div>
        <div style="border-top: 1px solid rgba(255,255,255,0.2); margin-top: 10px;"></div>
        <div class="menu-item logout-item" onclick="handleLogout()">
            <span>üö™ Logout</span>
        </div>
    </div>
    
    <!-- Bottom Navigation -->
    <div class="bottom-nav" id="bottomNav" style="display: none;">
        <div class="nav-item" onclick="scrollToTop()">
            <div class="nav-icon">üè†</div>
            <div class="nav-label">Home</div>
        </div>
        <div class="nav-item" onclick="showModule('products')">
            <div class="nav-icon">üì¶</div>
            <div class="nav-label">Products</div>
        </div>
        
        <!-- BILLING - Special Big Button in Middle -->
        <div class="nav-item billing-btn" onclick="showModule('billing')">
            <div class="nav-icon">üí≥</div>
            <div class="nav-label">BILLING</div>
        </div>
        
        <div class="nav-item" onclick="showModule('sales')">
            <div class="nav-icon">üí∞</div>
            <div class="nav-label">Sales</div>
        </div>
        <div class="nav-item" onclick="showModule('earnings')">
            <div class="nav-icon">üíé</div>
            <div class="nav-label">Earnings</div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="content" id="mainContent" style="display: none;">
        <div class="card welcome-card">
            <h2>üëã Welcome Back!</h2>
            <p>Here's what's happening with your business today</p>
        </div>
        
        <div class="card">
            <h2>üìä Overview</h2>
            <div class="stats" id="stats">
                <div class="stat-box sales">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-value" id="totalSales">‚Çπ0</div>
                    <div class="stat-label">Today's Sales</div>
                    <div class="stat-change">‚Üë 12%</div>
                </div>
                <div class="stat-box products">
                    <div class="stat-icon">üì¶</div>
                    <div class="stat-value" id="totalProducts">0</div>
                    <div class="stat-label">Products</div>
                    <div class="stat-change">‚Üë 5%</div>
                </div>
                <div class="stat-box customers">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-value" id="totalCustomers">0</div>
                    <div class="stat-label">Customers</div>
                    <div class="stat-change">‚Üë 8%</div>
                </div>
                <div class="stat-box bills">
                    <div class="stat-icon">üßæ</div>
                    <div class="stat-value" id="totalBills">0</div>
                    <div class="stat-label">Bills Today</div>
                    <div class="stat-change">‚Üë 15%</div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>‚ö° Quick Actions</h2>
            <div class="module-grid">
                <div class="module-box" onclick="showModule('billing')">
                    <div class="module-icon">üßæ</div>
                    <div class="module-name">New Bill</div>
                </div>
                <div class="module-box" onclick="showModule('products')">
                    <div class="module-icon">üì¶</div>
                    <div class="module-name">Products</div>
                </div>
                <div class="module-box" onclick="showModule('customers')">
                    <div class="module-icon">üë•</div>
                    <div class="module-name">Customers</div>
                </div>
                <div class="module-box" onclick="showModule('sales')">
                    <div class="module-icon">üí∞</div>
                    <div class="module-name">Sales</div>
                </div>
                <div class="module-box" onclick="showModule('inventory')">
                    <div class="module-icon">üìä</div>
                    <div class="module-name">Inventory</div>
                </div>
                <div class="module-box" onclick="showModule('reports')">
                    <div class="module-icon">üìà</div>
                    <div class="module-name">Reports</div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>üïê Recent Activity</h2>
            <div class="recent-activity">
                <div class="activity-item">
                    <div class="activity-icon">üí∞</div>
                    <div class="activity-details">
                        <div class="activity-title">New Sale</div>
                        <div class="activity-time">2 minutes ago</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon">üë•</div>
                    <div class="activity-details">
                        <div class="activity-title">Customer Added</div>
                        <div class="activity-time">15 minutes ago</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon">üì¶</div>
                    <div class="activity-details">
                        <div class="activity-title">Stock Updated</div>
                        <div class="activity-time">1 hour ago</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card" id="dataDisplay" style="display: none;">
            <h2 id="dataTitle">Select a module</h2>
            <div id="dataContent">Click on any module above to view data</div>
        </div>
        
        <!-- Products Module -->
        <div class="card" id="productsModule" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">üì¶ Products</h2>
                <button onclick="showAddProductForm()" style="background: #732C3F; color: white; border: none; padding: 8px 16px; border-radius: 8px; font-size: 14px;">+ Add</button>
            </div>
            
            <!-- Search Bar -->
            <div style="margin-bottom: 15px;">
                <input type="text" id="productSearch" placeholder="üîç Search products..." style="width: 100%; padding: 12px; border: 2px solid #E8D5DA; border-radius: 10px; font-size: 14px;" onkeyup="filterProducts()">
            </div>
            
            <!-- Filter Tabs -->
            <div style="display: flex; gap: 8px; margin-bottom: 15px; overflow-x: auto;">
                <button class="filter-tab active" onclick="filterByCategory('all')">All</button>
                <button class="filter-tab" onclick="filterByCategory('Groceries')">Groceries</button>
                <button class="filter-tab" onclick="filterByCategory('Beverages')">Beverages</button>
                <button class="filter-tab" onclick="filterByCategory('Dairy')">Dairy</button>
                <button class="filter-tab" onclick="filterByCategory('Vegetables')">Vegetables</button>
            </div>
            
            <!-- Products List -->
            <div id="productsList"></div>
        </div>
        
        <!-- Customers Module -->
        <div class="card" id="customersModule" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">üë• Customers</h2>
                <button onclick="showAddCustomerForm()" style="background: #732C3F; color: white; border: none; padding: 8px 16px; border-radius: 8px; font-size: 14px; font-weight: 600;">+ Add</button>
            </div>
            
            <!-- Search Bar -->
            <div style="margin-bottom: 15px;">
                <input type="text" id="customerSearch" placeholder="üîç Search customers..." style="width: 100%; padding: 12px; border: 2px solid #E8D5DA; border-radius: 10px; font-size: 14px;" onkeyup="filterCustomers()">
            </div>
            
            <!-- Filter Tabs -->
            <div style="display: flex; gap: 8px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px;">
                <button class="filter-tab active" onclick="filterCustomersByType('all')">All</button>
                <button class="filter-tab" onclick="filterCustomersByType('regular')">Regular</button>
                <button class="filter-tab" onclick="filterCustomersByType('vip')">VIP</button>
                <button class="filter-tab" onclick="filterCustomersByType('wholesale')">Wholesale</button>
            </div>
            
            <!-- Stats Summary -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
                <div style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); padding: 15px; border-radius: 12px; color: white;">
                    <div style="font-size: 24px; font-weight: bold;" id="totalCustomersCount">0</div>
                    <div style="font-size: 12px; opacity: 0.9;">Total Customers</div>
                </div>
                <div style="background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); padding: 15px; border-radius: 12px; color: white;">
                    <div style="font-size: 24px; font-weight: bold;" id="activeCustomersCount">0</div>
                    <div style="font-size: 12px; opacity: 0.9;">Active This Month</div>
                </div>
            </div>
            
            <!-- Customers List -->
            <div id="customersList"></div>
        </div>
        
        <!-- Billing Module - Desktop Style -->
        <div class="card" id="billingModule" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">üí≥ Smart Billing</h2>
                <div style="display: flex; gap: 10px;">
                    <button onclick="openBillBarcodeScanner()" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 8px; font-size: 14px;">üì∑ Scan</button>
                    <button onclick="clearBill()" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 8px; font-size: 14px;">Clear</button>
                </div>
            </div>
            
            <!-- Barcode Scanner Section for Billing -->
            <div id="billBarcodeSection" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h4 style="margin: 0; color: #28a745;">üì∑ Scan Product Barcode</h4>
                    <button onclick="closeBillBarcodeScanner()" style="background: #6c757d; color: white; border: none; padding: 5px 10px; border-radius: 5px; font-size: 12px;">‚úï</button>
                </div>
                <div id="billBarcodeCamera"></div>
            </div>
            
            <!-- Products Grid - Desktop Style -->
            <div style="margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; font-size: 16px; color: #732C3F;">üì¶ Select Products</h3>
                    <input type="text" id="billProductSearch" placeholder="üîç Search products..." style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 20px; width: 200px; font-size: 14px;">
                </div>
                
                <div id="billProductsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; max-height: 300px; overflow-y: auto; padding: 10px; background: #f8f9fa; border-radius: 10px;">
                    <!-- Products will be loaded here -->
                </div>
            </div>
            
            <!-- Bill Items -->
            <div style="margin-bottom: 15px;">
                <h3 style="margin-bottom: 10px; font-size: 16px; color: #732C3F;">üõí Bill Items</h3>
                <div id="billItemsList" style="max-height: 200px; overflow-y: auto; background: white; border-radius: 8px; border: 1px solid #e0e0e0;">
                    <div style="text-align: center; padding: 30px; color: #999;">
                        <div style="font-size: 48px; margin-bottom: 10px;">üõí</div>
                        <p>Scan or click products to add</p>
                    </div>
                </div>
            </div>
            
            <!-- Bill Summary & Payment -->
            <div style="background: linear-gradient(135deg, #732C3F 0%, #8B3A47 100%); padding: 20px; border-radius: 10px; color: white;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>Subtotal:</span>
                    <span style="font-weight: 600;">‚Çπ<span id="billSubtotal">0</span></span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>GST (18%):</span>
                    <span style="font-weight: 600;">‚Çπ<span id="billGST">0</span></span>
                </div>
                <div style="display: flex; justify-content: space-between; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.3); font-size: 20px; font-weight: 700; margin-bottom: 15px;">
                    <span>Total:</span>
                    <span>‚Çπ<span id="billTotal">0</span></span>
                </div>
                
                <!-- Payment Method Selection -->
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">üí≥ Payment Method:</label>
                    <select id="paymentMethod" style="width: 100%; padding: 10px; border: none; border-radius: 8px; font-size: 14px; color: #333;">
                        <option value="cash">üíµ Cash</option>
                        <option value="card">üí≥ Card</option>
                        <option value="upi">üì± UPI</option>
                        <option value="credit">üìù Credit</option>
                    </select>
                </div>
                
                <button onclick="completeBill()" id="completeBillBtn" style="background: #28a745; color: white; border: none; padding: 15px; border-radius: 8px; width: 100%; font-size: 18px; font-weight: 700;" disabled>
                    üí∞ Complete Bill
                </button>
            </div>
            

            </button>
        </div>
        
        <!-- Sales Module -->
        <div class="card" id="salesModule" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">üí∞ Sales</h2>
                <button onclick="showAddSaleForm()" style="background: #732C3F; color: white; border: none; padding: 8px 16px; border-radius: 8px; font-size: 14px; font-weight: 600;">+ New Sale</button>
            </div>
            
            <!-- Date Filter -->
            <div style="margin-bottom: 15px;">
                <div style="display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px;">
                    <button class="filter-tab active" onclick="filterSalesByDate('today')">Today</button>
                    <button class="filter-tab" onclick="filterSalesByDate('yesterday')">Yesterday</button>
                    <button class="filter-tab" onclick="filterSalesByDate('week')">This Week</button>
                    <button class="filter-tab" onclick="filterSalesByDate('month')">This Month</button>
                    <button class="filter-tab" onclick="filterSalesByDate('all')">All Time</button>
                </div>
            </div>
            
            <!-- Sales Summary Cards -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
                <div style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); padding: 15px; border-radius: 12px; color: white; box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);">
                    <div style="font-size: 11px; opacity: 0.9; margin-bottom: 5px;">Total Revenue</div>
                    <div style="font-size: 24px; font-weight: bold;" id="totalRevenue">‚Çπ0</div>
                    <div style="font-size: 11px; opacity: 0.9; margin-top: 5px;" id="revenueChange">‚Üë 0%</div>
                </div>
                <div style="background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); padding: 15px; border-radius: 12px; color: white; box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);">
                    <div style="font-size: 11px; opacity: 0.9; margin-bottom: 5px;">Transactions</div>
                    <div style="font-size: 24px; font-weight: bold;" id="totalTransactions">0</div>
                    <div style="font-size: 11px; opacity: 0.9; margin-top: 5px;" id="transactionChange">‚Üë 0%</div>
                </div>
                <div style="background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); padding: 15px; border-radius: 12px; color: white; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);">
                    <div style="font-size: 11px; opacity: 0.9; margin-bottom: 5px;">Avg Order Value</div>
                    <div style="font-size: 24px; font-weight: bold;" id="avgOrderValue">‚Çπ0</div>
                    <div style="font-size: 11px; opacity: 0.9; margin-top: 5px;">Per transaction</div>
                </div>
                <div style="background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%); padding: 15px; border-radius: 12px; color: white; box-shadow: 0 4px 12px rgba(156, 39, 176, 0.3);">
                    <div style="font-size: 11px; opacity: 0.9; margin-bottom: 5px;">Top Product</div>
                    <div style="font-size: 16px; font-weight: bold;" id="topProduct">-</div>
                    <div style="font-size: 11px; opacity: 0.9; margin-top: 5px;" id="topProductQty">0 sold</div>
                </div>
            </div>
            
            <!-- Search Bar -->
            <div style="margin-bottom: 15px;">
                <input type="text" id="salesSearch" placeholder="üîç Search by customer, product, bill..." style="width: 100%; padding: 12px; border: 2px solid #E8D5DA; border-radius: 10px; font-size: 14px;" onkeyup="filterSales()">
            </div>
            
            <!-- Sales List -->
            <div id="salesList"></div>
        </div>
        
        <!-- Earnings/Profit Module -->
        <div class="card" id="earningsModule" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">üíé Earnings & Profit</h2>
                <button onclick="refreshEarnings()" style="background: #732C3F; color: white; border: none; padding: 8px 16px; border-radius: 8px; font-size: 14px; font-weight: 600;">üîÑ Refresh</button>
            </div>
            
            <!-- Date Filter -->
            <div style="margin-bottom: 15px;">
                <div style="display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px;">
                    <button class="filter-tab active" onclick="filterEarningsByDate('today')">Today</button>
                    <button class="filter-tab" onclick="filterEarningsByDate('yesterday')">Yesterday</button>
                    <button class="filter-tab" onclick="filterEarningsByDate('week')">This Week</button>
                    <button class="filter-tab" onclick="filterEarningsByDate('month')">This Month</button>
                    <button class="filter-tab" onclick="filterEarningsByDate('all')">All Time</button>
                </div>
            </div>
            
            <!-- Main Profit Summary -->
            <div style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); padding: 20px; border-radius: 15px; color: white; margin-bottom: 20px; box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);">
                <div style="text-align: center;">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">üí∞ Total Profit</div>
                    <div style="font-size: 36px; font-weight: bold; margin-bottom: 8px;" id="totalProfit">‚Çπ0</div>
                    <div style="font-size: 13px; opacity: 0.9;" id="profitMarginPercent">Margin: 0%</div>
                </div>
            </div>
            
            <!-- Financial Breakdown -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
                <div style="background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); padding: 15px; border-radius: 12px; color: white; box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);">
                    <div style="font-size: 11px; opacity: 0.9; margin-bottom: 5px;">Total Sales</div>
                    <div style="font-size: 22px; font-weight: bold;" id="totalSalesValue">‚Çπ0</div>
                    <div style="font-size: 11px; opacity: 0.9; margin-top: 5px;">Revenue</div>
                </div>
                <div style="background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); padding: 15px; border-radius: 12px; color: white; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);">
                    <div style="font-size: 11px; opacity: 0.9; margin-bottom: 5px;">Total Cost</div>
                    <div style="font-size: 22px; font-weight: bold;" id="totalCostValue">‚Çπ0</div>
                    <div style="font-size: 11px; opacity: 0.9; margin-top: 5px;">Investment</div>
                </div>
            </div>
            
            <!-- Profit Metrics -->
            <div style="background: white; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 2px solid #E8D5DA;">
                <div style="font-size: 14px; font-weight: 600; color: #732C3F; margin-bottom: 15px;">üìä Profit Metrics</div>
                <div style="display: grid; gap: 12px;">
                    <div style="display: flex; justify-content: space-between; padding: 10px; background: #f9f9f9; border-radius: 8px;">
                        <span style="color: #666; font-size: 13px;">Gross Profit</span>
                        <span style="color: #4CAF50; font-weight: 600; font-size: 14px;" id="grossProfit">‚Çπ0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 10px; background: #f9f9f9; border-radius: 8px;">
                        <span style="color: #666; font-size: 13px;">Profit Margin %</span>
                        <span style="color: #2196F3; font-weight: 600; font-size: 14px;" id="profitMargin">0%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 10px; background: #f9f9f9; border-radius: 8px;">
                        <span style="color: #666; font-size: 13px;">Avg Profit/Sale</span>
                        <span style="color: #FF9800; font-weight: 600; font-size: 14px;" id="avgProfitPerSale">‚Çπ0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 10px; background: #f9f9f9; border-radius: 8px;">
                        <span style="color: #666; font-size: 13px;">Total Transactions</span>
                        <span style="color: #9C27B0; font-weight: 600; font-size: 14px;" id="totalTransactionsCount">0</span>
                    </div>
                </div>
            </div>
            
            <!-- Product-wise Profit Analysis -->
            <div style="background: white; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 2px solid #E8D5DA;">
                <div style="font-size: 14px; font-weight: 600; color: #732C3F; margin-bottom: 15px;">üì¶ Product-wise Profit</div>
                <div id="productProfitList"></div>
            </div>
            
            <!-- Top Performers -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
                <div style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); padding: 15px; border-radius: 12px; color: white; box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);">
                    <div style="font-size: 11px; opacity: 0.9; margin-bottom: 5px;">üèÜ Most Profitable</div>
                    <div style="font-size: 14px; font-weight: bold; margin-bottom: 3px;" id="mostProfitableProduct">-</div>
                    <div style="font-size: 12px; opacity: 0.9;" id="mostProfitableAmount">‚Çπ0 profit</div>
                </div>
                <div style="background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%); padding: 15px; border-radius: 12px; color: white; box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);">
                    <div style="font-size: 11px; opacity: 0.9; margin-bottom: 5px;">‚ö†Ô∏è Least Profitable</div>
                    <div style="font-size: 14px; font-weight: bold; margin-bottom: 3px;" id="leastProfitableProduct">-</div>
                    <div style="font-size: 12px; opacity: 0.9;" id="leastProfitableAmount">‚Çπ0 profit</div>
                </div>
            </div>
            
            <!-- Profit Trend -->
            <div style="background: white; padding: 15px; border-radius: 12px; border: 2px solid #E8D5DA;">
                <div style="font-size: 14px; font-weight: 600; color: #732C3F; margin-bottom: 15px;">üìà Profit Trend</div>
                <div id="profitTrend"></div>
            </div>
        </div>
    </div>
    
    <!-- Add Product Modal -->
    <div class="modal" id="addProductModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">‚ûï Add New Product</div>
                <button class="modal-close" onclick="closeAddProductModal()">√ó</button>
            </div>
            
            <!-- Barcode Scanner Section -->
            <div class="barcode-section">
                <button type="button" class="btn-barcode" onclick="openBarcodeScanner()">
                    üì∑ Scan with Barcode
                </button>
                <div class="divider-text">OR</div>
            </div>
            
            <!-- Camera/Upload Section (Hidden initially) -->
            <div id="barcodeUploadSection" style="display: none;">
                <div class="camera-container">
                    <video id="barcodeVideo" autoplay playsinline style="width: 100%; border-radius: 10px; display: none;"></video>
                    <canvas id="barcodeCanvas" style="display: none;"></canvas>
                    
                    <div id="barcodePreview" style="display: none;">
                        <img id="barcodeImage" style="width: 100%; border-radius: 10px; margin-bottom: 10px;">
                        <div style="text-align: center; margin-bottom: 15px;">
                            <span style="background: #4CAF50; color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px;">‚úì Barcode Captured</span>
                        </div>
                    </div>
                    
                    <div class="camera-buttons" id="cameraButtons" style="display: none;">
                        <button type="button" class="btn-camera" onclick="captureBarcode()">üì∏ Capture</button>
                        <button type="button" class="btn-camera secondary" onclick="closeBarcodeScanner()">‚úï Cancel</button>
                    </div>
                    
                    <div style="text-align: center; margin-top: 10px;">
                        <label for="barcodeFileInput" class="btn-upload">
                            üìÅ Upload Barcode Image
                        </label>
                        <input type="file" id="barcodeFileInput" accept="image/*" style="display: none;" onchange="handleBarcodeUpload(event)">
                    </div>
                </div>
                
                <div class="divider-text">Product Details</div>
            </div>
            
            <form id="productForm" onsubmit="saveProduct(event)">
                <div class="form-group">
                    <label class="form-label">Product Code *</label>
                    <input type="text" id="productCode" class="form-input" placeholder="e.g., P001" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Product Name *</label>
                    <input type="text" id="productName" class="form-input" placeholder="e.g., Rice (1kg)" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Category *</label>
                    <select id="productCategory" class="form-select" required>
                        <option value="">Select Category</option>
                        <option value="Groceries">Groceries</option>
                        <option value="Beverages">Beverages</option>
                        <option value="Dairy">Dairy</option>
                        <option value="Bakery">Bakery</option>
                        <option value="Vegetables">Vegetables</option>
                        <option value="Fruits">Fruits</option>
                        <option value="Snacks">Snacks</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Selling Price (‚Çπ) *</label>
                    <input type="number" id="productPrice" class="form-input" placeholder="e.g., 80" step="0.01" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Cost Price (‚Çπ) *</label>
                    <input type="number" id="productCost" class="form-input" placeholder="e.g., 70" step="0.01" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Current Stock *</label>
                    <input type="number" id="productStock" class="form-input" placeholder="e.g., 100" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Minimum Stock *</label>
                    <input type="number" id="productMinStock" class="form-input" placeholder="e.g., 10" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Unit *</label>
                    <select id="productUnit" class="form-select" required>
                        <option value="">Select Unit</option>
                        <option value="piece">Piece</option>
                        <option value="kg">Kilogram (kg)</option>
                        <option value="gram">Gram (g)</option>
                        <option value="liter">Liter (L)</option>
                        <option value="ml">Milliliter (ml)</option>
                        <option value="packet">Packet</option>
                        <option value="box">Box</option>
                        <option value="dozen">Dozen</option>
                    </select>
                </div>
                
                <button type="submit" class="btn-primary">üíæ Save Product</button>
            </form>
        </div>
    </div>
    
    <!-- Add Customer Modal -->
    <div class="modal" id="addCustomerModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üë§ Add New Customer</div>
                <button class="modal-close" onclick="closeAddCustomerModal()">√ó</button>
            </div>
            
            <form id="customerForm" onsubmit="saveCustomer(event)">
                <div class="form-group">
                    <label class="form-label">Customer Name *</label>
                    <input type="text" id="customerName" class="form-input" placeholder="e.g., Rajesh Kumar" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Phone Number *</label>
                    <input type="tel" id="customerPhone" class="form-input" placeholder="e.g., +91 9876543210" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" id="customerEmail" class="form-input" placeholder="e.g., customer@email.com">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Address</label>
                    <textarea id="customerAddress" class="form-input" placeholder="e.g., 123 Main Street, City" rows="3" style="resize: vertical;"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Customer Type *</label>
                    <select id="customerType" class="form-select" required>
                        <option value="">Select Type</option>
                        <option value="regular">Regular</option>
                        <option value="vip">VIP</option>
                        <option value="wholesale">Wholesale</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Credit Limit (‚Çπ)</label>
                    <input type="number" id="customerCreditLimit" class="form-input" placeholder="e.g., 5000" step="0.01" value="0">
                </div>
                
                <button type="submit" class="btn-primary">üíæ Save Customer</button>
            </form>
        </div>
    </div>

    <!-- Settings Module -->
    <div class="card" id="settingsModule" style="display: none;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin: 0;">‚öôÔ∏è Settings</h2>
        </div>
        
        <!-- Business Information -->
        <div style="background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #E8D5DA;">
            <div style="font-size: 16px; font-weight: 600; color: #732C3F; margin-bottom: 15px;">üè¢ Business Information</div>
            
            <div style="margin-bottom: 12px;">
                <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">Business Name</label>
                <input type="text" id="businessName" value="BizPulse Store" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div style="margin-bottom: 12px;">
                <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">Contact Number</label>
                <input type="tel" id="businessPhone" value="+91 7093635305" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div style="margin-bottom: 12px;">
                <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">Email</label>
                <input type="email" id="businessEmail" value="bizpulse.erp@gmail.com" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
            </div>
        </div>
        
        <!-- GST Settings -->
        <div style="background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #E8D5DA;">
            <div style="font-size: 16px; font-weight: 600; color: #732C3F; margin-bottom: 15px;">üìã GST Settings</div>
            
            <div style="margin-bottom: 12px;">
                <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">GST Number</label>
                <input type="text" id="gstNumber" placeholder="Enter GSTIN" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div style="margin-bottom: 12px;">
                <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">Default GST Rate</label>
                <select id="defaultGST" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                    <option value="0">0% - Nil Rated</option>
                    <option value="5">5% - Essential Goods</option>
                    <option value="12">12% - Standard Goods</option>
                    <option value="18" selected>18% - Most Goods</option>
                    <option value="28">28% - Luxury Items</option>
                </select>
            </div>
        </div>
        
        <!-- Payment Methods -->
        <div style="background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #E8D5DA;">
            <div style="font-size: 16px; font-weight: 600; color: #732C3F; margin-bottom: 15px;">üí≥ Payment Methods</div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f9f9f9; border-radius: 8px; margin-bottom: 10px;">
                <div>
                    <div style="font-weight: 600; font-size: 14px;">üíµ Cash</div>
                    <div style="font-size: 12px; color: #666;">Accept cash payments</div>
                </div>
                <label style="position: relative; display: inline-block; width: 50px; height: 24px;">
                    <input type="checkbox" checked style="opacity: 0; width: 0; height: 0;">
                    <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #732C3F; transition: .4s; border-radius: 24px;"></span>
                </label>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f9f9f9; border-radius: 8px; margin-bottom: 10px;">
                <div>
                    <div style="font-weight: 600; font-size: 14px;">üì± UPI</div>
                    <div style="font-size: 12px; color: #666;">PhonePe, GPay, Paytm</div>
                </div>
                <label style="position: relative; display: inline-block; width: 50px; height: 24px;">
                    <input type="checkbox" checked style="opacity: 0; width: 0; height: 0;">
                    <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #732C3F; transition: .4s; border-radius: 24px;"></span>
                </label>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f9f9f9; border-radius: 8px;">
                <div>
                    <div style="font-weight: 600; font-size: 14px;">üí≥ Card</div>
                    <div style="font-size: 12px; color: #666;">Credit/Debit cards</div>
                </div>
                <label style="position: relative; display: inline-block; width: 50px; height: 24px;">
                    <input type="checkbox" checked style="opacity: 0; width: 0; height: 0;">
                    <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #732C3F; transition: .4s; border-radius: 24px;"></span>
                </label>
            </div>
        </div>
        
        <!-- Notifications -->
        <div style="background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #E8D5DA;">
            <div style="font-size: 16px; font-weight: 600; color: #732C3F; margin-bottom: 15px;">üîî Notifications</div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f9f9f9; border-radius: 8px; margin-bottom: 10px;">
                <div>
                    <div style="font-weight: 600; font-size: 14px;">Low Stock Alerts</div>
                    <div style="font-size: 12px; color: #666;">Get notified when stock is low</div>
                </div>
                <label style="position: relative; display: inline-block; width: 50px; height: 24px;">
                    <input type="checkbox" checked style="opacity: 0; width: 0; height: 0;">
                    <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #732C3F; transition: .4s; border-radius: 24px;"></span>
                </label>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f9f9f9; border-radius: 8px;">
                <div>
                    <div style="font-weight: 600; font-size: 14px;">Daily Sales Report</div>
                    <div style="font-size: 12px; color: #666;">Receive daily summary</div>
                </div>
                <label style="position: relative; display: inline-block; width: 50px; height: 24px;">
                    <input type="checkbox" style="opacity: 0; width: 0; height: 0;">
                    <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                </label>
            </div>
        </div>
        
        <!-- Invoice Settings -->
        <div style="background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #E8D5DA;">
            <div style="font-size: 16px; font-weight: 600; color: #732C3F; margin-bottom: 15px;">üßæ Invoice Settings</div>
            
            <div style="margin-bottom: 12px;">
                <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">Invoice Prefix</label>
                <input type="text" id="invoicePrefix" value="INV" placeholder="e.g., INV" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div style="margin-bottom: 12px;">
                <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">Starting Number</label>
                <input type="number" id="invoiceStartNumber" value="1001" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f9f9f9; border-radius: 8px;">
                <div>
                    <div style="font-weight: 600; font-size: 14px;">Auto Numbering</div>
                    <div style="font-size: 12px; color: #666;">Generate invoice numbers automatically</div>
                </div>
                <label style="position: relative; display: inline-block; width: 50px; height: 24px;">
                    <input type="checkbox" checked style="opacity: 0; width: 0; height: 0;">
                    <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #732C3F; transition: .4s; border-radius: 24px;"></span>
                </label>
            </div>
        </div>
        
        <!-- Backup & Restore -->
        <div style="background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #E8D5DA;">
            <div style="font-size: 16px; font-weight: 600; color: #732C3F; margin-bottom: 15px;">üíæ Backup & Restore</div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f9f9f9; border-radius: 8px; margin-bottom: 10px;">
                <div>
                    <div style="font-weight: 600; font-size: 14px;">Auto Backup</div>
                    <div style="font-size: 12px; color: #666;">Automatic daily backups</div>
                </div>
                <label style="position: relative; display: inline-block; width: 50px; height: 24px;">
                    <input type="checkbox" checked style="opacity: 0; width: 0; height: 0;">
                    <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #732C3F; transition: .4s; border-radius: 24px;"></span>
                </label>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button onclick="backupData()" style="background: #28a745; color: white; border: none; padding: 12px; border-radius: 8px; font-size: 14px; font-weight: 600;">
                    üì• Backup Now
                </button>
                <button onclick="restoreData()" style="background: #17a2b8; color: white; border: none; padding: 12px; border-radius: 8px; font-size: 14px; font-weight: 600;">
                    üì§ Restore
                </button>
            </div>
        </div>
        
        <!-- Security Settings -->
        <div style="background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #E8D5DA;">
            <div style="font-size: 16px; font-weight: 600; color: #732C3F; margin-bottom: 15px;">üîí Security</div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f9f9f9; border-radius: 8px; margin-bottom: 10px;">
                <div>
                    <div style="font-weight: 600; font-size: 14px;">PIN Lock</div>
                    <div style="font-size: 12px; color: #666;">Require PIN to open app</div>
                </div>
                <label style="position: relative; display: inline-block; width: 50px; height: 24px;">
                    <input type="checkbox" style="opacity: 0; width: 0; height: 0;">
                    <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                </label>
            </div>
            

            
            <button onclick="changePassword()" style="background: #dc3545; color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-size: 14px; font-weight: 600; margin-top: 10px;">
                üîë Change Password
            </button>
        </div>
        
        <!-- App Settings -->
        <div style="background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #E8D5DA;">
            <div style="font-size: 16px; font-weight: 600; color: #732C3F; margin-bottom: 15px;">üì± App Settings</div>
            
            <div style="margin-bottom: 12px;">
                <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">Language</label>
                <select id="appLanguage" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                    <option value="en">English</option>
                    <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)</option>
                    <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä (Marathi)</option>
                    <option value="gu">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä (Gujarati)</option>
                    <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</option>
                </select>
            </div>
            
            <div style="margin-bottom: 12px;">
                <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">Currency</label>
                <select id="appCurrency" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                    <option value="INR">‚Çπ INR - Indian Rupee</option>
                    <option value="USD">$ USD - US Dollar</option>
                    <option value="EUR">‚Ç¨ EUR - Euro</option>
                    <option value="GBP">¬£ GBP - British Pound</option>
                </select>
            </div>
            
            <div style="margin-bottom: 12px;">
                <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">Date Format</label>
                <select id="dateFormat" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                    <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                    <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                    <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                </select>
            </div>
            
            <div style="margin-bottom: 12px;">
                <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">Time Format</label>
                <select id="timeFormat" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                    <option value="12">12 Hour (AM/PM)</option>
                    <option value="24">24 Hour</option>
                </select>
            </div>
        </div>
        
        <!-- Advanced Settings -->
        <div style="background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #E8D5DA;">
            <div style="font-size: 16px; font-weight: 600; color: #732C3F; margin-bottom: 15px;">üîß Advanced</div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f9f9f9; border-radius: 8px; margin-bottom: 10px;">
                <div>
                    <div style="font-weight: 600; font-size: 14px;">Debug Mode</div>
                    <div style="font-size: 12px; color: #666;">Show console logs</div>
                </div>
                <label style="position: relative; display: inline-block; width: 50px; height: 24px;">
                    <input type="checkbox" style="opacity: 0; width: 0; height: 0;">
                    <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                </label>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f9f9f9; border-radius: 8px; margin-bottom: 10px;">
                <div>
                    <div style="font-weight: 600; font-size: 14px;">Offline Mode</div>
                    <div style="font-size: 12px; color: #666;">Work without internet</div>
                </div>
                <label style="position: relative; display: inline-block; width: 50px; height: 24px;">
                    <input type="checkbox" style="opacity: 0; width: 0; height: 0;">
                    <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px;"></span>
                </label>
            </div>
            
            <button onclick="clearCache()" style="background: #ffc107; color: #000; border: none; padding: 12px; border-radius: 8px; width: 100%; font-size: 14px; font-weight: 600; margin-bottom: 10px;">
                üóëÔ∏è Clear Cache
            </button>
            
            <button onclick="resetApp()" style="background: #dc3545; color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-size: 14px; font-weight: 600;">
                ‚ö†Ô∏è Reset App
            </button>
        </div>
        
        <!-- Save Button -->
        <button onclick="saveSettings()" style="background: linear-gradient(135deg, #732C3F 0%, #8B3A47 100%); color: white; border: none; padding: 15px; border-radius: 10px; width: 100%; font-size: 16px; font-weight: 700; box-shadow: 0 4px 15px rgba(114, 47, 55, 0.3);">
            üíæ Save Settings
        </button>
        
        <!-- About Section -->
        <div style="margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 10px; text-align: center;">
            <div style="font-size: 14px; color: #666; margin-bottom: 5px;">BizPulse Mobile ERP</div>
            <div style="font-size: 12px; color: #999;">Version 1.0.0</div>
            <div style="font-size: 12px; color: #999; margin-top: 5px;">¬© 2025 BizPulse. All rights reserved.</div>
        </div>
    </div>
    


    <script>
        console.log('üöÄ Simple Mobile App Started');
        
        // Auto-detect API Base URL
        const API_BASE_URL = window.location.origin;
        console.log('üåê API Base URL:', API_BASE_URL);
        
        // Helper function for API calls
        async function apiCall(endpoint, options = {}) {
            try {
                const url = `${API_BASE_URL}${endpoint}`;
                console.log('üì° API Call:', url);
                const response = await fetch(url, options);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return await response.json();
            } catch (error) {
                console.error('‚ùå API Error:', error);
                throw error;
            }
        }
        
        // Show loading screen, then login
        window.addEventListener('load', function() {
            setTimeout(function() {
                // Hide loading screen
                document.getElementById('loadingScreen').classList.add('hidden');
                
                // Show login screen after loading
                setTimeout(function() {
                    document.getElementById('loginScreen').classList.add('show');
                }, 500);
            }, 2000); // Show loading for 2 seconds
        });
        
        // Login Handler
        function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Check localStorage for saved password
            const savedUser = JSON.parse(localStorage.getItem('bizpulse_user') || '{"password":"demo123"}');
            
            // Simple validation
            if (email === 'bizpulse.erp@gmail.com' && password === savedUser.password) {
                console.log('‚úÖ Login successful');
                performLogin(email);
            } else {
                alert('‚ùå Invalid credentials!\n\nUse:\nEmail: bizpulse.erp@gmail.com\nPassword: ' + savedUser.password);
            }
        }
        

        
        // Perform Login (Common function)
        function performLogin(email) {
            console.log('‚úÖ Login successful:', email);
            
            // Save login state
            localStorage.setItem('bizpulse_login', JSON.stringify({
                email: email,
                loginTime: new Date().toISOString()
            }));
            
            // Hide login screen
            document.getElementById('loginScreen').classList.add('hidden');
            
            // Show main app
            document.getElementById('topBar').style.display = 'flex';
            document.getElementById('bottomNav').style.display = 'flex';
            document.getElementById('mainContent').style.display = 'block';
            
            // Update user email in menu
            document.getElementById('userEmail').textContent = email;
            
            // Load dashboard data
            loadDashboard();
        }
        
        // Logout Handler
        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                console.log('üëã Logging out...');
                
                // Hide main app
                document.getElementById('topBar').style.display = 'none';
                document.getElementById('bottomNav').style.display = 'none';
                document.getElementById('mainContent').style.display = 'none';
                
                // Close menu
                closeMenu();
                
                // Show login screen
                document.getElementById('loginScreen').classList.remove('hidden');
                
                // Reset form
                document.getElementById('loginPassword').value = 'demo123';
            }
        }
        
        // Toggle Menu
        function toggleMenu() {
            console.log('Menu toggle clicked');
            const menu = document.getElementById('sideMenu');
            const overlay = document.getElementById('overlay');
            
            if (menu.classList.contains('open')) {
                closeMenu();
            } else {
                menu.classList.add('open');
                overlay.classList.add('show');
                loadMenuItems();
            }
        }
        
        function closeMenu() {
            document.getElementById('sideMenu').classList.remove('open');
            document.getElementById('overlay').classList.remove('show');
        }
        
        // Load Menu Items
        async function loadMenuItems() {
            console.log('Loading menu items...');
            const container = document.getElementById('menuItems');
            
            try {
                console.log('üìã Loading menu...');
                const data = await apiCall('/api/modules');
                console.log('‚úÖ Menu data loaded');
                
                let html = '';
                
                // Core modules
                if (data.core_modules) {
                    html += '<div style="padding: 10px 20px; font-size: 12px; opacity: 0.7;">CORE</div>';
                    data.core_modules.forEach(m => {
                        html += `<div class="menu-item" onclick="showModule('${m.route}')">${m.icon} ${m.name}</div>`;
                    });
                }
                
                // Inventory
                if (data.inventory_modules) {
                    html += '<div style="padding: 10px 20px; font-size: 12px; opacity: 0.7;">INVENTORY</div>';
                    data.inventory_modules.forEach(m => {
                        html += `<div class="menu-item" onclick="showModule('${m.route}')">${m.icon} ${m.name}</div>`;
                    });
                }
                
                // Customer
                if (data.customer_modules) {
                    html += '<div style="padding: 10px 20px; font-size: 12px; opacity: 0.7;">CUSTOMER</div>';
                    data.customer_modules.forEach(m => {
                        html += `<div class="menu-item" onclick="showModule('${m.route}')">${m.icon} ${m.name}</div>`;
                    });
                }
                
                // Add Earnings manually (not in API yet)
                html += '<div style="padding: 10px 20px; font-size: 12px; opacity: 0.7;">ANALYTICS</div>';
                html += '<div class="menu-item" onclick="showModule(\'earnings\')">üíé Earnings & Profit</div>';
                
                // Add Settings
                html += '<div style="padding: 10px 20px; font-size: 12px; opacity: 0.7;">SYSTEM</div>';
                html += '<div class="menu-item" onclick="showModule(\'settings\')">‚öôÔ∏è Settings</div>';
                
                container.innerHTML = html;
                console.log('‚úÖ Menu loaded');
            } catch (error) {
                console.error('Menu load error:', error);
                container.innerHTML = '<div style="padding: 20px;">Error loading menu</div>';
            }
        }
        
        // Load Dashboard Data
        async function loadDashboard() {
            console.log('üìä Loading dashboard...');
            
            try {
                // Products
                console.log('üì¶ Fetching products...');
                const products = await apiCall('/api/products');
                document.getElementById('totalProducts').textContent = products.length;
                console.log(`‚úÖ Products loaded: ${products.length}`);
                
                // Customers
                console.log('üë• Fetching customers...');
                const customers = await apiCall('/api/customers');
                document.getElementById('totalCustomers').textContent = customers.length;
                console.log(`‚úÖ Customers loaded: ${customers.length}`);
                
                // Sales
                console.log('üí∞ Fetching sales...');
                const sales = await apiCall('/api/sales/summary');
                document.getElementById('totalSales').textContent = '‚Çπ' + (sales.today?.total || 0).toFixed(0);
                document.getElementById('totalBills').textContent = sales.today?.count || 0;
                console.log(`‚úÖ Sales loaded: ‚Çπ${sales.today?.total || 0}`);
                
                console.log('‚úÖ Dashboard loaded successfully!');
            } catch (error) {
                console.error('‚ùå Dashboard error:', error);
                alert('Failed to load dashboard. Please check:\n1. Server is running\n2. Same WiFi network\n3. Correct IP address');
            }
        }
        
        let allProducts = [];
        let currentCategory = 'all';
        
        // Show Module Data
        async function showModule(module) {
            console.log('Loading module:', module);
            closeMenu();
            
            // Hide all modules
            document.getElementById('dataDisplay').style.display = 'none';
            document.getElementById('productsModule').style.display = 'none';
            document.getElementById('customersModule').style.display = 'none';
            document.getElementById('billingModule').style.display = 'none';
            document.getElementById('salesModule').style.display = 'none';
            document.getElementById('earningsModule').style.display = 'none';
            document.getElementById('settingsModule').style.display = 'none';
            
            // Hide dashboard cards
            document.querySelectorAll('.card').forEach(card => {
                if (!card.id || card.id === 'dataDisplay' || card.id === 'productsModule') {
                    card.style.display = 'none';
                }
            });
            
            if (module === 'products') {
                document.getElementById('productsModule').style.display = 'block';
                await loadProducts();
                return;
            }
            
            if (module === 'billing') {
                document.getElementById('billingModule').style.display = 'block';
                await loadBillingProducts();
                setupBillingSearch();
                return;
            }
            
            if (module === 'customers') {
                document.getElementById('customersModule').style.display = 'block';
                await loadCustomers();
                return;
            }
            
            if (module === 'sales') {
                document.getElementById('salesModule').style.display = 'block';
                await loadSales();
                return;
            }
            
            if (module === 'earnings' || module === 'reports') {
                document.getElementById('earningsModule').style.display = 'block';
                await loadEarnings();
                return;
            }
            
            if (module === 'settings') {
                document.getElementById('settingsModule').style.display = 'block';
                loadSettings();
                return;
            }
            
            // For other modules, use old display
            document.getElementById('dataDisplay').style.display = 'block';
            
            const title = document.getElementById('dataTitle');
            const content = document.getElementById('dataContent');
            
            title.textContent = module.charAt(0).toUpperCase() + module.slice(1);
            content.innerHTML = '<p>Loading...</p>';
            
            try {
                let data;
                let html = '';
                
                if (module === 'customers') {
                    data = await fetch('/api/customers').then(r => r.json());
                    html = '<div>';
                    data.forEach(c => {
                        html += `<div class="list-item">
                            <div><strong>${c.name}</strong><br><small>${c.phone}</small></div>
                            <div><small>${c.email || 'No email'}</small></div>
                        </div>`;
                    });
                    html += '</div>';
                } else if (module === 'sales') {
                    data = await fetch('/api/sales/summary').then(r => r.json());
                    html = `<div>
                        <div class="stat-box" style="margin: 10px 0;">
                            <div class="stat-value">‚Çπ${(data.today?.total || 0).toFixed(2)}</div>
                            <div class="stat-label">Today's Sales</div>
                        </div>
                        <div class="stat-box" style="margin: 10px 0;">
                            <div class="stat-value">‚Çπ${(data.week?.total || 0).toFixed(2)}</div>
                            <div class="stat-label">This Week</div>
                        </div>
                        <div class="stat-box" style="margin: 10px 0;">
                            <div class="stat-value">‚Çπ${(data.month?.total || 0).toFixed(2)}</div>
                            <div class="stat-label">This Month</div>
                        </div>
                    </div>`;
                } else {
                    html = '<p>Module coming soon...</p>';
                }
                
                content.innerHTML = html;
                console.log('‚úÖ Module loaded:', module);
            } catch (error) {
                console.error('Module error:', error);
                content.innerHTML = '<p style="color: red;">Error loading data</p>';
            }
        }
        
        // Load Products
        async function loadProducts() {
            try {
                console.log('üì¶ Loading products...');
                allProducts = await apiCall('/api/products');
                console.log(`‚úÖ Products loaded: ${allProducts.length}`);
                displayProducts(allProducts);
            } catch (error) {
                console.error('‚ùå Error loading products:', error);
                document.getElementById('productsList').innerHTML = '<p style="text-align: center; color: red;">Failed to load products. Check connection.</p>';
            }
        }
        
        // Display Products
        function displayProducts(products) {
            const container = document.getElementById('productsList');
            
            if (products.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No products found</p>';
                return;
            }
            
            let html = '';
            products.forEach(product => {
                const stockStatus = product.stock === 0 ? 'out' : (product.stock <= product.min_stock ? 'low' : 'good');
                const stockClass = `stock-${stockStatus}`;
                const stockText = product.stock === 0 ? 'Out of Stock' : (product.stock <= product.min_stock ? `Low: ${product.stock}` : `Stock: ${product.stock}`);
                
                html += `
                    <div class="product-card">
                        <div class="product-icon">üì¶</div>
                        <div class="product-info">
                            <div class="product-name">${product.name}</div>
                            <div class="product-details">${product.category} ‚Ä¢ ${product.unit}</div>
                            <span class="product-stock ${stockClass}">${stockText}</span>
                        </div>
                        <div class="product-price">
                            <div class="price-value">‚Çπ${product.price}</div>
                            <div class="product-actions">
                                <button class="action-btn btn-edit" onclick="editProduct('${product.id}')">Edit</button>
                                <button class="action-btn btn-delete" onclick="deleteProduct('${product.id}')">Del</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Filter Products by Search
        function filterProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            let filtered = allProducts;
            
            if (currentCategory !== 'all') {
                filtered = filtered.filter(p => p.category === currentCategory);
            }
            
            if (searchTerm) {
                filtered = filtered.filter(p => 
                    p.name.toLowerCase().includes(searchTerm) || 
                    p.category.toLowerCase().includes(searchTerm)
                );
            }
            
            displayProducts(filtered);
        }
        
        // Filter by Category
        function filterByCategory(category) {
            currentCategory = category;
            
            // Update active tab
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            filterProducts();
        }
        
        let barcodeStream = null;
        let barcodeImageData = null;
        
        // Add Product Form
        function showAddProductForm() {
            document.getElementById('addProductModal').classList.add('show');
            document.getElementById('productForm').reset();
            document.getElementById('barcodeUploadSection').style.display = 'none';
            document.getElementById('barcodePreview').style.display = 'none';
            barcodeImageData = null;
        }
        
        function closeAddProductModal() {
            document.getElementById('addProductModal').classList.remove('show');
            closeBarcodeScanner();
        }
        
        // Open Barcode Scanner
        async function openBarcodeScanner() {
            const section = document.getElementById('barcodeUploadSection');
            section.style.display = 'block';
            
            // Check if camera is supported
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showUploadOnlyOption(section);
                return;
            }
            
            // Check if we're on HTTPS or localhost (required for camera)
            const isSecure = window.location.protocol === 'https:' || 
                           window.location.hostname === 'localhost' || 
                           window.location.hostname === '127.0.0.1';
            
            if (!isSecure) {
                alert('‚ö†Ô∏è Camera requires HTTPS!\n\n' +
                      'üì± Your browser blocks camera on HTTP for security.\n\n' +
                      '‚úÖ Solution: Use "Upload Barcode Image" option below\n\n' +
                      '(Camera works on HTTPS or localhost only)');
                showUploadOnlyOption(section);
                return;
            }
            
            // Show loading message - permission popup will appear automatically
            section.innerHTML = `
                <div style="text-align: center; padding: 30px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; color: white; margin-bottom: 15px;">
                    <div style="font-size: 48px; margin-bottom: 15px;">üì∑</div>
                    <p style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Requesting Camera Access...</p>
                    <p style="font-size: 13px; opacity: 0.9;">Browser will ask for permission</p>
                    <p style="font-size: 12px; opacity: 0.8; margin-top: 10px;">üëÜ Click "Allow" when popup appears</p>
                </div>
            `;
            
            try {
                // Request camera permission - Browser automatically shows permission popup
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment', // Use back camera on mobile
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                });
                
                // Success! Show camera preview
                section.innerHTML = `
                    <div class="camera-container">
                        <video id="barcodeVideo" autoplay playsinline style="width: 100%; border-radius: 10px; background: #000;"></video>
                        <canvas id="barcodeCanvas" style="display: none;"></canvas>
                        
                        <div id="barcodePreview" style="display: none;">
                            <img id="barcodeImage" style="width: 100%; border-radius: 10px; margin-bottom: 10px;">
                            <div style="text-align: center; margin-bottom: 15px;">
                                <span style="background: #4CAF50; color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px;">‚úì Barcode Captured</span>
                            </div>
                        </div>
                        
                        <div class="camera-buttons" id="cameraButtons" style="display: flex;">
                            <button type="button" class="btn-camera" onclick="captureBarcode()">üì∏ Capture</button>
                            <button type="button" class="btn-camera secondary" onclick="closeBarcodeScanner()">‚úï Cancel</button>
                        </div>
                        
                        <div style="text-align: center; margin-top: 10px; padding: 10px; background: rgba(76, 175, 80, 0.1); border-radius: 8px;">
                            <small style="color: #4CAF50; font-weight: 600;">üì± Point camera at barcode for auto-detection</small>
                        </div>
                        
                        <div style="text-align: center; margin-top: 10px;">
                            <label for="barcodeFileInput" class="btn-upload">
                                üìÅ Or Upload Image
                            </label>
                            <input type="file" id="barcodeFileInput" accept="image/*" style="display: none;" onchange="handleBarcodeUpload(event)">
                        </div>
                    </div>
                    
                    <div class="divider-text">Product Details</div>
                `;
                
                const video = document.getElementById('barcodeVideo');
                barcodeStream = stream;
                video.srcObject = stream;
                
                // Start real-time barcode detection when video loads
                video.addEventListener('loadedmetadata', () => {
                    startBarcodeDetection();
                });
                
                console.log('‚úÖ Camera access granted - live preview active');
            } catch (error) {
                console.error('Camera error:', error);
                handleCameraError(error, section);
            }
        }
        
        // Show upload-only option
        function showUploadOnlyOption(section) {
            section.innerHTML = `
                <div class="camera-container">
                    <div style="text-align: center; padding: 20px; background: #fff3cd; border-radius: 10px; margin-bottom: 15px;">
                        <div style="font-size: 36px; margin-bottom: 10px;">üìÅ</div>
                        <p style="color: #856404; margin-bottom: 5px; font-weight: 600;">Camera Not Available</p>
                        <p style="font-size: 12px; color: #856404;">Use upload option below</p>
                    </div>
                    
                    <div id="barcodePreview" style="display: none;">
                        <img id="barcodeImage" style="width: 100%; border-radius: 10px; margin-bottom: 10px;">
                        <div style="text-align: center; margin-bottom: 15px;">
                            <span style="background: #4CAF50; color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px;">‚úì Barcode Uploaded</span>
                        </div>
                    </div>
                    
                    <div style="text-align: center;">
                        <label for="barcodeFileInput" class="btn-upload" style="display: inline-block; padding: 14px 24px; font-size: 16px;">
                            üìÅ Upload Barcode Image
                        </label>
                        <input type="file" id="barcodeFileInput" accept="image/*" style="display: none;" onchange="handleBarcodeUpload(event)">
                    </div>
                </div>
                
                <div class="divider-text">Product Details</div>
            `;
        }
        
        // Handle camera errors
        function handleCameraError(error, section) {
            let title = '‚ùå Camera Access Failed';
            let message = '';
            let instructions = '';
            
            if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                title = 'üîí Permission Denied';
                message = 'You blocked camera access';
                instructions = `
                    <div style="text-align: left; font-size: 12px; color: #666; margin-top: 10px; padding: 10px; background: white; border-radius: 8px;">
                        <strong>To enable camera:</strong><br>
                        1. Tap address bar (üîí icon)<br>
                        2. Find "Camera" permission<br>
                        3. Change to "Allow"<br>
                        4. Refresh page & try again
                    </div>
                `;
            } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
                title = 'üì∑ No Camera Found';
                message = 'No camera detected on device';
            } else if (error.name === 'NotReadableError' || error.name === 'TrackStartError') {
                title = '‚ö†Ô∏è Camera In Use';
                message = 'Camera is being used by another app';
                instructions = '<div style="font-size: 12px; color: #666; margin-top: 8px;">Close other apps using camera</div>';
            } else {
                message = error.message || 'Unknown error occurred';
            }
            
            // Show error with upload option
            section.innerHTML = `
                <div class="camera-container">
                    <div style="text-align: center; padding: 20px; background: #ffebee; border-radius: 10px; margin-bottom: 15px;">
                        <div style="font-size: 36px; margin-bottom: 10px;">üì∑</div>
                        <p style="color: #c62828; margin-bottom: 5px; font-weight: 600;">${title}</p>
                        <p style="font-size: 13px; color: #c62828;">${message}</p>
                        ${instructions}
                    </div>
                    
                    <div id="barcodePreview" style="display: none;">
                        <img id="barcodeImage" style="width: 100%; border-radius: 10px; margin-bottom: 10px;">
                        <div style="text-align: center; margin-bottom: 15px;">
                            <span style="background: #4CAF50; color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px;">‚úì Barcode Uploaded</span>
                        </div>
                    </div>
                    
                    <div style="text-align: center;">
                        <label for="barcodeFileInput" class="btn-upload" style="display: inline-block; padding: 14px 24px; font-size: 16px;">
                            üìÅ Upload Barcode Image Instead
                        </label>
                        <input type="file" id="barcodeFileInput" accept="image/*" style="display: none;" onchange="handleBarcodeUpload(event)">
                    </div>
                </div>
                
                <div class="divider-text">Product Details</div>
            `;
        }
        
        // Capture Barcode
        function captureBarcode() {
            const video = document.getElementById('barcodeVideo');
            const canvas = document.getElementById('barcodeCanvas');
            const preview = document.getElementById('barcodePreview');
            const image = document.getElementById('barcodeImage');
            const buttons = document.getElementById('cameraButtons');
            
            // Set canvas size to video size
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            // Draw video frame to canvas
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0);
            
            // Get image data
            barcodeImageData = canvas.toDataURL('image/jpeg');
            
            // Show preview
            image.src = barcodeImageData;
            preview.style.display = 'block';
            video.style.display = 'none';
            buttons.style.display = 'none';
            
            // Stop camera
            if (barcodeStream) {
                barcodeStream.getTracks().forEach(track => track.stop());
                barcodeStream = null;
            }
            
            // Auto-fill barcode to product code (simulate barcode reading)
            try {
                // Generate a sample barcode from timestamp (in real app, use barcode reader library)
                const timestamp = Date.now().toString();
                const barcodeValue = timestamp.slice(-8); // Last 8 digits as barcode
                
                // Auto-fill product code field
                const productCodeField = document.getElementById('productCode');
                if (productCodeField) {
                    productCodeField.value = barcodeValue;
                    
                    // Show success message
                    showToast('‚úÖ Barcode scanned: ' + barcodeValue, 'success');
                    
                    // Focus on next field (product name)
                    const productNameField = document.getElementById('productName');
                    if (productNameField) {
                        setTimeout(() => productNameField.focus(), 500);
                    }
                }
            } catch (error) {
                console.error('Barcode processing error:', error);
                showToast('‚ö†Ô∏è Barcode captured, please enter code manually', 'warning');
            }
            
            console.log('‚úÖ Barcode captured and processed');
        }
        
        // Handle Barcode Upload
        function handleBarcodeUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('‚ùå Please select an image file');
                return;
            }
            
            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('‚ùå Image too large!\n\nPlease select an image under 5MB');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                barcodeImageData = e.target.result;
                
                const preview = document.getElementById('barcodePreview');
                const image = document.getElementById('barcodeImage');
                const section = document.getElementById('barcodeUploadSection');
                
                if (image && preview) {
                    image.src = barcodeImageData;
                    preview.style.display = 'block';
                    section.style.display = 'block';
                    
                    // Hide camera if it was showing
                    const video = document.getElementById('barcodeVideo');
                    const buttons = document.getElementById('cameraButtons');
                    if (video) video.style.display = 'none';
                    if (buttons) buttons.style.display = 'none';
                    
                    // Stop camera stream if active
                    if (barcodeStream) {
                        barcodeStream.getTracks().forEach(track => track.stop());
                        barcodeStream = null;
                    }
                    
                    console.log('‚úÖ Barcode image uploaded successfully');
                } else {
                    console.error('Preview elements not found');
                    alert('‚ùå Error displaying image. Please try again.');
                }
            };
            
            reader.onerror = function() {
                alert('‚ùå Error reading file. Please try again.');
            };
            
            reader.readAsDataURL(file);
        }
        
        // Close Barcode Scanner
        function closeBarcodeScanner() {
            const video = document.getElementById('barcodeVideo');
            const section = document.getElementById('barcodeUploadSection');
            const buttons = document.getElementById('cameraButtons');
            
            // Stop Quagga if running
            if (typeof Quagga !== 'undefined') {
                Quagga.stop();
            }
            
            if (barcodeStream) {
                barcodeStream.getTracks().forEach(track => track.stop());
                barcodeStream = null;
            }
            
            video.style.display = 'none';
            buttons.style.display = 'none';
            section.style.display = 'none';
        }
        
        // Start Real-time Barcode Detection
        function startBarcodeDetection() {
            if (typeof Quagga !== 'undefined') {
                const video = document.getElementById('barcodeVideo');
                if (!video) return;
                
                Quagga.init({
                    inputStream: {
                        name: "Live",
                        type: "LiveStream",
                        target: video,
                        constraints: {
                            width: 640,
                            height: 480,
                            facingMode: "environment"
                        }
                    },
                    decoder: {
                        readers: [
                            "code_128_reader",
                            "ean_reader",
                            "ean_8_reader",
                            "code_39_reader",
                            "upc_reader",
                            "upc_e_reader"
                        ]
                    },
                    locate: true
                }, function(err) {
                    if (err) {
                        console.log('Quagga initialization error:', err);
                        return;
                    }
                    console.log("‚úÖ Real-time barcode detection started");
                    Quagga.start();
                });
                
                // Listen for barcode detection
                Quagga.onDetected(function(data) {
                    const code = data.codeResult.code;
                    console.log('üéØ Barcode auto-detected:', code);
                    
                    // Auto-fill product code
                    const productCodeField = document.getElementById('productCode');
                    if (productCodeField) {
                        productCodeField.value = code;
                        window.detectedBarcodeData = code; // Store for saving
                        showToast('‚úÖ Barcode detected: ' + code, 'success');
                        
                        // Close scanner and focus next field
                        closeBarcodeScanner();
                        setTimeout(() => {
                            const productNameField = document.getElementById('productName');
                            if (productNameField) productNameField.focus();
                        }, 500);
                    }
                });
            } else {
                console.log('‚ö†Ô∏è Quagga library not loaded, manual capture only');
            }
        }
        
        // Save Product
        async function saveProduct(event) {
            event.preventDefault();
            
            // Validate required fields
            const name = document.getElementById('productName').value.trim();
            const price = document.getElementById('productPrice').value;
            
            if (!name) {
                showToast('‚ùå Product name is required', 'error');
                document.getElementById('productName').focus();
                return;
            }
            
            if (!price || parseFloat(price) <= 0) {
                showToast('‚ùå Valid price is required', 'error');
                document.getElementById('productPrice').focus();
                return;
            }
            
            const formData = {
                code: document.getElementById('productCode').value.trim() || undefined,
                name: name,
                category: document.getElementById('productCategory').value || 'General',
                price: parseFloat(price),
                cost: parseFloat(document.getElementById('productCost').value) || 0,
                stock: parseInt(document.getElementById('productStock').value) || 0,
                min_stock: parseInt(document.getElementById('productMinStock').value) || 0,
                unit: document.getElementById('productUnit').value || 'piece',
                business_type: 'both',
                barcode_data: window.detectedBarcodeData || document.getElementById('productCode').value.trim(), // Store detected barcode
                barcode_image: barcodeImageData // Include barcode image if captured
            };
            
            // Show loading
            const saveBtn = event.target.querySelector('button[type="submit"]') || event.target;
            const originalText = saveBtn.textContent;
            saveBtn.textContent = '‚è≥ Saving...';
            saveBtn.disabled = true;
            
            try {
                const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    showToast('‚úÖ Product added successfully!', 'success');
                    closeAddProductModal();
                    await loadProducts(); // Reload products list
                    
                    // Reset form
                    document.getElementById('addProductForm').reset();
                    barcodeImageData = null;
                } else {
                    const errorMsg = result.error || result.message || 'Failed to add product';
                    showToast('‚ùå ' + errorMsg, 'error');
                }
            } catch (error) {
                console.error('Error saving product:', error);
                showToast('‚ùå Network error. Please check connection.', 'error');
            } finally {
                // Restore button state
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
            }
        }
        
        // Edit Product
        function editProduct(id) {
            alert('Edit product: ' + id);
        }
        
        // Delete Product
        function deleteProduct(id) {
            if (confirm('Delete this product?')) {
                alert('Delete product: ' + id);
            }
        }
        
        // ========== CUSTOMERS MODULE ==========
        
        let allCustomers = [];
        let currentCustomerType = 'all';
        
        // Load Customers
        async function loadCustomers() {
            try {
                console.log('üë• Loading customers...');
                allCustomers = await apiCall('/api/customers');
                console.log(`‚úÖ Customers loaded: ${allCustomers.length}`);
                
                // Update stats
                document.getElementById('totalCustomersCount').textContent = allCustomers.length;
                document.getElementById('activeCustomersCount').textContent = allCustomers.filter(c => c.is_active).length;
                
                displayCustomers(allCustomers);
            } catch (error) {
                console.error('Error loading customers:', error);
                document.getElementById('customersList').innerHTML = '<p style="text-align: center; color: #666;">Error loading customers</p>';
            }
        }
        
        // Display Customers
        function displayCustomers(customers) {
            const container = document.getElementById('customersList');
            
            if (customers.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No customers found</p>';
                return;
            }
            
            let html = '';
            customers.forEach(customer => {
                const initials = customer.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
                const typeClass = `type-${customer.customer_type || 'regular'}`;
                const typeName = (customer.customer_type || 'regular').charAt(0).toUpperCase() + (customer.customer_type || 'regular').slice(1);
                
                html += `
                    <div class="customer-card">
                        <div class="customer-avatar">${initials}</div>
                        <div class="customer-info">
                            <div class="customer-name">${customer.name}</div>
                            <div class="customer-details">
                                <span class="customer-phone">üìû ${customer.phone || 'No phone'}</span>
                            </div>
                            <span class="customer-type-badge ${typeClass}">${typeName}</span>
                        </div>
                        <div class="customer-stats">
                            <div class="customer-balance">‚Çπ${(customer.current_balance || 0).toFixed(0)}</div>
                            <div class="customer-purchases">${(customer.total_purchases || 0)} purchases</div>
                            <div class="customer-actions">
                                <button class="action-btn btn-edit" onclick="editCustomer('${customer.id}')">Edit</button>
                                <button class="action-btn btn-delete" onclick="deleteCustomer('${customer.id}')">Del</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Filter Customers by Search
        function filterCustomers() {
            const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
            let filtered = allCustomers;
            
            if (currentCustomerType !== 'all') {
                filtered = filtered.filter(c => (c.customer_type || 'regular') === currentCustomerType);
            }
            
            if (searchTerm) {
                filtered = filtered.filter(c => 
                    c.name.toLowerCase().includes(searchTerm) || 
                    (c.phone && c.phone.toLowerCase().includes(searchTerm)) ||
                    (c.email && c.email.toLowerCase().includes(searchTerm))
                );
            }
            
            displayCustomers(filtered);
        }
        
        // Filter by Customer Type
        function filterCustomersByType(type) {
            currentCustomerType = type;
            
            // Update active tab
            const tabs = document.querySelectorAll('#customersModule .filter-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            filterCustomers();
        }
        
        // Show Add Customer Form
        function showAddCustomerForm() {
            document.getElementById('addCustomerModal').classList.add('show');
            document.getElementById('customerForm').reset();
        }
        
        // Close Add Customer Modal
        function closeAddCustomerModal() {
            document.getElementById('addCustomerModal').classList.remove('show');
        }
        
        // Save Customer
        async function saveCustomer(event) {
            event.preventDefault();
            
            const formData = {
                name: document.getElementById('customerName').value,
                phone: document.getElementById('customerPhone').value,
                email: document.getElementById('customerEmail').value || null,
                address: document.getElementById('customerAddress').value || null,
                customer_type: document.getElementById('customerType').value,
                credit_limit: parseFloat(document.getElementById('customerCreditLimit').value) || 0
            };
            
            try {
                const response = await fetch('/api/customers', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    alert('‚úÖ Customer added successfully!');
                    closeAddCustomerModal();
                    await loadCustomers(); // Reload customers list
                } else {
                    alert('‚ùå Error: ' + (result.message || 'Failed to add customer'));
                }
            } catch (error) {
                console.error('Error saving customer:', error);
                alert('‚ùå Error saving customer. Please try again.');
            }
        }
        
        // Edit Customer
        function editCustomer(id) {
            alert('Edit customer: ' + id);
        }
        
        // Delete Customer
        function deleteCustomer(id) {
            if (confirm('Delete this customer?')) {
                alert('Delete customer: ' + id);
            }
        }
        
        // ========== SALES MODULE ==========
        
        let allSales = [];
        let currentDateFilter = 'today';
        
        // Load Sales
        async function loadSales() {
            try {
                console.log('üí∞ Loading sales...');
                const data = await apiCall('/api/sales/summary');
                console.log('‚úÖ Sales summary loaded');
                
                // Update summary cards
                updateSalesSummary(data);
                
                // Load sales list
                console.log('üìã Loading sales list...');
                allSales = await apiCall('/api/sales');
                console.log(`‚úÖ Sales list loaded: ${allSales.length}`);
                
                displaySales(allSales);
            } catch (error) {
                console.error('Error loading sales:', error);
                document.getElementById('salesList').innerHTML = '<p style="text-align: center; color: #666;">Error loading sales</p>';
            }
        }
        
        // Update Sales Summary
        function updateSalesSummary(data) {
            const today = data.today || { total: 0, count: 0 };
            const yesterday = data.yesterday || { total: 0, count: 0 };
            
            // Total Revenue
            document.getElementById('totalRevenue').textContent = '‚Çπ' + (today.total || 0).toFixed(0);
            
            // Revenue Change
            const revenueChange = yesterday.total > 0 ? 
                (((today.total - yesterday.total) / yesterday.total) * 100).toFixed(1) : 0;
            document.getElementById('revenueChange').textContent = 
                (revenueChange >= 0 ? '‚Üë ' : '‚Üì ') + Math.abs(revenueChange) + '%';
            
            // Transactions
            document.getElementById('totalTransactions').textContent = today.count || 0;
            
            // Transaction Change
            const transactionChange = yesterday.count > 0 ? 
                (((today.count - yesterday.count) / yesterday.count) * 100).toFixed(1) : 0;
            document.getElementById('transactionChange').textContent = 
                (transactionChange >= 0 ? '‚Üë ' : '‚Üì ') + Math.abs(transactionChange) + '%';
            
            // Avg Order Value
            const avgValue = today.count > 0 ? (today.total / today.count) : 0;
            document.getElementById('avgOrderValue').textContent = '‚Çπ' + avgValue.toFixed(0);
            
            // Top Product
            if (data.top_products && data.top_products.length > 0) {
                const topProd = data.top_products[0];
                document.getElementById('topProduct').textContent = topProd.product_name || '-';
                document.getElementById('topProductQty').textContent = (topProd.quantity || 0) + ' sold';
            }
        }
        
        // Display Sales
        function displaySales(sales) {
            const container = document.getElementById('salesList');
            
            if (sales.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No sales found</p>';
                return;
            }
            
            let html = '';
            sales.forEach(sale => {
                const saleDate = new Date(sale.created_at);
                const timeStr = saleDate.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });
                const dateStr = saleDate.toLocaleDateString('en-IN', { day: '2-digit', month: 'short' });
                
                const paymentClass = `payment-${(sale.payment_method || 'cash').toLowerCase()}`;
                const paymentMethod = (sale.payment_method || 'Cash').toUpperCase();
                
                html += `
                    <div class="sale-card">
                        <div class="sale-header">
                            <div class="sale-bill-info">
                                <div class="sale-bill-number">üßæ ${sale.bill_number || 'N/A'}</div>
                                <div class="sale-customer">üë§ ${sale.customer_name || 'Walk-in Customer'}</div>
                            </div>
                            <div class="sale-amount">
                                <div class="sale-total">‚Çπ${(sale.total_amount || 0).toFixed(0)}</div>
                                <div class="sale-time">${timeStr}</div>
                            </div>
                        </div>
                        <div class="sale-details">
                            <div class="sale-detail-item">
                                üìÖ ${dateStr}
                            </div>
                            <div class="sale-detail-item">
                                <span class="sale-payment-badge ${paymentClass}">${paymentMethod}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Filter Sales by Search
        function filterSales() {
            const searchTerm = document.getElementById('salesSearch').value.toLowerCase();
            let filtered = allSales;
            
            if (searchTerm) {
                filtered = filtered.filter(s => 
                    (s.bill_number && s.bill_number.toLowerCase().includes(searchTerm)) ||
                    (s.customer_name && s.customer_name.toLowerCase().includes(searchTerm)) ||
                    (s.product_name && s.product_name.toLowerCase().includes(searchTerm))
                );
            }
            
            displaySales(filtered);
        }
        
        // Filter Sales by Date
        async function filterSalesByDate(period) {
            currentDateFilter = period;
            
            // Update active tab
            const tabs = document.querySelectorAll('#salesModule .filter-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Reload sales with filter
            await loadSales();
        }
        
        // Show Add Sale Form
        function showAddSaleForm() {
            alert('üöß Add Sale form coming soon!\n\nFor now, use the Billing module to create new sales.');
        }
        
        // ========== BILLING MODULE ==========
        
        let billItems = [];
        let billProducts = [];
        
        // Load products for billing - Desktop Grid Style
        async function loadBillingProducts() {
            try {
                console.log('üì¶ Loading products for billing...');
                billProducts = await apiCall('/api/products');
                
                renderBillingProductsGrid(billProducts);
                
                console.log(`‚úÖ Loaded ${billProducts.length} products for billing`);
            } catch (error) {
                console.error('‚ùå Error loading billing products:', error);
                document.getElementById('billProductsGrid').innerHTML = 
                    '<div style="text-align: center; padding: 20px; color: #666;">Error loading products</div>';
            }
        }
        
        // Render products in grid layout
        function renderBillingProductsGrid(products) {
            const grid = document.getElementById('billProductsGrid');
            
            if (!products || products.length === 0) {
                grid.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">No products available</div>';
                return;
            }
            
            grid.innerHTML = products.map(product => {
                const isOutOfStock = product.stock <= 0;
                const stockClass = isOutOfStock ? 'out-of-stock' : '';
                const stockText = isOutOfStock ? 'Out of Stock' : `Stock: ${product.stock}`;
                
                return `
                    <div class="bill-product-box ${stockClass}" 
                         onclick="${isOutOfStock ? '' : `addProductToBill('${product.id}')`}"
                         data-product-id="${product.id}">
                        <div class="bill-product-name">${product.name}</div>
                        <div class="bill-product-price">‚Çπ${product.price}</div>
                        <div class="bill-product-stock">${stockText}</div>
                    </div>
                `;
            }).join('');
        }
        
        // Search products in billing
        function setupBillingSearch() {
            const searchInput = document.getElementById('billProductSearch');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const query = this.value.toLowerCase();
                    const filteredProducts = billProducts.filter(product => 
                        product.name.toLowerCase().includes(query) ||
                        product.code.toLowerCase().includes(query) ||
                        (product.category && product.category.toLowerCase().includes(query))
                    );
                    renderBillingProductsGrid(filteredProducts);
                });
            }
        }
        
        // Update price when product selected
        document.addEventListener('DOMContentLoaded', function() {
            const productSelect = document.getElementById('billProductSelect');
            if (productSelect) {
                productSelect.addEventListener('change', function() {
                    const selectedOption = this.options[this.selectedIndex];
                    const price = selectedOption.dataset.price || 0;
                    document.getElementById('billPrice').value = price;
                });
            }
        });
        
        // Add product to bill
        function addToBillMobile() {
            const productSelect = document.getElementById('billProductSelect');
            const quantity = parseInt(document.getElementById('billQuantity').value) || 1;
            const price = parseFloat(document.getElementById('billPrice').value) || 0;
            
            if (!productSelect.value) {
                alert('‚ùå Please select a product!');
                return;
            }
            
            if (quantity <= 0) {
                alert('‚ùå Quantity must be greater than 0!');
                return;
            }
            
            const selectedOption = productSelect.options[productSelect.selectedIndex];
            const productId = productSelect.value;
            const productName = selectedOption.dataset.name;
            const total = price * quantity;
            
            // Add to bill items
            billItems.push({
                id: productId,
                name: productName,
                quantity: quantity,
                price: price,
                total: total
            });
            
            // Update display
            renderBillItems();
            calculateBillTotal();
            
            // Reset form
            productSelect.value = '';
            document.getElementById('billQuantity').value = 1;
            document.getElementById('billPrice').value = '';
            
            console.log('‚úÖ Product added to bill:', productName);
        }
        
        // Render bill items
        function renderBillItems() {
            const container = document.getElementById('billItemsList');
            
            if (billItems.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #999;">
                        <div style="font-size: 48px; margin-bottom: 10px;">üõí</div>
                        <p>No items added yet</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            billItems.forEach((item, index) => {
                html += `
                    <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #e0e0e0;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="flex: 1;">
                                <div style="font-weight: 600; color: #732C3F; margin-bottom: 4px;">${item.name}</div>
                                <div style="font-size: 12px; color: #666;">
                                    ${item.quantity} √ó ‚Çπ${item.price.toFixed(2)} = ‚Çπ${item.total.toFixed(2)}
                                </div>
                            </div>
                            <button onclick="removeBillItem(${index})" style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer;">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Remove item from bill
        function removeBillItem(index) {
            billItems.splice(index, 1);
            renderBillItems();
            calculateBillTotal();
            console.log('üóëÔ∏è Item removed from bill');
        }
        
        // Calculate bill total
        function calculateBillTotal() {
            const subtotal = billItems.reduce((sum, item) => sum + item.total, 0);
            const gst = subtotal * 0.18; // 18% GST
            const total = subtotal + gst;
            
            document.getElementById('billSubtotal').textContent = subtotal.toFixed(2);
            document.getElementById('billGST').textContent = gst.toFixed(2);
            document.getElementById('billTotal').textContent = total.toFixed(2);
        }
        
        // Add product to bill from grid
        function addProductToBill(productId) {
            const product = billProducts.find(p => p.id === productId);
            if (!product) {
                showToast('‚ùå Product not found', 'error');
                return;
            }
            
            if (product.stock <= 0) {
                showToast('‚ùå Product out of stock', 'error');
                return;
            }
            
            // Check if product already in bill
            const existingItem = billItems.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity += 1;
                existingItem.total = existingItem.quantity * existingItem.price;
            } else {
                billItems.push({
                    id: productId,
                    name: product.name,
                    quantity: 1,
                    price: product.price,
                    total: product.price
                });
            }
            
            renderBillItems();
            calculateBillTotal();
            showToast(`‚úÖ ${product.name} added to bill`, 'success');
        }
        
        // Render bill items
        function renderBillItems() {
            const container = document.getElementById('billItemsList');
            
            if (billItems.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #999;">
                        <div style="font-size: 48px; margin-bottom: 10px;">üõí</div>
                        <p>Scan or click products to add</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = billItems.map((item, index) => `
                <div class="bill-item">
                    <div class="bill-item-info">
                        <div class="bill-item-name">${item.name}</div>
                        <div class="bill-item-details">‚Çπ${item.price} √ó ${item.quantity}</div>
                    </div>
                    <div class="bill-item-total">‚Çπ${item.total.toFixed(2)}</div>
                    <button class="bill-item-remove" onclick="removeBillItem(${index})">‚úï</button>
                </div>
            `).join('');
        }
        
        // Remove item from bill
        function removeBillItem(index) {
            billItems.splice(index, 1);
            renderBillItems();
            calculateBillTotal();
            showToast('Item removed from bill', 'info');
        }
        
        // Calculate bill total
        function calculateBillTotal() {
            const subtotal = billItems.reduce((sum, item) => sum + item.total, 0);
            const gst = subtotal * 0.18;
            const total = subtotal + gst;
            
            document.getElementById('billSubtotal').textContent = subtotal.toFixed(2);
            document.getElementById('billGST').textContent = gst.toFixed(2);
            document.getElementById('billTotal').textContent = total.toFixed(2);
            
            // Enable/disable complete bill button
            const completeBtn = document.getElementById('completeBillBtn');
            completeBtn.disabled = billItems.length === 0;
        }
        
        // Clear bill
        function clearBill() {
            if (billItems.length === 0) {
                return;
            }
            
            if (confirm('Are you sure you want to clear the bill?')) {
                billItems = [];
                renderBillItems();
                calculateBillTotal();
                console.log('üßπ Bill cleared');
            }
        }
        
        // Barcode Scanner for Billing
        let billBarcodeStream = null;
        
        // Open barcode scanner for billing
        async function openBillBarcodeScanner() {
            const section = document.getElementById('billBarcodeSection');
            const camera = document.getElementById('billBarcodeCamera');
            section.style.display = 'block';
            
            try {
                camera.innerHTML = `
                    <div style="text-align: center; padding: 20px; background: #e8f5e9; border-radius: 8px; margin-bottom: 10px;">
                        <div style="font-size: 36px; margin-bottom: 10px;">üì∑</div>
                        <p style="color: #2e7d32; margin-bottom: 5px; font-weight: 600;">Requesting Camera Access...</p>
                        <p style="font-size: 12px; color: #2e7d32;">Point camera at product barcode</p>
                    </div>
                `;
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                });
                
                camera.innerHTML = `
                    <div style="position: relative;">
                        <video id="billBarcodeVideo" autoplay playsinline style="width: 100%; border-radius: 8px; background: #000;"></video>
                        
                        <!-- Scanning Overlay -->
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; max-width: 300px; height: 150px; border: 3px solid #28a745; border-radius: 10px; box-shadow: 0 0 0 9999px rgba(0,0,0,0.5); pointer-events: none;">
                            <div style="position: absolute; top: -30px; left: 50%; transform: translateX(-50%); background: #28a745; color: white; padding: 5px 15px; border-radius: 15px; font-size: 12px; font-weight: 600; white-space: nowrap;">
                                üì± Point at barcode
                            </div>
                            <!-- Scanning line animation -->
                            <div style="position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, #28a745, transparent); animation: scan 2s linear infinite;"></div>
                        </div>
                    </div>
                    
                    <style>
                        @keyframes scan {
                            0% { top: 0; }
                            50% { top: 100%; }
                            100% { top: 0; }
                        }
                    </style>
                    
                    <div style="text-align: center; margin-top: 10px; padding: 10px; background: rgba(40, 167, 69, 0.1); border-radius: 8px;">
                        <div style="color: #28a745; font-weight: 600; margin-bottom: 5px;">üîç Scanning automatically...</div>
                        <div style="font-size: 12px; color: #666; margin-bottom: 10px;">Align barcode within the green box</div>
                        <button onclick="closeBillBarcodeScanner()" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 8px; font-size: 14px;">‚úï Close Scanner</button>
                    </div>
                `;
                
                const video = document.getElementById('billBarcodeVideo');
                billBarcodeStream = stream;
                video.srcObject = stream;
                
                // Start real-time barcode detection for billing
                video.addEventListener('loadedmetadata', () => {
                    startBillBarcodeDetection();
                });
                
                console.log('‚úÖ Billing barcode scanner opened');
                
            } catch (error) {
                console.error('Camera error:', error);
                camera.innerHTML = `
                    <div style="text-align: center; padding: 20px; background: #fff3cd; border-radius: 8px;">
                        <div style="font-size: 36px; margin-bottom: 10px;">‚ö†Ô∏è</div>
                        <p style="color: #856404;">Camera access denied or not available</p>
                        <button onclick="closeBillBarcodeScanner()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 8px; margin-top: 10px;">Close</button>
                    </div>
                `;
            }
        }
        
        // Start barcode detection for billing
        function startBillBarcodeDetection() {
            if (typeof Quagga !== 'undefined') {
                const video = document.getElementById('billBarcodeVideo');
                if (!video) return;
                
                Quagga.init({
                    inputStream: {
                        name: "Live",
                        type: "LiveStream",
                        target: video,
                        constraints: {
                            width: 640,
                            height: 480,
                            facingMode: "environment"
                        }
                    },
                    locator: {
                        patchSize: "medium",
                        halfSample: true
                    },
                    numOfWorkers: 2,
                    frequency: 10,
                    decoder: {
                        readers: [
                            "code_128_reader",
                            "ean_reader",
                            "ean_8_reader",
                            "code_39_reader",
                            "upc_reader",
                            "upc_e_reader"
                        ]
                    },
                    locate: true
                }, function(err) {
                    if (err) {
                        console.log('Billing barcode detection error:', err);
                        return;
                    }
                    console.log("‚úÖ Billing barcode detection started - Real mart style");
                    Quagga.start();
                });
                
                // Listen for barcode detection - Real mart style (instant detection)
                let isProcessing = false;
                
                Quagga.onDetected(function(data) {
                    const barcode = data.codeResult.code;
                    
                    // Prevent multiple detections while processing
                    if (isProcessing) return;
                    
                    // Validate barcode (minimum length check)
                    if (!barcode || barcode.length < 4) return;
                    
                    isProcessing = true;
                    console.log('üéØ Billing barcode detected:', barcode);
                    
                    // Immediate processing - no delay for real mart experience
                    searchAndAddProductByBarcode(barcode).finally(() => {
                        // Reset processing flag after 2 seconds
                        setTimeout(() => {
                            isProcessing = false;
                        }, 2000);
                    });
                });
            }
        }
        
        // Search product by barcode and add to bill - Real mart style
        async function searchAndAddProductByBarcode(barcode) {
            try {
                console.log('üîç Searching for barcode:', barcode);
                
                // Show scanning feedback
                const camera = document.getElementById('billBarcodeCamera');
                const originalContent = camera.innerHTML;
                
                camera.innerHTML = `
                    <div style="text-align: center; padding: 30px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border-radius: 8px; color: white;">
                        <div style="font-size: 48px; margin-bottom: 15px;">‚úÖ</div>
                        <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Barcode Detected!</div>
                        <div style="font-size: 14px; opacity: 0.9;">Searching product...</div>
                        <div style="font-size: 12px; margin-top: 10px; opacity: 0.8;">Code: ${barcode}</div>
                    </div>
                `;
                
                console.log('üì° Making API request to:', `/api/products/search/barcode/${barcode}`);
                
                const response = await fetch(`/api/products/search/barcode/${barcode}`);
                console.log('üì° Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('üì° API Response:', result);
                
                if (result.success && result.product) {
                    const product = result.product;
                    
                    // Show success feedback
                    camera.innerHTML = `
                        <div style="text-align: center; padding: 30px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border-radius: 8px; color: white;">
                            <div style="font-size: 48px; margin-bottom: 15px;">üõí</div>
                            <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">${product.name}</div>
                            <div style="font-size: 16px; margin-bottom: 8px;">‚Çπ${product.price}</div>
                            <div style="font-size: 14px; opacity: 0.9;">Added to bill!</div>
                        </div>
                    `;
                    
                    // Add product to bill
                    addProductToBill(product.id);
                    
                    // Close scanner after 2 seconds
                    setTimeout(() => {
                        closeBillBarcodeScanner();
                        showToast(`‚úÖ ${product.name} added to bill!`, 'success');
                    }, 2000);
                    
                } else {
                    // Show error feedback
                    camera.innerHTML = `
                        <div style="text-align: center; padding: 30px; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); border-radius: 8px; color: white;">
                            <div style="font-size: 48px; margin-bottom: 15px;">‚ùå</div>
                            <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Product Not Found</div>
                            <div style="font-size: 14px; opacity: 0.9;">Barcode: ${barcode}</div>
                            <button onclick="closeBillBarcodeScanner()" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 16px; border-radius: 8px; margin-top: 15px;">Try Again</button>
                        </div>
                    `;
                    
                    showToast(`‚ùå Product not found: ${barcode}`, 'error');
                }
            } catch (error) {
                console.error('‚ùå Error searching product by barcode:', error);
                console.error('‚ùå Error details:', {
                    message: error.message,
                    stack: error.stack,
                    barcode: barcode
                });
                
                // Show detailed error
                const camera = document.getElementById('billBarcodeCamera');
                camera.innerHTML = `
                    <div style="text-align: center; padding: 30px; background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%); border-radius: 8px; color: white;">
                        <div style="font-size: 48px; margin-bottom: 15px;">‚ö†Ô∏è</div>
                        <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Search Error</div>
                        <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">Barcode: ${barcode}</div>
                        <div style="font-size: 12px; opacity: 0.8; margin-bottom: 15px;">Error: ${error.message}</div>
                        <button onclick="closeBillBarcodeScanner()" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 16px; border-radius: 8px; margin-right: 10px;">Close</button>
                        <button onclick="searchAndAddProductByBarcode('${barcode}')" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 16px; border-radius: 8px;">Retry</button>
                    </div>
                `;
                
                showToast(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        // Close billing barcode scanner
        function closeBillBarcodeScanner() {
            const section = document.getElementById('billBarcodeSection');
            section.style.display = 'none';
            
            // Stop Quagga
            if (typeof Quagga !== 'undefined') {
                Quagga.stop();
            }
            
            // Stop camera stream
            if (billBarcodeStream) {
                billBarcodeStream.getTracks().forEach(track => track.stop());
                billBarcodeStream = null;
            }
        }
        
        // Complete bill
        async function completeBill() {
            if (billItems.length === 0) {
                showToast('‚ùå Please add products to bill', 'error');
                return;
            }
            
            const paymentMethod = document.getElementById('paymentMethod').value;
            const subtotal = billItems.reduce((sum, item) => sum + item.total, 0);
            const gst = subtotal * 0.18;
            const total = subtotal + gst;
            
            const billData = {
                business_type: 'retail',
                items: billItems.map(item => ({
                    product_id: item.id,
                    product_name: item.name,
                    quantity: item.quantity,
                    unit_price: item.price,
                    total_price: item.total
                })),
                subtotal: subtotal,
                tax_amount: gst,
                total_amount: total,
                payment_method: paymentMethod
            };
            
            try {
                const btn = document.getElementById('completeBillBtn');
                btn.textContent = '‚è≥ Processing...';
                btn.disabled = true;
                
                const response = await fetch('/api/bills', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(billData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showToast('‚úÖ Bill completed successfully!', 'success');
                    
                    // Clear bill
                    billItems = [];
                    renderBillItems();
                    calculateBillTotal();
                    
                    // Show success message
                    alert(`üéâ Bill Completed!\n\nTotal: ‚Çπ${total.toFixed(2)}\nPayment: ${paymentMethod.toUpperCase()}\n\nThank you!`);
                } else {
                    showToast('‚ùå Error completing bill: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Error completing bill:', error);
                showToast('‚ùå Network error. Please try again.', 'error');
            } finally {
                const btn = document.getElementById('completeBillBtn');
                btn.textContent = 'üí∞ Complete Bill';
                btn.disabled = billItems.length === 0;
            }
        }
        

        
        // ========== EARNINGS/PROFIT MODULE ==========
        
        let currentEarningsFilter = 'today';
        
        // Load Earnings
        async function loadEarnings() {
            try {
                console.log('üíé Loading earnings...');
                // Get products with cost/price
                const products = await apiCall('/api/products');
                console.log(`‚úÖ Products loaded: ${products.length}`);
                
                // Get sales data
                const sales = await apiCall('/api/sales');
                console.log(`‚úÖ Sales loaded: ${sales.length}`);
                
                // Calculate earnings
                calculateEarnings(products, sales);
            } catch (error) {
                console.error('Error loading earnings:', error);
            }
        }
        
        // Calculate Earnings
        function calculateEarnings(products, sales) {
            // Create product map for quick lookup
            const productMap = {};
            products.forEach(p => {
                productMap[p.id] = p;
            });
            
            let totalSales = 0;
            let totalCost = 0;
            let totalProfit = 0;
            let transactionCount = 0;
            
            // Product-wise profit tracking
            const productProfits = {};
            
            // Calculate from sales
            sales.forEach(sale => {
                const product = productMap[sale.product_id];
                if (!product) return;
                
                const saleAmount = sale.total_price || (sale.quantity * sale.unit_price);
                const costAmount = (product.cost || 0) * (sale.quantity || 0);
                const profit = saleAmount - costAmount;
                
                totalSales += saleAmount;
                totalCost += costAmount;
                totalProfit += profit;
                transactionCount++;
                
                // Track product-wise
                if (!productProfits[product.id]) {
                    productProfits[product.id] = {
                        name: product.name,
                        totalProfit: 0,
                        totalSales: 0,
                        totalCost: 0,
                        quantity: 0,
                        price: product.price,
                        cost: product.cost
                    };
                }
                
                productProfits[product.id].totalProfit += profit;
                productProfits[product.id].totalSales += saleAmount;
                productProfits[product.id].totalCost += costAmount;
                productProfits[product.id].quantity += (sale.quantity || 0);
            });
            
            // Update main summary
            document.getElementById('totalProfit').textContent = '‚Çπ' + totalProfit.toFixed(0);
            document.getElementById('totalSalesValue').textContent = '‚Çπ' + totalSales.toFixed(0);
            document.getElementById('totalCostValue').textContent = '‚Çπ' + totalCost.toFixed(0);
            
            // Calculate margins
            const profitMargin = totalSales > 0 ? ((totalProfit / totalSales) * 100) : 0;
            document.getElementById('profitMarginPercent').textContent = 'Margin: ' + profitMargin.toFixed(1) + '%';
            document.getElementById('profitMargin').textContent = profitMargin.toFixed(1) + '%';
            
            // Metrics
            document.getElementById('grossProfit').textContent = '‚Çπ' + totalProfit.toFixed(0);
            const avgProfit = transactionCount > 0 ? (totalProfit / transactionCount) : 0;
            document.getElementById('avgProfitPerSale').textContent = '‚Çπ' + avgProfit.toFixed(0);
            document.getElementById('totalTransactionsCount').textContent = transactionCount;
            
            // Display product-wise profits
            displayProductProfits(productProfits);
        }
        
        // Display Product-wise Profits
        function displayProductProfits(productProfits) {
            const container = document.getElementById('productProfitList');
            
            // Convert to array and sort by profit
            const profitArray = Object.values(productProfits).sort((a, b) => b.totalProfit - a.totalProfit);
            
            if (profitArray.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 10px;">No data available</p>';
                return;
            }
            
            // Update top/least profitable
            if (profitArray.length > 0) {
                const mostProfitable = profitArray[0];
                document.getElementById('mostProfitableProduct').textContent = mostProfitable.name;
                document.getElementById('mostProfitableAmount').textContent = '‚Çπ' + mostProfitable.totalProfit.toFixed(0) + ' profit';
                
                const leastProfitable = profitArray[profitArray.length - 1];
                document.getElementById('leastProfitableProduct').textContent = leastProfitable.name;
                document.getElementById('leastProfitableAmount').textContent = '‚Çπ' + leastProfitable.totalProfit.toFixed(0) + ' profit';
            }
            
            // Display product cards
            let html = '';
            profitArray.forEach(product => {
                const margin = product.totalSales > 0 ? ((product.totalProfit / product.totalSales) * 100) : 0;
                const marginClass = margin >= 30 ? 'margin-high' : (margin >= 15 ? 'margin-medium' : 'margin-low');
                const marginLabel = margin >= 30 ? 'High' : (margin >= 15 ? 'Medium' : 'Low');
                
                html += `
                    <div class="product-profit-card">
                        <div class="product-profit-header">
                            <div class="product-profit-name">
                                ${product.name}
                                <span class="profit-margin-badge ${marginClass}">${margin.toFixed(1)}%</span>
                            </div>
                            <div class="product-profit-amount">‚Çπ${product.totalProfit.toFixed(0)}</div>
                        </div>
                        <div class="product-profit-details">
                            <div class="product-profit-detail">
                                <span class="product-profit-detail-label">Sold</span>
                                <span class="product-profit-detail-value">${product.quantity}</span>
                            </div>
                            <div class="product-profit-detail">
                                <span class="product-profit-detail-label">Revenue</span>
                                <span class="product-profit-detail-value">‚Çπ${product.totalSales.toFixed(0)}</span>
                            </div>
                            <div class="product-profit-detail">
                                <span class="product-profit-detail-label">Cost</span>
                                <span class="product-profit-detail-value">‚Çπ${product.totalCost.toFixed(0)}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Display profit trend
            displayProfitTrend(profitArray);
        }
        
        // Display Profit Trend
        function displayProfitTrend(profitArray) {
            const container = document.getElementById('profitTrend');
            
            if (profitArray.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 10px;">No data available</p>';
                return;
            }
            
            // Show top 5 products as bars
            const top5 = profitArray.slice(0, 5);
            const maxProfit = Math.max(...top5.map(p => p.totalProfit));
            
            let html = '';
            top5.forEach(product => {
                const percentage = maxProfit > 0 ? (product.totalProfit / maxProfit) * 100 : 0;
                const barColor = percentage >= 80 ? '#4CAF50' : (percentage >= 50 ? '#FF9800' : '#2196F3');
                
                html += `
                    <div style="margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 12px;">
                            <span style="color: #666;">${product.name}</span>
                            <span style="color: ${barColor}; font-weight: 600;">‚Çπ${product.totalProfit.toFixed(0)}</span>
                        </div>
                        <div style="background: #f0f0f0; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div style="background: ${barColor}; height: 100%; width: ${percentage}%; transition: width 0.3s;"></div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Filter Earnings by Date
        async function filterEarningsByDate(period) {
            currentEarningsFilter = period;
            
            // Update active tab
            const tabs = document.querySelectorAll('#earningsModule .filter-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Reload earnings
            await loadEarnings();
        }
        
        // Refresh Earnings
        async function refreshEarnings() {
            await loadEarnings();
            alert('‚úÖ Earnings data refreshed!');
        }
        
        // Scroll to top
        function scrollToTop() {
            // Show dashboard
            document.getElementById('productsModule').style.display = 'none';
            document.getElementById('customersModule').style.display = 'none';
            document.getElementById('salesModule').style.display = 'none';
            document.getElementById('earningsModule').style.display = 'none';
            document.getElementById('dataDisplay').style.display = 'none';
            
            // Show dashboard cards
            document.querySelectorAll('.card').forEach(card => {
                if (!card.id || (card.id !== 'dataDisplay' && card.id !== 'productsModule' && card.id !== 'customersModule' && card.id !== 'salesModule' && card.id !== 'earningsModule')) {
                    card.style.display = 'block';
                }
            });
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // ========== SETTINGS MODULE ==========
        
        // Load Settings
        function loadSettings() {
            console.log('‚öôÔ∏è Loading settings...');
            
            // Load from localStorage
            const settings = JSON.parse(localStorage.getItem('bizpulse_settings') || '{}');
            
            // Business Information
            if (settings.businessName) document.getElementById('businessName').value = settings.businessName;
            if (settings.businessPhone) document.getElementById('businessPhone').value = settings.businessPhone;
            if (settings.businessEmail) document.getElementById('businessEmail').value = settings.businessEmail;
            
            // GST Settings
            if (settings.gstNumber) document.getElementById('gstNumber').value = settings.gstNumber;
            if (settings.defaultGST) document.getElementById('defaultGST').value = settings.defaultGST;
            
            // Invoice Settings
            if (settings.invoicePrefix) document.getElementById('invoicePrefix').value = settings.invoicePrefix;
            if (settings.invoiceStartNumber) document.getElementById('invoiceStartNumber').value = settings.invoiceStartNumber;
            
            // App Settings
            if (settings.appLanguage) document.getElementById('appLanguage').value = settings.appLanguage;
            if (settings.appCurrency) document.getElementById('appCurrency').value = settings.appCurrency;
            if (settings.dateFormat) document.getElementById('dateFormat').value = settings.dateFormat;
            if (settings.timeFormat) document.getElementById('timeFormat').value = settings.timeFormat;
            
            console.log('‚úÖ Settings loaded:', settings);
        }
        
        // Save Settings
        function saveSettings() {
            const settings = {
                businessName: document.getElementById('businessName').value,
                businessPhone: document.getElementById('businessPhone').value,
                businessEmail: document.getElementById('businessEmail').value,
                gstNumber: document.getElementById('gstNumber').value,
                defaultGST: document.getElementById('defaultGST').value,
                invoicePrefix: document.getElementById('invoicePrefix').value,
                invoiceStartNumber: document.getElementById('invoiceStartNumber').value,
                appLanguage: document.getElementById('appLanguage').value,
                appCurrency: document.getElementById('appCurrency').value,
                dateFormat: document.getElementById('dateFormat').value,
                timeFormat: document.getElementById('timeFormat').value,
                savedAt: new Date().toISOString()
            };
            
            localStorage.setItem('bizpulse_settings', JSON.stringify(settings));
            
            alert('‚úÖ Settings saved successfully!');
            console.log('üíæ Settings saved:', settings);
        }
        
        // Backup Data - Export all data as JSON file
        function backupData() {
            try {
                console.log('üì• Starting backup...');
                
                // Collect all data from localStorage
                const backupData = {
                    settings: JSON.parse(localStorage.getItem('bizpulse_settings') || '{}'),
                    products: JSON.parse(localStorage.getItem('bizpulse_products') || '[]'),
                    customers: JSON.parse(localStorage.getItem('bizpulse_customers') || '[]'),
                    sales: JSON.parse(localStorage.getItem('bizpulse_sales') || '[]'),
                    bills: JSON.parse(localStorage.getItem('bizpulse_bills') || '[]'),
                    backupDate: new Date().toISOString(),
                    version: '1.0.0'
                };
                
                // Convert to JSON string
                const jsonString = JSON.stringify(backupData, null, 2);
                
                // Create blob and download
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `bizpulse_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('‚úÖ Backup downloaded successfully!\n\nFile: ' + a.download);
                console.log('‚úÖ Backup completed:', backupData);
            } catch (error) {
                console.error('‚ùå Backup failed:', error);
                alert('‚ùå Backup failed: ' + error.message);
            }
        }
        
        // Restore Data - Import data from JSON file
        function restoreData() {
            try {
                console.log('üì§ Starting restore...');
                
                // Create file input
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = async (e) => {
                    try {
                        const file = e.target.files[0];
                        if (!file) return;
                        
                        // Read file
                        const text = await file.text();
                        const backupData = JSON.parse(text);
                        
                        // Validate backup data
                        if (!backupData.version || !backupData.backupDate) {
                            throw new Error('Invalid backup file format');
                        }
                        
                        // Confirm restore
                        const confirm = window.confirm(
                            '‚ö†Ô∏è WARNING: This will replace all current data!\n\n' +
                            'Backup Date: ' + new Date(backupData.backupDate).toLocaleString() + '\n' +
                            'Version: ' + backupData.version + '\n\n' +
                            'Do you want to continue?'
                        );
                        
                        if (!confirm) return;
                        
                        // Restore data to localStorage
                        if (backupData.settings) {
                            localStorage.setItem('bizpulse_settings', JSON.stringify(backupData.settings));
                        }
                        if (backupData.products) {
                            localStorage.setItem('bizpulse_products', JSON.stringify(backupData.products));
                        }
                        if (backupData.customers) {
                            localStorage.setItem('bizpulse_customers', JSON.stringify(backupData.customers));
                        }
                        if (backupData.sales) {
                            localStorage.setItem('bizpulse_sales', JSON.stringify(backupData.sales));
                        }
                        if (backupData.bills) {
                            localStorage.setItem('bizpulse_bills', JSON.stringify(backupData.bills));
                        }
                        
                        alert('‚úÖ Data restored successfully!\n\nPlease refresh the page to see changes.');
                        console.log('‚úÖ Restore completed:', backupData);
                        
                        // Reload page after 2 seconds
                        setTimeout(() => {
                            window.location.reload();
                        }, 2000);
                        
                    } catch (error) {
                        console.error('‚ùå Restore failed:', error);
                        alert('‚ùå Restore failed: ' + error.message);
                    }
                };
                
                input.click();
                
            } catch (error) {
                console.error('‚ùå Restore failed:', error);
                alert('‚ùå Restore failed: ' + error.message);
            }
        }
        
        // Change Password
        function changePassword() {
            try {
                console.log('üîë Change password initiated...');
                
                // Get current password from localStorage
                const currentUser = JSON.parse(localStorage.getItem('bizpulse_user') || '{"password":"demo123"}');
                
                // Prompt for current password
                const currentPassword = prompt('üîí Enter current password:');
                if (!currentPassword) return;
                
                if (currentPassword !== currentUser.password) {
                    alert('‚ùå Current password is incorrect!');
                    return;
                }
                
                // Prompt for new password
                const newPassword = prompt('üîë Enter new password:\n(Minimum 6 characters)');
                if (!newPassword) return;
                
                if (newPassword.length < 6) {
                    alert('‚ùå Password must be at least 6 characters long!');
                    return;
                }
                
                // Confirm new password
                const confirmPassword = prompt('üîë Confirm new password:');
                if (!confirmPassword) return;
                
                if (newPassword !== confirmPassword) {
                    alert('‚ùå Passwords do not match!');
                    return;
                }
                
                // Save new password
                currentUser.password = newPassword;
                currentUser.passwordChangedAt = new Date().toISOString();
                localStorage.setItem('bizpulse_user', JSON.stringify(currentUser));
                
                alert('‚úÖ Password changed successfully!\n\nPlease remember your new password.');
                console.log('‚úÖ Password changed at:', currentUser.passwordChangedAt);
                
            } catch (error) {
                console.error('‚ùå Change password failed:', error);
                alert('‚ùå Change password failed: ' + error.message);
            }
        }
        
        // Clear Cache - Remove temporary data
        function clearCache() {
            try {
                console.log('üóëÔ∏è Clearing cache...');
                
                const confirm = window.confirm(
                    'üóëÔ∏è Clear Cache?\n\n' +
                    'This will remove:\n' +
                    '‚Ä¢ Temporary files\n' +
                    '‚Ä¢ Cached images\n' +
                    '‚Ä¢ Session data\n\n' +
                    'Your settings and data will be preserved.\n\n' +
                    'Continue?'
                );
                
                if (!confirm) return;
                
                // Clear specific cache items (not settings/data)
                const keysToKeep = [
                    'bizpulse_settings',
                    'bizpulse_products',
                    'bizpulse_customers',
                    'bizpulse_sales',
                    'bizpulse_bills',
                    'bizpulse_user',
                    'bizpulse_login'
                ];
                
                // Get all keys
                const allKeys = Object.keys(localStorage);
                
                // Remove keys that are not in keysToKeep
                let removedCount = 0;
                allKeys.forEach(key => {
                    if (!keysToKeep.includes(key)) {
                        localStorage.removeItem(key);
                        removedCount++;
                    }
                });
                
                // Clear session storage
                sessionStorage.clear();
                
                alert(`‚úÖ Cache cleared successfully!\n\n${removedCount} temporary items removed.`);
                console.log(`‚úÖ Cache cleared: ${removedCount} items removed`);
                
            } catch (error) {
                console.error('‚ùå Clear cache failed:', error);
                alert('‚ùå Clear cache failed: ' + error.message);
            }
        }
        
        // Reset App - Remove all data and settings
        function resetApp() {
            try {
                console.log('‚ö†Ô∏è Reset app initiated...');
                
                const confirm1 = window.confirm(
                    '‚ö†Ô∏è RESET APP?\n\n' +
                    'This will DELETE ALL DATA:\n' +
                    '‚Ä¢ All settings\n' +
                    '‚Ä¢ All products\n' +
                    '‚Ä¢ All customers\n' +
                    '‚Ä¢ All sales records\n' +
                    '‚Ä¢ All bills\n\n' +
                    '‚ö†Ô∏è THIS CANNOT BE UNDONE!\n\n' +
                    'Are you sure?'
                );
                
                if (!confirm1) return;
                
                // Second confirmation
                const confirm2 = window.confirm(
                    '‚ö†Ô∏è FINAL WARNING!\n\n' +
                    'This is your last chance to cancel.\n\n' +
                    'All data will be permanently deleted.\n\n' +
                    'Type YES in the next prompt to confirm.'
                );
                
                if (!confirm2) return;
                
                // Final confirmation with text input
                const finalConfirm = prompt('‚ö†Ô∏è Type "YES" to confirm reset:');
                
                if (finalConfirm !== 'YES') {
                    alert('‚ùå Reset cancelled. Data is safe.');
                    return;
                }
                
                // Clear all localStorage
                localStorage.clear();
                
                // Clear all sessionStorage
                sessionStorage.clear();
                
                alert('‚úÖ App reset successfully!\n\nThe page will reload now.');
                console.log('‚úÖ App reset completed');
                
                // Reload page after 1 second
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
                
            } catch (error) {
                console.error('‚ùå Reset app failed:', error);
                alert('‚ùå Reset app failed: ' + error.message);
            }
        }
        

    </script>
</body>
</html>
